Transcription & Summarize : とりあえず読書会 SwiftUI Tutorials #51

はい、ではというやつの紹介を始めていきましょう。 うりしたいはチュートリアルのリファクトリングですね。 チュートリアルで作ったコードのリファクトリングですが、 まあだいぶね、落ち着いた感じで、 残すところは解説しつつ、 もうちょっと手直ししてみると面白いかもね、みたいなね、 なんかそんなところを見ている感じになっている雰囲気を感じますが、 まあそんな調子で、今これのところを続けてみていきましょう。 さて、えーと、そうすると、次のところとしては、 ランドマークをここまではね、すでに見たんで、 次ですね、メニューの中のファイル名、 いや、ファイル名がなんか長いのがちょっと気になりますけどね、 こうね、どこがいいんだろう、 まあこの辺もまた、ちょっとコードを見終わってから、 フォルダ構成みたいなところもね、見ていったらいいのかなと思ったりしつつ、 ただまあファイル構成っていうのは結構ね、 あのー、この時々で、じゃあこうしようとか、 まあアーキテクチャとか決めてればね、アーキテクチャごとにフォルダ分けとか、 まあそれとは思うんですけど、 そういう人とかだと特徴的なのがエクステンションとかって、 プロトコル手法とかやってるとエクステンションを結構使うことになると思うんですよね。 そうするとあの、必ずしもアーキテクチャ通りにフォルダを切っていくってこともね、 難しかったりとかすると思うんで、 結局のところはなんか、この時々の気分と勇気というか、 まあそんなところでね、フォルダは引き分けていくのかなという気はするんで、 まあいくつか、いろんなパターンを、 なんかこれいいんじゃないかみたいなのね、 想像して、試してみて、 自分にとってしっくりくるかどうかみたいな、 そんな感じになってくるんですかね。 まあ何にしても、そういったあの、 自分にとってしっくりくるかどうかっていう判断基準は結構大事になってくる気がして、 その、まあそれを突き詰めていった結果がね、 セオリーになっていっているっていうところが、 やっぱりそういうのがいいのかな、 まあでもそういった方が多いと思うんでね、 なんか最終的にはその、 世の中がこうだからというか、 突き詰めていってきっとこれがいいんじゃないかなっていうのが、 世の中に寄っていくみたいな、 なんかそんなのを目指した方が有益なんじゃないかなという気は、 個人的にはするかなと思いつつ、 まあそれはフォルダは訳の話の余談で、 コード見ていきましょうとにかくね。 今日はまずランドマーク、えーとコマンド、 macOS用とiOSの方ですね。 まあ今ね、ちょっと見たとおり、 macOSとiOSかみたいに言ったのは、 フォルダーじゃないファイル名にね、 そういった名前が付いてるから、 そういった感じで、 まあその分かりやすさを狙ってね、 最初そういったファイル名にしてますけど、 まあそれで、分かりやすい、だから良い、 という判断もできるんですけど、 これと同時にね、本当にそうなのかっていう、 一時相通というのかな、 あの本当の情報はこっちのわけですよ。 あれ、えーと、画面ピーパー忘れてる、失礼しました。 ということ、始める前にちょっと出しておいてよかったですね。 えーと、この画面ね。 で、これで、ランドマークコマンド。 で、これは何OS用かなって思ったときに、 このファイル名を見てね、 iOSとmacOS用かって今言ったんですけど、 まあでも実際のところね、 本当にそうかどうかは、 タネットメンバーシップ見ないと分かんないわけですよね。 それで、うっかりね、 してて、ファイル名直してなかったりすると、 間違い生じるんでね、 そういう観点で見るとあまり良くない。 あの、なんだろう、 プログラミングやってるときより聞く言葉? なんだっけ、シングルソースオブドゥルースだっけ? あんまりそういう大それた言葉、 あんまり個人的には好まないんですけど、 まあとにかくね、 情報源が2つあって、 両方を保たないといけないっていう状況は、 煩わしいですよね。 まあその、ずれてて間違うっていう危険性もあるんですけど、 それ以外に、悩ましいですよね。 その、あるいはね、 両方を編集しないといけないとか、 両方、今みたいにね、 本当になってんのかなとか、 そのことを確認しないといけないじゃないですか。 疑った瞬間。 なのでね、まあそういったのを思うとね、 なかなかこの、えーと、両方、 微妙なのかなというところがあって、 まあ両方言うとね、なんか、 どうなんだろう、Xコードのコンフィギュレーションの設定みたいに、 例えば、このXコードの設定で、 このビルドセッティングですよね。 ビルドセッティングさ、ここか。 ビルドセッティング数の中で、 コンフィギュレーションでほら、 デバッグとリリースみたいな感じで、 こう分かれるのあるじゃないですか。 こんな風にね、この、 フォルダーのファイルナビゲーションかなこれ。 えーと、機能はなんだっけ。 えーと、プロジェクトナビゲーター。 まあ、そういった感じでね、 これ、ノー・ディフィケーション・コンテンツ、 あ、これ終わっちゃいましたっけか。 まあまあ、でもそれでもいいんですけど、 とにかくなんか、このプルダウン的に、 同じファイル名でなんかプルダウンすると、 OSコードみたいな風になってたらね、 それをOSじゃないや、Xコードが管理してくれたとしたら、 間違いないようなんですか。 という発展をどっちかというと、 遂げてほしい気はしますかね。 なんとなくね。 そういったのすでにあの、 ローカリゼーションではやってんじゃなかったっけ。 えーと、あ、今はローカリゼーションしてないから分かんないや。 日本語とかね、英語とか。 うん。 まあいいか。 とにかくなんかそういったね、 統合開発環境の方でのサポートもしてくれると嬉しいなというのをね、 こうやって複数の管理を、 ないといけないみたいな状況になると普通思ったりするけど、 それはそれでまた難しいところだってね。 Xコードから離れられないというね、 そういった問題も、なんか起こってきて。 まあ、いろいろ難しいですね。 はい、まあいいや。 とりあえず、ランドマークスコマンズのところのリファクタイングできそうなところ、 こんなところを探っていきますが、 構造体でランドマークコマンズでコマンズプロトコルで、 フォーカスバインディング、フォーカスバインディングが、 で、セレクティブランドマーク、これはいいですね。 で、ボディにサムコマンズで、 ガイド側コマンズがあって、コマンドメニューがあって、 で、ラベルが、セレクティブランドマークwithfavoriteでリムーク、 フォアマークが、 これはボタンのラベルのことですよね。 で、それで、まあこの中に入れるにはちょっと長いから素材出してるっていう感じですけど、 お気に入りだったらば、 しかもこれあれか、 プール型オプショナルバインディングでやってるから、 オプショナルテーニングでやってるから、 ルールと比較してるんですよね。 こういったのがね、微妙に、 なんか、面倒だなと、 嫌か嫌なと思うところがあって、 まああんまりほら、 フラグみたいでね、 トゥルーかフォルスだってわかんないじゃないですか。 そういったところがあるから、 これと近くでいうとスイッチブーンでやると、 まあどうなのかな、 まあやってみましょうか。 えっと、スイッチでwithfavoriteかどうかで、 まあ一緒か、 ルールだったらば、 removeですよね。 ケースフォルスだったら、 markですよね。 今回、nullだったら、 もうmarkですよね。 そうそうそう。 あ、並べて書いたらよかったかな。 まあいいか。 ただし重要なところとして、 こう書いたときには、 ルールかフォルス以外の画面が、 残ってるよって話になって、 これはつまり、 オプショナルテーニングなんで、 nilの可能性が残ってますよね。 じゃあnilの場合、 どっちなんだっていうことを考えなきゃいけない状況が、 あの、 突然的に、 明確に作られるってところが、 じゃあnilだった場合は、 えーとだから要は、 お気に入りだった場合は、 お気に入りを外す。 そうじゃなかったらmarkする。 まあnilだった場合は、 選択肢がなかったってことですよね。 なので、 この場合は、 まあ例えば、 nilってね、 書いてあげるとこれで、 nilの場合もmarkにするよ、 みたいなね、 そんな風なことが、 まあ、できる。 で、まあここで考えることとして、 selectedrandmarkは、 これですよね。 オプショナルになってましたよね、 bindingのね。 で、それで、 えーとそれによって、 bindされたものがあって、 ボタンを押すと、 selectedrandmarkの、 hisfavoriteをトップにする。 っていうね、 こういった感じになってるんで、 nullだった場合、 これ落ちますね。 びっくりになってるの落ちるよね。 これだったらこう、 また場合は、 またやnilにしといて、 実際のボタンを押した時に、 なんか、 落ちるってのは、 なんか、 ダメですねこれね。 あの論理的に言ってね、 ダメですね。 なぜダメかっていうと、 想定がちぐはぐってことは、 プログラマー、 今回のが自分ですけど、 把握できてないってことになるじゃないですか。 なので、 こうやるんだったら、 本来は、 ケースnilだったら、 ペータルエラーですよね。 ここね。 うん。 ペータルエラーで、 例えば、 えーと、 ランドマークが、 うーが、 えーと、 選択されていません。 ね。 こんな感じで、 やっておかないと、 ボタンがね、 マークとか出てるのに、 押してみたら、 落ちるとか言ったら、 それこそ大問題ですよね。 っていう風になるんで、 そんだったら、 最初から落とした方が、 利口かな。 まあ落とすの嫌う人、 山越えるんでね。 まあ、 今回の場合は、 そうね、 どうしまったかね。 セレクティブランドマークが、 nilになる可能性というのも、 まあね、 あるのを考えると、 ランドマークコマンドでしょ。 で、 その時に、 リムーブがマークっていうボタンを表示するって、 要は、 セレクトされてたらですよね。 どっちかって、 あのー、 どっちかも何もないや。 セレクトされてたら、 ログルができるわけで、 どうじゃなかったら、 普通ボタンがあること自体が、 おかしいですよね。 なので、 そうすると、 どうじゃなかったら、 普通ボタンがあること自体が、 おかしいですよね。 なので、 そうすると、 IFですかね。 IF、 セレクティブランドマークが、 IFレットですね。 オプショナルバインディング。 IFレット、 セレクティブランドマークだった時には、 ボタンを出すみたいな、 そういった、 あ、 ボタンじゃないよ。 メニューを出すですね。 そういった風にしてあげて、 このメニューの中で、 ボタンがね、 効いてくるみたいな風に。 まあ、 そうするのが、 どうな感じですね。 おそらくね、 おそらくね、 ちゃんと僕が、 そう、 分かんないんですけど、 まあ、これで、 セレクティブランドマークが、 IFレットで、 そうすると、 ここで、 こういった、 見るの状況なんて、 無理やり考えなくてよくなりますよね。 で、 ここもそうですね。 強制アンラップみたいな、 危ないものが抜けて、 あと、 ミューティングじゃなくなっちゃうのか。 なるほど、 ミューティングじゃなくなっちゃうのね。 バインディング、 セレクティブランドマークが、 バインディングで、 えーと、 バーンディングで、 えーと、 セレクティブランドマークが、 ランドマーク、 ランドマーク、 そうだったか。 ランドマークがさらって、 あれ、 ランドマーク番 やっぱり、 社長風に、 今はコンパイルエラーで、 ノンゼロイグジット、 という事になったとね。 これは、やばいですね。 えーと、 えーと、 インサーブルがね、 面倒なんですね。 イグジットコードの、 エラーがね。 で、これで、 ランドマークコマンドの中で、 イグジットで、 コマンドの中で、 えーと、 なんだろうなのに、 入ってないかな。 やっぱり、 エラーがね。 まあでも、 このファイルをイジって、 このファイルエラーが出たところだと、 ご視聴ありがとうございました。 Effette Selective Land Markがあると、 選択チップのランドマークが、 Arifのオプショナル Ктоなんだ。 ええと、バリップ、 赤ですね。 2のランドマークになっちゃいましたね。 そうすると、 Recall Data Selective Land Mark だと、 どうなんだろう。 それと、 Selective Land Markが バインディングのランドマークの、 オプショナルか。 バインディングのランドマークのオプショナル。 Selective Land Markこっちは、 えーと、 エグジットコードの、 あれ、 エグジットコードの場合ですね。 バインディングランドマークの、 オプショナルですね。 バインディングランドマークのオプショナル。 バインディングランドマークですね。 ってことは、バインディングランドマークのオプショナル。 そうすると、で、この連結、 えーと、ここの、フォーカスドバインディングの動きが、 自分が把握できてないですね。 これは真っ黒じゃないのか。 展開がなさそうですね。 そうすると、んーと、 プロパティラパーか。 プロパティラパーとすると、 言うてきは例えるとして、 Dynamic Propertyで、 Key Passをイニシャライザーに渡して、 で、Wrapped Valueと、Projected Valueが、 バインディングのバリューのオプショナルですよね。 オプショナルになっていて、Focused Bindingの中身がオプショナル。 中身がオプショナルか。 で、ここは、えーと、中身がオプショナル。 そこには、バインディングで、バインディングされている 中身はとてもしょうがなくて、その中、これを使いたいわけですよね。 そうすると、バインディングの中身がオプショナル。 なんでオプショナルなんだろう。中、とてもオプショナルでしたよね。 もう一回、その観点で見てみますか。 えっと、これを見ると、バリューでしょ。 で、それで、Wrapped Valueがバリューで、 なぜかオプショナル。 New Property Wrappedは与えられたPathで、 えーと、Focus、Focusをパスす。 違うかな。わかんなかった。 とりあえず、じゃあ、そうすると、 えーと、Focused Bindingランドマーク、 エレクティックランドマークで、 New Valueと、これで、バインディングランドマークを 入れたり入れなかったりですよね。つまりね。 えーと、でも違うかな。 Wrapped Value、もう一回やってみよう。 例えますかね。そうすると、Wrapped Value、 これがオプショナルでしょ。 だから、バインディングしていない可能性ってありますね。 そう考えると、ここがオプショナルである 必要ないのかな、もしかして。 そうすると、ここで、キーに値がないっていうね、 そういった可能性が出てきちゃうのか。 うん。じゃあ、オプショナルは難しいですね、これね。 えーと、そうしますと、考えられることとしては、 まあまあ、一番楽なので、オプショナルバインディングは使わない。 これで済んじゃうんですけど、それでちょっと、 今ね、あんまり飲ませたくないなというのは、 まあ、ちゃんと、なんか、端的に、あの、 最短距離で理解できてないなというところだって、 それでちょっとね、今、いろいろ試作をしてるんですけど。 なんですけど、だからバインディング、 オプショナルバインディングで得たやつは、 えーと、ドラワーバインディング。 そうだね、だから、ドラワーバインディングでやって、 ひとまずバインディング取りますよね、こうやってね。 で、セレクティブランドマークは。 ここが、なんか、もうとけちゃいますね。 バインディングがね。 セレクティブバインディングはvineинг ブランドマークのオプショナル。 ですよね。 あ、でこれ、セレクティブランドマークは オプショナルじゃないのか。 ドラワーセレクティブランドマーク。 あ、そうなのか。 セレクティブランドマークは。 ドラワー、セレクティブランドマーク。 ドラワーじゃなかったときは、これは、 セレクティブ単トマク、 もうガチでダメかな? オプショナルだ! オプショナルで、 それが欲しいのじゃなくて、バインディングが欲しくて、 バインディングでランドマークのオプショナル。 で、このときにバインディングが オプショナルじゃないっていうね、そういったところが 一つポイントですよね。 なので、ばか、バインディングが オプショナルじゃないという事は、それに対してやっていけばいい ってことが、バインディングが取れてるんですよね。 取れてるけど、なんでオプショナルじゃないんだこれ。 Focus to Binding、で、セレクティブランドマークですよね。 これはNilが入れられるとかですよね。 バインディングにした場合に、なんでオプショナルじゃないんだこれ。 えっと、もう一回見てみますわ。 これが、Dropped Valueじゃなくて Projected Value、ホントだ、オプショナルじゃないですね。 Projected Nil、The Unlocked Value is Nil、No Focus to Uphideral Key、 そうですね、フォーカスでなければNilですよね。 Dropped Value、あ、ドロップドバリュー、中身か。 中身だからオプショナルなんで、 っていうことは、この中身がNilかどうか、 それによっていろいろやっていくということになるということは、 セレクティブランドマークを素直にランドマークとして取り出して、 それ出せたとしたら、ラベルはランドマークノイズフェイバリットによって変化して、 それでボタンが押されたときには、ここのダラーですかね。 セレクティブランドマーク、あれこれミューティング? ミューティング。 セレクティブランドマークはフォーカスでなんたらかんたらか。 でも今のでフィルト取ってましたよね、これね。 F分にしてなくてハテナにした場合よね。 これハテナなら取るのか。セレクティブランドマークはこれで、 セレクティブランドマークってオプショナル、 バインディングされている実際の値がそれじゃのか。 だからこれ、ダラーにして、ラベルにして、 ノイズフェイバリットとグログラでダメなんだ。 これがダメなのが何だっけ。セレクティブランドマーク。 それがオプショナルの可能性があるから、 オプショナルじゃなかったらグログラをするっていうことだ。 私今オプショナルじゃないってことが分かってるっていう状態ですよね。 このセレクティブランドマーク、セレクティブランドマークっていうのは、 これでバインディングされているという状況になるので、 やるとするとダラーをセレクティブランドマーク、 イツフェイバリットができないってのは、 これもオプショナルだからな。 バインディングの中身がオプショナルだということは、 バインディング。 イニシャライザで面白いのがあったかな。 バインディングでオプショナルのものを、 目の方かな。 例えばこれをバインディングとして、 セプトダラーバインディングでイツフェイバリット。 このときにバインディングをISS forkに変換できるだけか。 チック、せべり、せっかなどによると変換できない。 バインディング、ランドマークがあって、バインディングのタイプだけでこんなふうにすることになります。 ここからバインディング、ランドマークとセンダーベル。 バインディング、ランドマーク、バインディングとセレクティブランドマークがある。 ここからセレクティブランドマークじゃなくて、ランドマークのisFavoriteトークルが、 センダブルとダイナミック、リムーブ、ダイナミック、なんかちょっと違うかな。 ランドマークのラストバリューか。 これちゃんと動くのかな。なんか不安を感じる。 動かしてみますか。Mac OSで行きましょう。 これでメニューの中で選択した状態でトークルができるかですね。 これを見てみて。 これですね。選択した状態でメニューのランドマークの中からマークはisFavorite。 動いた。動いた。いいですね。 選んだ状態でランドマークがリムーブ。 もう動きますね。手もいっぱい。マーク。いいですね。 選択がない状態でメニューができれば、 あ、いなくなった。すごいすごい。いなくなった。 そんなにいなくなったら大丈夫かなという不安があるけど、 ランドマークはいてほしくないっていう気がした。今。 ここの根元はほしいですね。だから根元は外に出して。 これでいいのか。またインデッド空れればいいんだ。 押してあげて、実行して。これでいいんじゃない。 で、ランドマークいって選択ない状態だと。 また選ぶのでも何も出ないというのがびっくりしますね。 これはこれで問題ですけど、選べばランドマークの中にこうやってやって、 選ぶと星が入る。いいですね。 びっくりさせちゃうのが問題ですかね。 あとはここからスイッチ分までいらないですよね。 普通に。2択なんだったらリムーブ。 あとはマーク。で、これでスイッチ分は出ようねと。 これでよく打て。 あと考えられるのはこのボタンですね。 トグルフェイバリットボタンみたいなのも作らなかったっけ。 えーと、トグルフェイバリットボタン。 あ、でも違うのかな。メニュー用とね。 トグルはっていう関係だと思ったんですが。 フェイバリットボタンか。これちょっと英語見ると。 BindingされてIsSetがあってBodyとボタンでIsSetがトグルされて、 選べるはあとがスタイイメージか。 スタイイメージによって分かれるから、 これとほとんど一緒のフリになっちゃうけど、 同じにするわけにはいかないって感じですかね。 なるほど。 そうすると、メニュー、トグル、フェイバリットメニューなのかな。 フェイバリットメニューを作ってみますかね。 あと同じファイル内で作ってみますか。 同じファイル内で流し出ていい気がしてきたから。 プライベートエクステンションでランドマークスコマンドね。 それになったらストラクト、 ミニコマンドでフェイバリットメニュー、 メニューアイテムかなっていう感じにして、 これをサム、ビューなのかな。 ミニコマンドメニューは中身どうしてるんだこれ。 中身はコンテント、ビュービルダー、 コマンドコンテントがビューなんだ。 フェイバリットメニューアイテムが、 つまりサムビューで、それでこのボディですよね。 これはボディね。 ボディはサムじゃないや、ここがビューですね。 これでボディとんどん。 このボディの中でこのボタンを、 ランドマークがあった場合には表示するので、 ここをたっぷり持ってきて、 それでバインディングでランドマークを持たせる。 カットバインディング、プライベートセットバー、 ランドマーク、でランドマークですよね。 で、こうしてあげると、ランドマークのラッグバリュー なんてものがいらなくなり、と思ったんだけど、 ここがいらなくなってる。 カットバインディング、プライベートセットバー、 ランドマークのランドマーク、 マスコンテストアドプロパティー、 あ、違う違う、ここじゃない。 ずれてますね、こっちですね。 いいですね。 これでランドマークのisFavoriteを入れられるでしょ。 ディスウェーブルがセレクティブ、 ランドマークがニルだったとき、 これはここじゃないですね。 これは外ですからね。 つまりこのメニューの中でフェイバリットメニューアイテムで、 ランドマークとしてランドマークを渡し、 ディスウェーブル、あ、ディスウェーブルか。 ディスウェーブルがあるってことは別に、 あら、でも良かったですね、本来はね。 ああ、それでモブリューしてたんだ。 なるほどね。 どうしようかな、どんなパッドブルとかね、 ニルのときも名前を設定してやってたのは、 どこかを落としちゃダメだったね。 そうするとグレーのときに落ちちゃうんだ。 だからあれはあれで精一杯? 無理があるんじゃないかな、つまり、論理的に。 うん。 あとしたらこうやって表示させないか、それとも、 まあまあそれでいいかな、表示させない。 で、これでボタンがこう分かれたでしょ。 で、それでも一回この状況で一回 動かしてみましょうか。 そうすると、私はディスウェーブルいらないじゃんね。 表示されないかもね。 なので、この状態でランドマーが何も出ないよ。 で、何かを選んだとき、ランドマーが出てきて、 まあ、使うとフェバリッと動きますね。 大丈夫ですね。 そうするとディスウェーブルがいらない代わりに、 消している。うん。 これでいいのかな、ワインディング。 それで一着押しましょう。うん、できた。 さあ、こうするともう1個得られるところとして、 ここでランドマークのラベル、これを作ってますけど、 これフェバリットメニューアイテムなので、これのタイトルとして持たせることできますよね。 ストリングにして、このタイトル、フェバリットメニューアイテムのタイトルは、 このランドマークのね、ディスウェーブルに応じて変化しますよ、 っていうコードにしてあげれば、ここでもういきなり素直にタイトル使えますよね。 こっちの方が分かりやすい。 これを別のパターンに切り出していなかったとすると、 このタイトルっていうのを作るわけにもなかなか難いところがあるんですけど、 フェバリット、要はね、ランドマーク2コマンズのタイトルとかやるとね、 まぁどこのタイトルのことなんだっていう、そんな話になってるんですけど、 フェバリットメニューアイテムのタイトルって言ったら、 もう明らかにこのアイテム用のタイトルなんで、 そしたらお気に入り状態によって切り替えて、何も問題もないっていうのを搭載できるようになった。 これが搭載できれば、あとはボタンが簡単に表示できますよね。 タイトルアンスフェイバリットか、まあいいか。これ別れていきますかね。 今の中で、いい感じに大体結果ができた気がしますね。 やってみると結構簡単でしたね。ただ、このバインディングでキャストするっていうところが一つポイントになっていて、 中身がパラッポの可能性のあるバインディング、要はオプショナルパターンを取るバインディングは、 それを取らないバインディングの全体をオプショナルにするっていう変換イニシャライザーがある。 右を見ると、バインディングのエクステンションで、 オプショナルを取るやつはオプショナルを取らないバインディングを自分自身に変換して、または失敗する可能性がある。 このイニシャライザーを使って、オプショナルの可能性を外側に回した。 それによってオプショナルバインディングが効くようになって、オプショナルバインディングの結果、適切なバインディングが取れたんだったら、メニューアイテムを表示しましょう。 これでメニューOKですね。次、ページコントロールいっておきますかね。 ページコントロール1個くらいいけば十分かな。 iOSのページ名はiOSだけみたいね。 これで、ページコントローラー、ビューコントローラーと、UIキットとの連勝の時にやったやつですね。 バインディングで書いたページナンバーをページナンバー型でバインディングしている。 これもプライベートセットにしたいかな、今のところの価値観ではね。 このページナンバーって要は中身はintなんですけど、 なおな、intをラッピングすることによって、ただの数字なのか、ページナンバーなのかをはっきりと分ける。 今回、遊び手ではありますけど、最初のページを1としましたよね。 でも、普通のインデックス操作って0から始まりますよね、配列ね。 なので、配列のインデックスとページ番号を取り間違えちゃうと厄介なんですよ。 こういったような時に、同じintしか取らないだけでと、別の型に定義することによって、型安全が働くようになって、 同じ値であっても、取り替えることがなくなるよっていう実装をやったっていうね、そういった感じですね。 これは、コーディネーターでコーディネーターでオーナー、で、これはね、セイトUIのチュートリアルやってるときに1回、 セルフ渡すのおかしいだろうって言ったけど、 セルフ渡した場面とバインディングがね、新しいビューに更新されないってことが分かったので、 セルフを渡す方が適切だという結論に今のところ至っている。 なので、素直にオーナーを渡してコーディネーターを作っている。 で、MakeUIビューコンテンツ、これは普通にURPGコントローラーをパイスにして、 コントロールはバブページと設定して、ターゲットアクション、これを使ってアップデートカレントページをね、 コーディネーターに対してはアップデートページアクションを搭載したと呼び出して設定をしたと、バリューが変化したときに、 そうですね、コントロールのバリューが変化したときに。 これでOKで、逆でUIビューは更新のたびにカレントページを更新しているからオーナーを書き換えれないね。 オーナーを書き換えれない。オーナーはページコントロール。 これ書き換えないとダメじゃない。 オーナーを書き換えてカレントページをカレントページナンバーのオフセット、 オフセットは0から始まるやつにする。 これでやらないとダメじゃないかな。 なんでコメントアウトしたんだろう。 さっき言ったね、バインディングが更新されないような問題。 それの問題、これMacOSじゃないですね、やるのね。 iOSでページコントロールですね。 だからiOSシミュレーターでチェックしないといけない。 やってみましょう。 何かコーディネーターのオーナーを書き換えないと、 アップデートした後のバインディングが壊れるんで、 これが重要ですよね、おそらく。 これで壊なくなるのかな。 まあならないと思うんですけど。 シミュレーターはこれか。 今はビルドランニングランドマーク4OSで、 ランドマーク4iOS、 どれだ、iPhoneで、iPhone17Proくらいでここでいきましょう。 iPhone17Pro、これが今ビルド中ですけどね、立ち上がるはずなんで。 画面サイト、これか。 こうしてiPhone17Proを使っているから、16位はとりあえずいいかな。 iPhone17Proだったら、何人でしたっけ、メニュー。 ページコントロールか。 ページコントロールがちゃんと動けばとりあえず、 謎にコメントアウトされていたのを復活させて 解凍だったというね、といったことになるんで。 でもなんで、セルフオーナーオブジェクト、 オブジェクトではないか、ビューを更新するのをやめたんだろう。 実験中のまま残っちゃったんですかね。 何のためでしたかね、前ね。 とにかくここ、何だっけ、ページコントロール。 ここというか、とにかくこの点々のほうですね。 これがちゃんと動きますよね。 あっ、遅れた。 これこうね、ああ、クリックした。 これでね、スライドして動いてますね。 で、クリックすると戻ったり、進んだり。 だけどですね、良かった。 ではやっぱり、このコーディネーターのオーナーを 書き換えるは、アップデートUIビューではやばないと、 さっきも言った通り、バインディングが古くなっちゃうんで、 これは重要でしょ。なのでこれでOKですよね。 で、それで、あとはそこまでか。 ページコントロールの中にコーディネーターをNS Object形成した形で、 メインアクターをここで打ってあげて、 そのオーナーがね、さっきのページコントロールですよね。 で、これは代入する必要もあるので、 ここで書き込み管理してるけど、 書き込みからこれインターナルにオープンするの嫌ですね。 プライベートで。これで良いですよね。 コーディネーターはこの中でしたね。 使わないはず。ビデオビデオしておきましょうか。 買ってた。買ってた。 ページコントロールのページコントロール。 これがページコントロールiOSで、 持ってはこんなデファレですよね。 で、プライベートエクステンションを貼ると、 あれ?プライベートエクステンションを貼った時に、 ページコントロールコーディネーター。 あ、そっか。オープンになったんだ。 なるほど。 UIPよりプレゼンタブルがコーディネーターを要求しちゃってるんで、 中で使うとってもトップリックじゃないや。 破壊されちゃうので、プライベートじゃダメということで、 このコーディネーターがガタガタすると考えられることは、 えーと、ここが普通のエクステンション。 良いですね。 これで、オーナーへの書き込みがファイルプライベートですかね。 これだとエラーですよね。 で、ファイルプライベートセット。 こうした方が良いですね。 そうすることによって、オーナーを勝手に 書き換えられるということはなくて、 このインターナルでファイル内。 このファイル内ではどこでこれを呼び出すかって言ったら、 TwistUIのViewが再評価されたタイミングですね。 これで良いですね。 それで、イニシャライザーでオーナー。 これもガタガタ公開されているけれど、 イニシャライザーは内部でしか作らないので、 ファイルプライベートが適切ですね。 それでOKでしょ。 で、あとはアップデートカレンドページは、 オトゥーブジェシーですね。 アップデートカレンドページも、 ここからしか呼ばないですね。 ファイルプライベート。 これで良いですね。 全部ファイルプライベートでしたね。 ファイルプライベートはただエクステンションする わけにもいかないんでね。 ここは行けますけど、アップデートカレンドページは エクステンションで行けますが、 でもそのためにやるかな。 まずやってみますか。 プライベートエクステンションで ページコントロールのコーディネーター。 で、このコーディネーターに対して、 この型、型じゃない、メソッドをね、 搭載してあげますよっていうね。 で、これでファイルプライベートいらないようですよね。 イニシャライザーはこれ欲しいですよね。 だからこれであまり分ける意味なかったですよね。 何にしてもこれでビルドが通るんでしょうから、 これでOKですね。 うん。 ではこうすると、見学とは良い感じだと 思ってはないでしょうか。 ページナンバーが。 これはまあまあ良いですね。 うん。 で、ページナンバーぐらい見ておきますかね。 ページナンバーはさっきもちょろっと変わりましたけど、 要は中身のバリューはイント型。 つまり今イント型と同じデータコードのなわけなんですけど、 イント型を区別してこうやって構造体をね、 定義しておくことによって、それで、えーと、普通にね、 型安全を狙うことができる。 イント型と、このページ番号等を混ぜてしまったり、 取り違えたり、そういったようなことをするために、 こういったシンプルな構造体を作ることは、 自分はよくやる、そういったパターンですね。 場合によっては、両方リプレゼンタブルにして、ローバリューで持たせてね。 ローバリューはこれなんだけど、そういったネイティブ的にはこの構造体ですよ、みたいな。 そういったふうな定義をしますが、今回のページナンバーはね、 えーと、まあこのままでいいかな、ローバリューみたいなね。 ちょっと大げさなのでなくて、本当にズバリバリ。 それで、バリューを定義、イント型で定義することができるよ、 っていう風にして、代償比較もできるようにするような。 とにかく必要か、これエクステンションで分けてみましょうか。 エクステンションページナンバー。 で、これがコンペアラブルで、エクステンション、エクステンション、エクステンション、 ページナンバー、そうですね。 これで代償比較可能という定義ができていって、 さらにページナンバーのディスクリプション、ここスペースときますか、どうでもいいんですけど。 文字列表示はそのまんま。で、ページナンバーの ディスクリプションはちょっとおまけ情報が入り、 インテージャリテラルからの変換は自分自身のイニシャライダーを使って変換して、 ページナンバーのアピリバリズメティックで出し算引き算できるようにして、 ページナンバーを拡張してスタートは必ず1から始まるよ、 っていうことを明記して、で、0から始まるオフセット。 これを使ってページを一緒化することもできるし、 0から始まるオフセットで内容物を取得することもできるし、 ネクストで次へ行けるし、プレビアスで前へ行けるし、 ネクストはミューティングファンクでネクストの中に置き換える。 ネクストの中に置き換えるって効率悪いかな。 ネクスト、インテージャル、ミューティングファンクか、ミューティング。 ミューティングファンクってことはセルフがあって、 これセルフのバリューに出した方が早いんじゃないかなっていうね、 そういったお話ですね、今はね。 ネクスト、ページナンバー、ページナンバーを取って、 ローカライズドストリングキー、ローカライズドとか、 これ何だっけ? ストリングインターポレーションに、 ナンバーを直接渡せなくなるって、そういう話ですかね。 ビルドが通っちゃった。ビルドが通った。 ビルドが通った怖いから復活させておいて、 ページナンバーを押して、あとに僕はここを見ておきます。 ストリングディスクライビングでページナンバー。 だから自分自身をストリングディスクライビングをする。 ストリングディスクライビングをやるってことは、 すなわち普通にストリングインターポレーションで文字列を渡したのと同じですね。 なるほど。まあでもいいか。 これ残しておいて、ページナンバーでストリングインターポレーションしそうなところ。 どこだろう。ページナンバー。ページナンバーは、 ストリングインターポレーションしそうなところか。 ここで文字列を渡すときには、どこだ。 ソースコード。これだ。 ストリングインターポレーションでストリングディスクライビングだから、 普通に文字列をオープンで自分自身を置いたのと、 何も変わらない状況になってきている気がするんで、 どうしようかな。あとはページビューかな。 あるとしたらページビューが、 カレントページナンバーがありますよね。 カレントページナンバーがラベルで使われるのかな。 ラベル。ページコントロール。 あれじゃないか。ページビューコントローラー? コンテンツ。あ、ここだ。 これは普通の文字列ですね。 さっきのカレントページナンバーが、 インターポレーションで使われるというのが、 ローカライズブキーだったんで、 これはテキストに対してですね。 なので、テキストの丸カッコで。 ここでプレコインを探せばいいな。 ページ番号。ページ番号はどこだろう。 ページ番号ランドマークではなくて、 ページ番号はどこだ。 ページ番号っぽいのか。 あっと見、ざっくりと見た限りでは見つからなかったですね。 これでも見つけるの苦手でね。 自分は正規表現で頼んでみました。 正規表現にして、テキストで丸カッコまではいいでしょ。 テキストで丸カッコの後に何らかの文字が続いて、 ページみたいなやつ出てこないですね。 これで出てこないから問題ないのかというと、 そうでもない可能性もありますけど、 インターポレーション使ってないのかの、 ページ番号を表示する可能性のある場所っていうと、 えっと、ページ番号ってそもそもなんだ。 ページ番号は、あ、そっか、このページコントロールのこっちですね。 あれを文字列化するなんてことはない気がしますね。 なので、そういう感覚で行くとページナンバーに、 ローカライズドストリングキーのインターポレーションは いらないということになるような気がするな。 あったところでね、 差し支えるほどの不突のコードを書いてないので、 まあいいか、これでっていう感じが起きてきた。 ちょっと無駄な感じはするけど、100%で無駄って言っても、 こういう風変的なところは、ローカライズドストリングキーはページナンバー。 こういったところは、残しといても特性にそんなに影響しない。 これ使ってるのかなみたいな視点で見た時には かなりのレビューコストが上がってきますけど、 そんなことしなければ、パクを生むとも思えないし、 生むこともあるかもしれないですけどね。 そうすると、全部ページナンバー周りが、 カードとかネクストとかプレビュアスとかは最適化を図るとすれば、 内部のバリューに着線が働きかける。 ネクストやプレビュアスでもやればいいんでしょうけど、 ネクストプレビュアスじゃないですね、ムープネクストですね。 こういうところでやればいいんでしょうけど、 そこまでは求めなくていいでしょう。 はい、じゃあこんなところでOKですね。 じゃあ時間いい具合なのでこれぐらいにして、 また次回はこのページビューのところを見ていくというところから、 やってみようかなと思います。 はい、じゃあ今日はこれで終わりにしましょう。 お疲れ様でした。

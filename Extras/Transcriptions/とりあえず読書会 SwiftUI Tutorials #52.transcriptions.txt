Transcription & Summarize : とりあえず読書会 SwiftUI Tutorials #52

はい。では、とりあえず特集会をはじめて行きましょう。 ドイツといわゆるイシュートツリーのような日を見つめておりまして、 それで、まあ、ここで終わって リファクタリング チェックみたいなものですね。 そんなものをしながらやっているところですが。 まあ、リファクタリングって、きれいにコードを擦るってやつですけど それをきれいにできるとかあんのかな、みたいなところは だいぶ、きれいにできているような気がするので その辺りを撮っていきますね。 この辺りってのは、どうするところかないかですね。 見てみるとここですね。 PTTのところから これ、iOS。この辺はiOSですね。 なので、プレビューをちょっと動かしつつ プレビューを進めていきましょうね。 それで、このコードをちょっと眺めていきましょう。 あれ、なんか、プレビューが、エラー というか、ビルドエラーが出てますね。 ビルドエラーを先に直さないと なんか、よろしくなさそうですね。 なんだろう、でも、書いてましたっけね。 エラーね。 うーんと、まあ、まあ、ビルドすれば わかるんでね。 ゆっくりと、やっていきますが エラーのこの、うーん ビルドの中のコードを見ればね、わかるんですけど うん。 ビルドして欲しいですよね。 では、OKですね。 プレビューきっと動くでしょう。 で、その間に ちょっと私、これ見ていきますが HTTPは、ページがあって で、それで、パレントページがページナンバーでね スペットとして持たれている。 で、このページナンバーは前回言いましたけど 内容は、純粋なイントが多い子だけしか持っていないので イントでね、作ってもいいわけですけど ここで、あえてね、ページナンバーを あとして定義することによって ページナンバーなのか、インデックス番号なのか っていうのをね、混ざらないように注意している。 特にSwiftのプログラミングでは一般的に 最初は0ページ、次は1ページみたいなね こんな風に扱っていく。 実際、UIページコントロールがそうですよね。 そんな感じではあるんで 簡単にやろうと思うんだったら ページ番号はね、普通に0から始まればいいんですけど 人間は1ページから始めるじゃないですか。 なので、今回はね 1ページから始まるページ番号を それを使いたかったんで そういう風に設計をして これを作った最初の段階で よくね、インデックスとページ番号を 混同しちゃうみたいなことになったんで こんな感じで作ったと思うんですよ。 実はこんなもんないですけどね。 なので、それで リフトタイムがすぐに終わっている状態で このページ番号というのが存在していて こんな感じですね。 イニシャライザーはページが 何らかのシーケンスのページがあるのを ページ図にアレイでね、保存するよっていう形にして これは悪くないですかね。 アレイにしての順番を保持したいっていうのも まぁ、あるのかな。 ありますね、確実にね。 1個目の要素が1ページ 2ページ目が2個の要素でね そんな感じでやってるんで アレイが適切ですよね。 まぁ、それでうまくいくので 良いんですが それにつきますかね。 あとは何かページの配列を 必ず1ページ以上持つような 形にするという手もあるかもしれないですね。 このページはどうやって使っているんだろう。 えーと、相振りが大変な目になってしまった。 えーと、これで このページのイニシャライザー 読んでるところないのか。 えーと、こっちは こっちはあるけど これはとても良くて 見つかんないですね。 ページの初期はどうしているのかな。 えーと、メインコンテンツは ランドマークアップの中の それのコンテンツだけど モデルデータですかね。 モデルデータはページ あ、違う。モデルデータはページ 別に持ってないですね。 そうするとコンテンツビューですかね。 コンテンツビューで コンテンツビューは いろいろ持ってはいるものの 中にはないか。 その中でカテゴリーフォーム ランドマークリスト ページはカテゴリーフォームですかね。 でその中で、ページを作ってるページ ビューでページがページガスカードですね。 ページガスカード。 ページガスカードは SLIPが何語かあるかが 知られると思いますが、 スペシャルベースブースではPublic決めの ゲームの sweaterにも そのような containerを 注意して受けます。 Pagersカードですね。ページガスカード だから俺は作って いて このフェチャカードはフェチャカード の配列になっていてフェチャランドマークスで これでエンドフェチャランドマークを バインディング Kollick ます。バインディングプラっていて エンドはビンディング上で鍛台の ランドマークスで、ランドマークスがバインディング そうですね。こうなってるのをね。 なので、必ずページは1個以上なきゃいけない というのを肌で保証しようと思ったんですけど、 これを保証しようとしていくとランドマークス まで行っちゃいますね。ランドマークスまで 行っちゃうと、ランドマークスの配列なんでね。 必ず1個はないといけないという制約が 邪魔になる可能性が出てきますね。 そうすると、プレコンディションでやれば いいんですかね。ただ一つ、今ところ見てて 思ったところとして、ページコントローラーが ここですね。ページビューにフェイチャーカードを 渡してるんですけど、これがゼロだったときって 落ちるじゃないですか。プレコンディション フェイラーでね。プレコンディションで。 なので、これチェックしないと、 本来いけないですよね。渡してはいけないんですよ。 他にゼロ個を。何にチェックしてないですよね。 これヤバいですね。ちょっとね。 なので、チェックをしないといけない。 フェイチャーカードの方で、ゼロ個以上 保証するっていうのも、悪くはないですけど、 結局落ちますよね。ここで1個以上なったら。 これを仮にオプショナルにして、1個以上 得られなかったら、2秒で返すっての穴が 変ですよね。穴を返せばいいだけなんでね。 なので、フェイチャーカードはそのまま 触らないとなると、触るべき場所は ここ、ページビューですね。なので、ページビューが フェイチャーカードが空っぽだったら、 これやっちゃいけないですね。 ページビューの表示をね。そもそも。 そうなのですが、フェイチャーカードが 全く無かったとき、ここどうなってるんだろう。 このバックグラウンドの角。 フェイチャーカードリストがあって、リスト、リスト。 これを見ていきますが、 ページビューでのこれなわけですよ。 これ。動くやつ。 なので、これがゼロだとね、どうするの? っていう感じになっちゃうわけで、 これが、ページビューを4E1でカテゴリと から、ページビューがこれだ。 なので、ページビューのところへ行って、 あ、そうですね。ページビュー。 これですね。っていうことは、ページビューで 1個以上が必要ですよって制約をかけているんで、 だから、この1個も無かったときの タブロックさえ無い状態のときに、 これどうするの?って話になってくるんで、 ページビューで、なんかいろいろと 頑張るよりは、APIも表示させないで 良さそうですね。 なので、これで、レッドフェアカーズ、イコール。 これで大事になっていいのか。 なので、 フェアカーズ。 フェアカーズ。 フェアカーズ。 エンプティー。 いつもこの字幕で書いちゃいますが、 エンプティーではない時ですね。 エンプティーではない時に、 ページビューを表示するよというね。 こういった風にしないと、コードはよろしくないですね。 落ちる可能性を、つまりは、 アイアイルスとかエピカードとかですね。 こんな感じ。 仮にこれがパラだとする。 こうやってパラだとすると、こういう風にね、 ページビューが表示されなくなる。 これでいいわけですよ。 落ちるよって、全然いいというか。 あとフェアカーズもいらないじゃないですかね。 フェアカーズと並べはどこだ? フェアカーズはリストで、トランスマークがカテゴリーでリストのタイトルかな。 これですかね。ナビゲーションタイトルかこれ。 こんなの読みますね。 フェアカーズ。 フェアカーズで、ナビゲーションタイトルにフェアカーズって付いてるんだったら、 こうですかね。 ここナビゲーションスクリプトビューの、 そのタイトルに書いてあるんでね。 カードがあろうと無かろうとフェアカーズ。 なんかちょっと変ですね。 こういうのかな。本当かな。 まあまあ、でもいいんでしょうかね。 あと考えられるとしたらフェアカーズが無かったときに、 別のタイトルに変えるからですよね。 なので、これでいいですね。 フェアカーズいつエンブティって今書いてましたけど、 この辺なんかちょっとややこしいじゃないですか。 なのでこれは、パーで、はずフェアカーズですかね。 はずフェアカーズカード。 はずフェアカーズでいいかな。 これでルール誤解するようにして、 これで判断をさせてあげると、 はずフェアカーズを読めばこういうことするよ。 まあそんなことね、中の処理をどうするか考える必要なく、 フェアカーズを持ってるかフェアカーズにしようかな。 フェアカーズを持ってるかという風にするようにすれば、 ここでif文が普通に、 if初、フェアカーズ、これでいいですよね。 こういうのがいいですね。 まとめたのには、単純にフェアカーズがあるんだったら、 ページBを表示するよっていうね。 フェアカーズを使って横頬との読み方ができるもと一緒に、 こっちのタイトルも楽に切り替えられるなと思って、 今ちょっと作ってみた感じですね。 はずフェアカーズだったらフェアカーズにして、 そうじゃなかったら、 例えば普通にランドマークスみたいな風にしてあげる。 そうすると、仮にフェアカーズが何にもなかったとき、 例えば判定させますが、 この時はタイトルが、あれ変わらないか。 今読んでみてですね。これがランドマークスに変わる。 こんな風にすれば、違和感が少なくなってきて、 いいじゃないですかね。 今、条件1個だけ引っ掻き返しましたけど、 はずフェアカーズが仮にフォルスになったと仮定すると、 ランドマークスになって、LXみたいな、 こんな風なグループで分けて表示されるよ。 もう見えるよ。これでいい気がしますね。 これによって、エラーが不必要に起こる。 リファクタリングができたということになりますかね。 こういうの結構重要ですよね。 プレコンディションを張ったからには、 設定状況を満たさない、 ジックオープンスを作っちゃいけないのが理想論のはずなんで、 その理想論に基づいて今頑張ったという感じですね。 最初の時はやらないですね。あっていいんですけど、 自分は入れがちなんでね。 ボディがあって、Zスタックでページビューコントローラーがあって、 これがZスタックでページビューコントローラーがあって、 ページコントロールがあって、おしまい。 他細かく分けなくても大丈夫そうですね。 背景があり、それに重ねる部分がありという感じなので、 分けたときはあげてもいいですけどね。こんな感じでしょう。 CGフロートでページのカウントを18倍したものを渡している。 これは普通の計算か。ページカウントの18倍の幅。 これか。これね。ページコントロール。 これはこれでいいのかな。ちょっと分かりにくい気もしないでもないんで、 これが何やってるのか。ちょっと書いてみましょうか。 だから、ページコントロールwithみたいなふうなプロパティにすれば明らかですよね。 それで、ページコントロールwith。これで、CGフロート。 ダブルにしたいな、個人的には。 CGフロートとダブル。 CGフロートとダブルは、あれ? あれ?いいんだっけ? ダブルにして渡せますよね。 普通にね。大丈夫ですよね。 OK。ここが幅指定のところが。 CGフロートですよね。 ここでは、CGフロートを、ダブルとCGフロートを相互変換が暗黙でできるという、 なぜか珍しいスイッチフロートのパター変換の特例ですね。 なので、これを使ってダブルに寄せていく。 別に寄せなくていいんですけど、これは個人の好みですね。 一般にスイッチフロートの不動詞をスイッチフロートとダブルで扱うので、ダブルにしているよ、というわけですね。 こうすることによって、ページコントロールの幅は、ページコントロールの幅ですよ、という感じで。 じゃあ、それは何なのかというときに、始めページのパウンドに18枚しか持っていないというふうに分かるので、OK。 この辺、ちょっと、なんか、ごちゃごちゃしてはいますけどね。 でも、これで大丈夫な気がしますね。 じゃあ、プレビューか。 プレビューは大丈夫ですね、普通にね。 ここは、フェーチャーカードを作っている。フェーチャーカードを誰か作っていましたよね。 フェーチャーカード、フェーチャーランドマーク、モデルデータ、パインディングランドマーク、フェーチャーカード、そうね。 テストのために、わざわざモデルデータに共通化する必要はないですね。 見覚えはありますけど、モデルデータから作れるので、一気に作ってもいいですけど、モデルデータの中でフェーチャーカード。 まあまあ、あっても、長い形だけどね。やめとこう。これでいいですね。 じゃあ、これで、PageViewができたので、次、PageViewコントローラーのリファクタリングいきましょう。 PageViewコントローラーは、UIPコントローラーリプレゼンタブルになっていて、ページをレッドで持っていて、バインディングで、 他何回もちょっと言ってますけど、推奨の言語的にプライベートセットが欲しそうだよね、ということなので、 本当にそうか分かんない人はまた、電話つけておこうという形でやってますね。 それで、ページナンバーがあって、イニシャライザー、ページ図、ページ、えーと、ここでは配列で取るんだ。 あー、なるほど。うーんと、まずはあれですね。使ってないからいらないんですけど、 Init、Pages、Sum、Sequence、で、Pageとして、Current、Pageナンバーとして、Binding、で、Pageナンバーですよね。 というふうに作っておいて、Self、Init、Pagesは、アレイのページ図、で、Current、Pageナンバーが、 えーと、他にも出た、Current、Pageナンバー、Current、Pageナンバー、Pageナンバーの場合かな、 で、これで、いや、そんなこともないか。やっかりだったからいや。 まだだってね。ここが間違ってたのか。これで、Bindingで止めたらこうですね。 で、これで、Pageナンバーが渡せていない。Binding、Pageナンバー、Current、Pageナンバー、Binding、Pageナンバー、ナンバーね、これね。 はい、これですね。これはさっきのPageコントロールと、PageViewとインターフェースが不揃いだったからですね。 ただ、ここは、Sequence渡し忘れてたのに、今、こっちはSequence渡しなかったので、Sequenceも渡せるようにしたというただ、それだけですね。 で、そうした上で、ここでまた、PreConditionがありますね。 PreConditionがあるので、Pageコントローラーを気にしたいわけですけど、これは、PageViewにありますかね。 PageViewですね。PageViewコントローラーにページ渡しますが、この時もページ数はね、必ず1個以上ということだ。 PreCondition、イニシャライザー内で使ったPreConditionによって約束されているので、他のページ数は絶対に1個以上。 ということは、Pageコントローラーは絶対に1個以上のページを伴って呼ばれるので、このPreCondition、エイラー、PreConditionはエラーになることはないということですね。 これはOK。で、ページを持って、Current、Pageナンバーに、Current、PageナンバーをBinding入れてあって、OKですね。 で、それでMakeコーディネーター。これはコーディネーターを作って、コーディネーターはオーナーセルフを渡して、 で、PreConditionで、PageナンバーレンジがCurrent、Pageナンバーを含んでいなければ、予定ページがないということですね。 Current、Pageナンバーを最初に渡したやつだ。うん、そうですね。 なので、これがMakeコーディネーター。Makeコーディネーターでここで落ちる。うん。 これは落ちて気づかせるパターンですかね、たぶん。そうですね。 基本的にはここで絶対に存在するページを渡す。今までちゃんとそうなってたと思うんですよね。 確かディフォルトで1になっていて、この1ページっていうのはページ数が1以上である以上は絶対ありますよね。 なので、大丈夫というこういった発想ですね。 で、その後、ページを切り替えた時には、存在するページの中から切り替えていくんで、それも大丈夫でしょうということでね。 でも、Makeコーディネーターだから一番最初だけだから、なおさらさっき今見たやつで大丈夫ですね。 とにかく、作った時にページがね、なんか全然変なところを指してると、ちょっとよろしくないんで、 開発段階でいきなり見つかるようにね、PreConditionで落としてある。 あ、最初のページも一気にPreConditionでいいでしょう。 で、こうやってコーディネーターを作るついでに、ダメなら落とそうやって。 ここはOKですね。 ここの空虚系統、空虚どっちがいいでしょうね。 なんかこうした時に、なんか微妙かなと感じてしまって、 まあいいや、うん、まあ好み。 で、MakeUIBコントローラーでこのテキストを取って、ここではUIBコントローラーを生成して、 データソースとデリケートをコーディネーターにしている。 ここは何も問題ないですね。 で、これで、UUpdateUIBコントローラー、毎回呼ばれるやつですね、更新のたび。 この時にコーディネーターのオーナーをセットしてますね。 それで、バインディングを最新の状態に更新した上で。 カレントページコントローラー、現在のページに対応するカレントページコントローラーが 見つかるかどうかを調べていなければ、それはエラーで落とす。 普通はあり得ないですね。ページ範囲内でスライドしている中で、 これ用のコントローラーがないのってことはあり得ないんで、 ここは完全にロジックエラーですね、フェーザーエラー。 ここに来たとしたら、プログラマーが完全に間違えているという状況ですね。 で、それで、あるということになって、そしたら、ページビューコントローラーにコントローラーをセットして終わり。 これでOKですね。ガードの順番はどっちかというと、一番最初にバインディングを更新するのが安全ですよね。 これでいいですね。ページビューコントローラーをエクステンションして、 ページコントローラーは、このタイプエリア様、いいですね。 いいけど、ページコントローラーってどこで使ってた?ここか。 ここと、ページコントローラー。 これ、プライベートでいいのかなと思った感じなので、プライベート。 プライベートだとダメですね。 ここに来て、ページコントローラー、タイプエリア、スーパーソフト、クリアード。 こっちがプライベートだから、押してあげて。 ページナンバーは他で使うから、これプライベートというより、 ファイルプライベートだと思ったけど、すでにファイルプライベートですね。 大丈夫ですね、ここはね。 ここがファイルプライベートですね。これで選ばなくなった。 アクセスコントローラーはこれぐらいだったら、別に触られても問題ないかなってところはありますけど、 外で使わないんだったら、最初から見えなくしておくほうが賢いですかね。 ということで、ファイルプライベートにしてみた。 あとはコーディネーターは、 NSOブジェクト級小デュアリティビューコントローラーデータソフト、デリゲートになっていて、 ファイナルクラス、メインアクター保護、いいですね。 オーナーがファイルプライベートバーですね。 ファイルプライベートバー。 ファイルプライベート、それでいいですかね。 アトラ、で、コントローラーもファイルプライベートで。 イニシャライドもファイルプライベート。 ちょっとできていますね。 いいですね。 これでオーナーを入れる。 ページコントローラーをページ。 ノブだけセットしてあげて、 ok です。 この辺も大丈夫ですね。 で、そうすると、ページコントローラーのデリゲート、 これはどっちかね。 do コントローラー お ク ォアっていたとこですか これはページナンバーフォー。 ページコントローラーに対するページナンバーが、 このページコントローラーが何ページにね、 何ページを管理しているかを、ページナンバー関数自分で使ったやつで調べて、 ページが取れなかったら、それの価値は浮いてるんで、 それに対応するページコントローラーは返せないよね、ということで2行返している。 で、ページナンバーが得られた場合には、それがスタートページ番号だった場合には、 後ろへスクロールするためにラストページナンバーを持ったページコントローラーですね。 それ以外は、プレビアス、ページナンバー。 プレビアスって超えちゃうとどうなんだ。普通に超えてくのか。 そうですね、アニメーティングが終わったとき、この時コンプリートだったら、 アニメーションが終わった場合は終了。 そうじゃなかった場合には、ビューコントローラーのファースト。 ページビューコントローラーというのがこれだ。 これのビューコントローラーってない場合があんだ。 こういう配列でオプショナルを返すときって結構困りますよね。 パラッポとニルって何が違うんだろうみたいな。 そういったところがあるんで、APIを自分で作るときにはね、 配列をオプショナルにはしないほうがいいですかね。 今回なんでかわからないけど、とにかく取れなかったり、最初がなかったり。 つまり、ニルだったり、パラッポだったりしたときは リターンするっていうことになってますね。 ちょっと広げておきますか。 そうじゃなく、現在表示中のビューコントローラーが取れた場合、 表示されているコントローラーっていうのは、ビューコントローラーの定期結果が、 これでアニメーション終わったよって言ってる。 これが自分が表示されている状況なんで、それをビューコントローラーとして、 ビューコントローラーの一番最初ですね。 で、それで、ページナンバー、そのビジブルビューコントローラーから ページ番号を取って、取れない場合は完全にプログラマーのミスですよ。 ということで、フェイトエラー。 そうじゃなければ、カレンドページナンバーを、 カレンドページナンバーを書いたのが、 PreviousViewControllers.DefinitionAnimatorとか、 アニメーションが終わったときに、現在のページを更新するってやってるんですね。 それによって、いよいよと、切り替え、描画の切り替えとかが なされていくので、これは大事ですね。 で、OKですね。 で、それでコーティネーターのプラグイントエクステーションで、 スタートページナンバーは、ページコントローラーのスタートインデックス、アフロームインデックスね。 これで、いいのかな。 ページコントローラーのスタートインデックス、0なんですけど、 つまり、0なんですが、ページコントローラーでしょ。 ページコントローラーは、単純に配列になってますよね。 だから、0から始まるインデックスですよと言っている。 それに限るんですが、ページ番号、 これあれだと、例えば、1から始まる インデックスだとしたらページコントローラー、 そうすると、1ページ目ってそれですよね。 なので、スタートインデックスを渡してしまうと、 2ページになっちゃうじゃないですか。 これ間違ってますね。 コードは合ってるんですけど、 ドキュメントとしては合ってるんですけど、 ロムインデックスで、0でいいのかな。 0で、コントローラーズのエンドインデックスだから、 カウント。 こんな感じですね、おそらくね。 で、こうするとなると、ページコントローラーの配列は、 必ずインデックス0から始まらないといけないという制約が逆に出てきましたね、これね。 で、では来たんですけど、これは、ようがない。 ようがなくないか。 スタートインデックスで、0でカウント。 いや、いいですね、これでいいのかな。 それで、 逆にインデックスアクセスするときに、 用意しないといけないそうですかね。 うん、そうかもしれない。 とりあえず、スタートページナンバーと、エンドページナンバーはこれで良さそうですね。 で、ラストページナンバーは、ページナンバーと 同じですけど、エンドページナンバーのプログラミングでよくある話ですね。 エンドとラスト。ラストは一番最後の値。 で、それでエンドっていうのは、その次を指すマーカーですね。 なので、ここの2つはよく区別しないと、 混同した上に、他の人に誤解を招かせるんで、 ドキドキ見るんですよね。 最後の要素をエンドって表現する人がドキドキるんですよ。 スタートに対してエンドってやったときに、 エンドは絶対終わりの次ですからね。 今時のソフトウェアでの一般的なプログラミングの考え方。 それによって、エンドに到達したらループを抜けるみたいな、そういった書き方をするんで、 必ず、そこは注意しないといけない。 ここは注意ができてますかね。 エンドの1個前がラスト。 まあ、ちょっと甘いんですけどね、エンド。 どっちかっていうと、ラストの次がエンドってやった方が いい気がするけど、まあいいや、そこは今回のイントー型の インデックスの場合には成り立っているから、 これでいいでしょう。 それで、ページナンバーレンジはスタートからエンドまでの、 エンドはここに含んでいないっていうのが大事なわけですよね。 これでOKですよね。 インデックスフロムページナンバー。 そうそう、ここ。と思ったんですけど、ちゃんとできてますね。 ページナンバーフロムインデックスで、 スタートインデックスからオフセットをね、計算したやつ。 なので、さっきのことだけ不安になってきた。 ここね、フロムインデックス。 ページナンバーフロムインデックスここか。 ディスタンス使ってますね。 じゃあ、さっきのことがあってましたね。 ちゃんと、ページナンバーフロムインデックスで、 スタート1から始まるインデックスだった場合に、 ちゃんとこれ0になってくれるんで、逆にこれ、 さっき書き直したの間違いですね。 リファクタリングでバグを生むとかでしたね。 ページコントローラーズの、どっちが違う? ん?あってるか。 これのファーストインデックス。 スタートインデックス。 スタートインデックス。 そうですね。これで、エンドページナンバーが エンドインデックスですね。 これを見てみると、このページナンバーフロムインデックスの所で、 スタートインデックスが渡ってくるので、 ページコントローラーのディスタンスで、 スタートインデックスからスタートインデックスまで なのでこれ0ですね。 という風になるけど、 ページナンバーはスタート、あとね、これですね。 プラスディスタンサ。 ページナンバーのスタートは、1ページから始まり、 これプラス0という形になるので、オッケーですね。 で、これがエンドインデックスだったときには、 スタートインデックスからエンドインデックスまでって、 このカウントがディスタンスになって、 スタートインデックスに足されて、 まあ、エンドします。 オッケーですね。 うん。 エンドというか、最終ページ番号を示す。 いいですね。 これで良いとして、 ページナンバー4、ページコントローラー。 これは、ページナンバーを返すけど、 ページコントローラーが、 ん?これは、 まあ、キャストだ。 ページコントローラーが、 これは、UIビューコントローラー。 これはコード上のタッチが、 あの、演技場UIビューコントローラー取ったんですよね。 確かね。 えーと、ここで、 このプログラムの中においては、 まあ、ページコントローラーをね、 UIビューコントローラーとして扱っている。 あの、UIキットの文化の中では、 そういう感じでね、扱いがちなので、 ページコントローラーはまあ、 普通ページビュー、 あ、ページ、 ん? えーと、このページコントローラーは、 他はUIビューコントローラーで受け取るけど、 普通ページコントローラーだよね、 っていうね、 そういった前提が、 このフレームワークの上は、 成り立つような気がするね。 それを活用してね、 P2はUIビューコントローラーにして、 ラップをするっていう形をとって、 で、ただし、 まあね、 問答無用で、 ページコントローラーにキャストしてしまうとね、 さすがに何か戻ったとき、 いきなり落ちるのが嫌だなっていうね、 そういったことになると思うので、 まあ今回はね、 ページが取れなかったという意味で、 2秒返すっていう手法をとっている。 うん。 で、 それで、 ちゃんとね、 かかってた場合には、 このページナンバー4で、 ちゃんとページコントローラーを取るタイプ、 そっちの方をね、 人間がやるのは、 相当大変なんで、 僕はコンパイラーにやらせちゃおうね、 っていう発想ですね。 ページナンバーが作ったのはね。 で、 それで、 えーと、 次、 ページコントローラー4、 ページナンバー、 で、 ページナンバーからページコントローラーを取るやつも、 似た作りですよね。 もはやね、 インデックスフロムページナンバーで、 コントローラーのインデックスを取ったら、 そのインデックスが、 ちゃんとページコントローラーの中に入っているのかを調べて、 なければね、 インデックスが刺す場所が無効なので、 ページコントローラーは得られませんでした。 ですよね。 で、 取れた場合には、 ページコントローラーの中から、 その取れたインデックスを指定して、 返しただけ。 大丈夫ですね。 うん。 流れもいいですね。 で、 それで、 カレントページコントローラーというのは、 ページコントローラーを返すんですが、 ページコントローラーの、 カレントページナンバーをね、 そこから、 えーと、 探して、 出すと。 カレントページナンバーが無い場合は無いってことは、 これオプショナルじゃないでもありますね。 こういうのでもありますね。 そうしたときどういう影響するんだろう。 ここか。 あー、 制御するコントローラーが見つかりません。 うん。 そうね。 普通はある、という前提で、 カレントページコントローラーを作っているのは誰か。 そこが問題ですね。 なので、えー、一つ以上存在する必要があるよ。 って言ってるのは、 これですね。 で、ページコントローラー。 ページコントローラーは、 ページコントロールは誰が持っているんだっけ。 俺が、オーナー カレントページナンバーで、 ページコントローラー。 ページコントローラーはこの、 僕はページビコントローラーが持ってます。 ってことは、なるほど。 そうすると、さっきのエラー、 今やった取り付けのような、 検索からいけば出てきますかね。 これ、これが、 予期しないページコントローラーを指しているかというと、 ここのレベル、コーディネーター、コーディネーター、 この辺でも同じところですね。 コーディネーターのページナンバー4から、 これちょっと拝借しまして、 これだけでいいや、選べるだけでいいや。 そうした上で、ページナンバー4、 ビジブルコントローラーが、 あ、そうだ、ビジブルコントローラーね。 これは、いいですね。ビジブルコントローラー。 Ooh, View Controller? こっちが、あるいは、 ビューコントローラー。 あるいは、どこだっけ。 あ、そうそうここね。 カレントページビュー、カレントページコントローラー。 これがここですね。 ここだけが影響してる。 そうすると、ページビューコントローラー、 ここが必ずページは1ページ以上という状況を生かしているので、 ここの中で、このページコントローラー、カレントが 見つからないことが、ちゃんとページビューコントローラーがコントロール しているのならありえないので、 これはもうダイレクトで良いんですね。 ダイレクトで良くて、ダイレクトで良いんですが、 カレントビューコントローラー、 これでセットアップしましたけど、 ここは例えば、ガードレッドコントローラーイコール ページコントローラーフォーオーナーカレントページで、 そうでなければ見つかりませんというのを、 ここに出すついでに、カレントページナンバーフォールですね。 これで共通して、こことこことね、 ここが取り違えないように、こんな規模感ならいいんですけどね。 別にコーナーのカレントページナンバーだけはね。 でもちょっと取り違えたくないなと思ったので、 こうして、ページが取れた場合には、 コントローラーを返してあげる。 いいですね。こうしてあげれば、大丈夫ですね。 いい感じの気がしますね。 そうすることによって、絶対取れるんだから、 カレントページコントローラーを呼び出すところは、 ここでは何も対処しなくていいよねっていうね。 そんな感じ。良いですね。 それで、ここもリファクタリングしたから、 オッケーということですね。 ここまでいった、プロファイルエディターの方に 置いといてみますかね。 プロファイルエディター、iOS版。 ここは、直デビューいるかな。 動かしときつつ、リファクターできそうなところ。 また出てきましたね。 バインディングは、リアル上はこれでやってますけど、 言語使用上は、プライベートセットを付けた方がいいのではないか。 セットがあって、自分の中に入れておくものね。 これで、オッケーですね。 無くていいんですけどね。これで、こうした後に、 ここら辺がちょっと苦手ですね。 これ、パッと見たときに、理想があって、 その中で、リジェクトがあって、 テキストがあって、何だろう、何だろう、 何を作ってるんだ、みたいな。 そんな感じになってきちゃうんで、 これ、分離しますかね。 で、プライベートエキスペーションで、 プロファイルエディターがありますね。 ここに作っていけばいいのかな。 この前に、これ見てみますか。 ゴールデートレンジ。ゴールデート、これですね。 ゴールデートレンジは、カレンダーカレントで、 カレンダーのデートバイオディングで、 マイナス1年。1年前から1年後までを、 ゴールデートレンジとして、 返してあげるよって言ってますね。 ゴールデートレンジってなんだろうね。 これか。これ、汚染だな。汚染はするけど。 これ、オッケーなのね。 ゴールデートレンジってなんだろう。 あれ、間違えた。 ゴールデートレンジ、ゲット。 ボディで、ん?あ、こっちか。 ディスプレイ、ゴールデート、デートピッカーだ。 デートピッカー。 デートピッカーで、プロファイル、ゴールデート、 これですね。 ゴールデートレンジ、ディスプレイ。 まずは、これで選択できるかどうかに かかっているのかな。 こんなことないか。オフトーバー。 2024年は、3年でいいや。戻された。 どっか、この辺りですね。そっか、そっか。 だから、良いですね。 じゃあ、そうしたら、ゴールデートレンジは、 まあ、これで良いのかな。 カレンダーデートって、カレンダーバイは、 チラッティングバイで、マイナス。 イヤーが、マイナス。そうね。 カレンダーデート、えーと、デートで、 まあまあ、これでいいんですかね。 この辺のが、プレビアスイヤー、ネクストイヤー みたいなね、そういう呼び方できると、 まあ、すごく分かりやすいと思うんですけど、 まあまあ、そこまでは、いいんですかね。 そして、やるとしたら、ここで、 桁型プロパティ使って、 えーと、プレビアス、プレビアスじゃない。 ミニマム。 どうにもならないですね。 ミニマムデート。 別に計算が何もいらなかったですね。 えーと、だから、ミンデート。 逆するなって感じですよね、どっちかというとね。 そうしなければ、でも、両然ですね。 これでね、カレンダーバイはカレンダーで、 ミンデートは1年前で、マックスデートは1年後で、 その範囲を変えするよ。 だから、これでいいですね。 あとは、この辺ですね。 エキスト、ユーザーネーム、エキスト、エキストフィールド。 この辺が、ローですよね、つまりね。 なので、これで、例えば、ユーザーネームローみたいな、 こういうのを作ったとして、それで、これを、えーと、ここら辺。 ここでいいかな、レンジ。 まあ、この下がいいですかね。 プライベート、プライベートもできているので、 えーと、パフォーマンス。 あの前に、ビュービルダーで、ビュービルダーパワーで、ユーザーネームロー。 そして、無理を返すよ。 今さっき貼った、コピーしたやつ。 これを貼ってあげれば、OKですよね。 それで、どういうふうにやると、ビュービルダーで、パワー、なんだろう、えーと。 Notifications、Notificationsロー。 Enableで、もういいのかな。 ちょっと、具体的すぎるかなと思ったんですけど。 まあ、いいですかね。 EnableNotificationsローも、サムビューを返すよ、というふうに作るにして。 やっと、ビュービルダーのパワーで、パワーの地下シーズナル。 シーズナル、パワー、そして、サムビューで、 まずは、これを混ぜて作りますが。 ビュービルダーのパワー、パワー、そして、サムビュー。 というふうに作ってあげると、これで、例えば、ユーザーローバーで、次にこれ、ノーティフィケーションですよね。 EnableNotificationsビュー。 Enable、作りましょう、というのが、まとにかくここですね。 EnableNotificationsビュー、EnableNotificationsロー。 押してあげて、EnableNotificationsビューのローですね。 こんなふうにして、で、同様にここは、シーズナルフォトロー。 シーズナルフォトローは、これですよ、というふうに、定義してあげて。 ここに入れてあげて、で、同様に、で、これは、コールデートローですね。 押してあげて、コールデートローは、これですよ、というふうにすれば。 これでできましたが、ボディを見れば、リストがあって、 これらのリストのアイテムが、ユーザーネームロー、EnableNotificationsロー、シーズナルフォトロー、コールデートローで並んでいるよ、って見ればわかりましたね。 つまりね、これで見ればわかって、例えば、EnableNotificationsローって何だろう、みたいなふうに見ていったときには、こうやってね、 PreferredNotificationsをガイディングされている、送る、というね、といった描画で作られているローですよ、というふうにわかるので、わからないところだけを見ていくことができますね。 さらに、このコールデートローって何だろう、ってなったときに、ここからとってもいいですけど、とにかく、コールデートローの定義を見れば、ここ全体、最後のローがどんな作りになっているのかだけに注目できるのでね、楽ですよね。 という感じで、OKですね。では、やったコードに無駄がないかと見ますが、Hスパックでテキスト、スペースとテキストフィールド、この辺大丈夫ですね。 で、あとは、EnableNotificationsローもドブルで、バインドしてテキスト表示できるですね。 それで、SeasonalPhotosローは、SeasonalPhotosローをバインディングして、Foreachで、SeasonのAllCases、SeasonはAllCasesしかないんでしたっけね、Seasonってケースって選べるんですよね。 で、それで、Season、シンボル、ないですね。なので、AllCases、これによって、ここがね、AllCases選べるよ、という、そういった話ですね。 で、それで、テキストでシンボルを出してOKです。で、コールデートローは、デートピッカーを出してバインディングして、このレンジ内でね、選択させる。 で、DisplayedComponentsは、Dateにするよ、いいですね。 さらさらと読めて、わかりやすいですよね。デートピッカーは何なの?というときにね、コールデートローですよ、ってね、書いてあるんでね、わかりやすいですね。 うん、じゃあこれで、プロファイルエディターは、リファクタリング、もう大丈夫でしょう。 ということで、次、プロファイルホストを見ていきましょう。 プロファイルホストは、もう何だ、えーと、エラーが何個か出ている、ビジットペンもビジットペンを掛け直しましたが、まあ、掛け直しときに見ていきますかね。 エンバイオメントで、もう出るデート、うん、エラー大丈夫ですよね、はい。 エディットモードで、これで終わりにしますよね、今回は。 エディットモードって、ちょっと面倒でしたけどね、エディットモード、まあまあでも、ちょっとやりそうになってたんで、OKで。 で、あと、スペースはプライベートで保持しなさいって、チュートリアルで言ってたんで、これはいいですよね。 で、エディティングプロファイルは、バインディングで返して、エディティングプロファイル、これ、もしかしてプロファイル、プライベートでいけんじゃない? あ、無理かな、大丈夫ですよね、きっとね、だとですね、うん。 プレゼントプロファイル、これもプライベートで良さそうですよね、ということは、 つまり、エクステンションですね、外に出ておいた方が、いろいろと観察しやすくなるんじゃないかなと、個人的には思うんで、プライベートエクステンションで、プロファイル保存、こうでしたよね。 で、こうしてあげて、この中で、さっきプライベートにしたエディティングプロファイル、あとどれだけじゃないんですよね、プレゼントプロファイルも多分そうで、エディティングも多分そうで、ボディは違いますね、あれ、ここまでかな? まずは、こうしてあげて、これでバッチリじゃないですかね、こうしてあげて、他余計なものを見せない状態にして、ボディに専念、ボディに専念、これでOKですね、こうして移動していったものを先に見ますかね、エディティングプロファイル、編集中のプロファイルは、エンディングのプロファイル、まあ、編集のね、どっちを目指すか、それがあるならそれ、そうじゃなければ、現行のプロファイルっていう感じでOKで、セットする場合には、エンディングプロファイルを置き換えていく、いいですね、これはいい、コードの書き方も、まあ悪くないんですけど、これそれとのね、言語資料の都合 ですよね、こういう書き方になりますね、ゲットのセットと出た方がなんかいいかなと思うんですけど、それでまあこういう書き方になった時には、こうやってゲットとセットを並べてあげた方が美しいかなーというね、そんな感じがなんかするような気がして、こういう規模感だった場合には、ニュープロファイルなんてね、あの明示しなくても、プレゼントプロファイルは必須ですよってね、こんな風に書いてあげた方が、パッと見わかりやすいですかね、おそらくね、なんかまた色が出てますが、これ見ると大丈夫だよね、きっとね、それともプライベートがなんか、良くない、なんか大丈夫だ、良くない、なんかちょっと変な色出ますね、まあいいや、えーとこれで、良い しょうがない、これでプレゼントプロファイルはゲットとセット、まあこれはいいですよね、普通のFnとプロパティのゲットとセットだ、これは良しでモデルデータのFFプロファイルにプレゼントプロファイルは直接影響を及ぼしていくよという感じで、このプレゼントプロファイルというのがね、編集中ではなくてコミットした最終的なプロファイル、これはモデルデータに保管するよというそういったことですね、でそれでリセーティングはゲットとセット、これはいいですね、セットもノンミューティングセットなのか、エディットモードはエバイメントか、ノンミューティングセットですね、ここはそういうUI であとはBody、ここも長いですね、これもなんか開けたい気がしますね、ここのHackのIt'sEditing.cancel、それでSpaceEditButton、なんかボタンですねこれね、えーとここを空白消しつつ、Buttonsみたいな感じですかね、Buttons、えーとButtonsというエリア、エリアにしますかね、これButtonsですよね、それをエクステンションのところに、これプライベートエクステンションだからプライベートいらないですねこれ、あともういらないのか、エディティングプロファイル、えーと外で使ってるのはエディティングプロファイル使ってますよね、エディティングプロファイル使ってるのにプライベートでいいんだっけ、まあいいや、まあまあこれでいいでしょ、 これをね貼ってあげる、これでいいですね、それだと作るべきはBatches、CompletedBatches、だからバーの前にAtViewBuilderでバーCompletedBatchesエリアでSomeViewですね、あとそれとAtViewBuilderでバーRecentBatchesエリア、SomeViewですね、こんな感じで、これで全部ですがね、おそらくね、こうした感じにした後で俺らのIt'sEditingだったらプロファイルエディター、あそこはエディター、エディターで全部、まあこんなのか、だからButtonsエリアと、なんか今張り切ってたくさん作っちゃったけど、これら全部既にまとまってましたね、なのでこれは1個でよく定制するとね、コンテンツエリアですかね、コンテンツエリアっていう のを持ってね、切り替わるよということになっているというのはここでは気にせず、普通にコンテンツエリア定義して、それでコンテンツエリアというのはこういうものなんですよっていうふうに書いてある、で、これでIt'sEditingだったらプロファイルエディターとFalseだったらSomeViewエリアでオンエリアだったときにPendingプロファイルと新たにバーである場合は、それを新しいプロファイルとしてプレゼントプロファイルに代入するよ、ですね、Pendingはもう反射したから無くなるよ、ここは悪くないですかね、うん。 これで良いですね、つまりね、そうすることによってさっきと同じ感じで、ボディはボタンのエリアとコンテンツエリアが垂直方向に並んでいるよという、そういったことが表現できた、OKですね、これで大丈夫な気がする、じゃあ次、3、プロファイルサマリー、これだけ見て今日は終わりですかね、えーとこれはプロファイルサマリーはViewで、これか、プロファイルサマリー、あーなるほどね、編集用ではないプロファイル表示部分ですね、モデルViewだってプロファイルはRedでよくできてますね、ここももう既に作ってますね、フロールViewはプロファイルViewとCompletedBatchViewとRecentFaxView、さっき作ろうとした リファクタリングをやった感じですね、同じ感じ、えーとダメではないんですけど、これサムビュー書いてるからグループで書いてますけど、これViewBuilderにしちゃえばなんてことなくグループ作らなくていいんで、インテントが一個稼げる、インテント稼げるってね、そういうUIの中では結構重要、見た目上なので、見た目とコードの見た目上ね、重要なのでグループをわざわざ作るよりはViewBuilderを使った方が賢い感じしますね、ここも同様ですね、VStackを書いてるだけなんでね、VStackをそのまま直で書いてもいいんですけど、そうすると書き換えると面倒なので、サムビュー不透明な方でね、VStackを書いてるわ リファクタリングが終わったんで、次回はもうほとんど残るところと思ったらVBuilderとかJPを引き続けるってことですね、アニメーションとかね、こういったあたり、ここから下を見ていく、リファクタリングをしていく、そんな感じにしましょう、はい、じゃあこれで終わりにしますね、お疲れ様でした

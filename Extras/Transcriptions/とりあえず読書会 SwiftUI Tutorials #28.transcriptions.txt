Transcription & Summarize : とりあえず読書会 SwiftUI Tutorials #28

はい、ではとりあえずご紹介を始めていきましょう。 とりあえずというわけで、とりあえずを見ていってますが、 あとよっていうようなアプリ、これがね、完成したところですけれど、 そのときにね、コピペして済ませているコードの中で、 まだちょっと見ておいたら楽しそうだなというところがあるのと、 あとね、自分がコードをちょっと開き替えた都合で、 えーと、少しばかり過剰なインターフェースがね、乗っているよっていう状況になっているので、 それを直していく、そんなところね、今日はやっていきたいなと思うんですが、 まあ、こういったやつが一番面白い感じが自分はしますね。 なんか、あれこれ考えてね、飛躍していくっていう、こんな流れですかね。 まあ、なるべく自分がいいコードをかけるとは限らないわけですけど、 まあ、それでもね、ひたすら考えると、どれなりにはね、 見つけられる力ってなっていくものだと思うし、 逆にそういったのをね、気にしないでやっていると、 上達も、まあ、仕入れているようなぐらいになっちゃうんですかね。 何事もあって考えるってことはね、大事だなというのを、 最近特に、僕は感じるような気がする。 ラグラミングって結構ね、考えて状況をしっかり掴んで、 その状況に応じてね、適切な処理をやっていくっていうのが、 簡単なようで結構難しいと思うんですよ。 それなりに、身についててもね、 うん、どこまで身をつけられるかみたいなところっていうのかな。 まあ、なんかいろいろと難しいとこありますよね。 まあ、そんなのもね、気にしつつ、 ちょっと今日はやっていきたいなと思うんですが、 まずどこから行きますかね。 うーんと、今度はバブルウォッチ系のね、アプリのコードですね。 その中で気になるところが、いくつもあるわけですけど、 うーんと、そうね、個人的に大きく気になるところからやっておきますが、 この、USH Notification Payload、 そういった情報がボディとしてね、当たってくるっていう、 そういったものになっていて、 新たなテキストがそれとボディとあって、 ランドマークインデックス、ここがちょっと気になりますよね。 インデックスって、状況によるんじゃない?っていうところで、 ここでインデックスが当たってくるっていうのは、 いまいち、微妙かなっていうね、 そういった感じがする。 うん、あと一つね、それはサモンクリーク。 これと、ランドマークインデックスが本来一致するべきものの気がするんですけど、 ここについてはね、タイトルを通じて出さないといけないから、 これはしょうがないんですかね。 この辺りちょっとね、あのローカル通知っていうものに自分は慣れてないんで、 この辺はちょっと試行錯誤も兼ねてですね、 やっていきたいなと思うんですが、 まあ何にしてもこのインデックスおかしいですよね。 おかしいが言い過ぎなのかな。 うん、まあ何にしても、 ノーティフィケーションビュー。 ここで表示するのが目的ですよね。 で、ここでビューにタイトルとかを渡すけど、 このタイトルとかはどう当たってくるかというと、 ノーティフィケーションコントローラーですよね、おそらくね。 エディブレシーブでレシーブした情報を、 ノーティフィケーションデータとして出ていて、 それで出たデータをね、ここでアラートのタイトルとかメッセージとかを取ってきて、 それで表示してるわけですよね。 ここが気になる。 まずはノーティフィケーションのペイロード。 えーと、ここは、 ここのAPSとかこの辺りの書き方っていうんですかね、 これを選べないとダメですね。 まずね、プッシュノーティフィケーション。 自分のね、意識がちょっと足りなすぎる。 プッシュノーティフィケーション、iOSかな。 で、それで実装方法。 これでいいかな。 えっと、この中で、 えーと、この辺かな。 書きとかこの辺のセットアップは関係ないかな。 プッシュノーティフィケーションを追加するにして、 アプリを実装する。 で、実装の中で、 この辺かな。 これは違うかな。 で、プッシュ通知で、 実行、これは、 ALGとかなんかよくわからないのがあって、 ホストネーム。 これを送ってあげる。 で、HTTP。 APNS。 APNS。 これで、 これ終わったか。 次見ておきましょうか。 これで、プッシュ通知の、 なんかこれ違いそうだな。 次。 こちらは、 エミュレーターで通知が可能ですよって話で、 デバイスのIDと、で、APS。 タイトル、ボディ、データ。 という形で渡してますね。 それで、デュレーションとか色々な情報がありますが、 APNSファイルのフォーマットはだいたいこんな感じ。 ここのだいたいじゃないのをちょっと知りたいんですよね。 APNSファイルか。 だからそういった名前で検索すればいいんですかね。 APNS書式。 えーと、あれかな。 プッシュノーティフィケーションサービスの通知で。 で、それで、書式。 えーと、どこだ。 証明書じゃなくて、付属じゃなく、 えーと、どこにないか。 プッシュノーティフィケーションサービスですよね。 証明書の話ばかり出てきちゃいますね。 えーと、どうするかね。 これは、安全理解。 実装。クライアント実装を。 それで、リッジとかじゃなくて、 この辺で言うかな。 基礎。基礎でいいか。 基礎として、トークンをサーバー登録して。 うん、これは大丈夫ですね。 どうすると。 アクションとディープリンク。 フォアブラウンド表示。どれだろう。 サーバー実装。ユースケース。 一通知。この中だと、リクエスチブですよね。 それで、リクエストの。 これは、コンテンツのユーザーインフォーで イメージとか取ってますね。 組織はなんでもいいのかな。 だと、そこはあるんですけど。 どうしようかな。 URLをダウンロードして添付。 というリクエストの中で、コンテンツの ユーザーインフォーでイメージを取ってますよね。 それで、このイメージを保存してる感じですよね。 これの、所属するAPNF。 AP、アップルプッシュ、APのNSか。 そのファイルが、このデータが書いてあればいいんですけど。 書いてないかな。 これで、この辺かな。 やっぱり、この感じで、アラートがこれで。 代表的なペイロードで、 こんな感じだとすると、基本構文がちゃんとありそうね。 どうすると、この辺のタイトルとかしょうがないのかな。 その後に、いろんな情報が入ってきてるのかな、 という感じがするんですけど。 カテゴリとか。カテゴリ。カテゴリはいいのか。 スペットID。ここにメッセージで。 このメッセージが違うと、どうなるんだろう。 例えば、ここに頭に何か付けますか。 それで、シミュレーターが。 アップルウォッチのシミュレーターは届いてないな。 アップルウォッチは、今アップルウォッチだから、 これで実行すればいいのか。 これで、これで発生の後が表示されるから、 これだと問題ないんだ。 タイトルを表示するときね。 このときに、渡すときとか、コントローラーにね。 このときに、アラートのタイトルを渡すというときに、 ついでにちょっと名前を追加してしまって、 ビックリマークの後に続いて、タイトルが繋がるような。 こんな感じにして、タイトルがどういう風に通知されてくるか。 アップルウォッチのところで通知されたメッセージ。 それと、ノーティフィケーションビューがこのときの表示。 ここいじってもあまり意味ないかな。 とりあえずシミュレーターね。 あとは、さっきのファイルですね。 これだ。これの場所。ポインファインダー。 これで。 エミュレーターにそれを投げてあげると。 そのときにどんな通知が出るか。 最初のタイトルの1点持ちに注目ですね。 こうすると、投げたときとかアプリが動いてるとダメなんでしたね。 だから、フォーメに変えてから投げ込むと。 アテナだけでしたね。 ここでビックリマークアテナが。 ああ、良かった。なるほど。 つまり、タイトルは必要ですね。 ここでこのタイトルが動揺があって困るわけですよ。 っていうのが気になってるんですけど。 だからここがタイトルはしょうがないですね。 つまりね、このメッセージもしょうがないと。 という感じになっている中で、ランドマークインデックスですけど、ランドマークの情報って確か別の情報を持ってませんでしたっけね。 ランドマークのデータとか、リソースか。 その中のランドマークデータ。 その中でIDがありますよね。 インデックスじゃなくてIDで取るのがどうなんじゃないのかなという気がするんで。 ランドマークIDに変えて。 例えば、スーパーサーモンクリークは、これか、1002番ですね。 なんほうがいいんじゃないのかな。 こんな風にして、それでコントローラー。 コントローラーの前にタイトルとボディと、ボディじゃない。 ノーティフィケーションセンター、コントローラー。 ここで、ランドマークインデックスキーで取ってますけど、 ランドマークインデックスキーではなくて、ランドマークIDに変えて。 それでランドマークIDキーですよね。 これでランドマークIDキーとして、これでまずIDが取れるようになったじゃない。 ここ、インデックスじゃなくてIDになったわけで、 そうしたときにモデルデータのランドマークを取るときに、 何か言うのがあったっけ。ランドマーク、ないか。 ランドマーク、モデルデータのIDで取るのが作らなかったっけな。 ID、ちょっと探してみますか。YIDで作れると思うんですけど。 そうか、嘘をすると自分で何とかするしかないのかな。 そうしましたら、モデルデータですね。 モデルデータのところで、モデルデータだから、ここか。 モデルデータの中で、多分エクステーションしてると思うんですよ。 バンドルじゃなくて、シーケンスが作ってないか。 ランドマーク系をエクステーションした気がするんですけどね。 ランドマークの中のエクステーションシーケンスのバインディングランドマークじゃなくて、 シーケンスのランドマークここですね。 IDによる検索はまだ作ってないのか。どうしたらすればいいですね。 ここでワンクッションで、ランドマーク、YIDでIDとしてストリング。 ストリングだけど、サムストリングロゴでいいですかね。 ここが好みですかね。これでランドマークを返すということにして、 それでこれを返すときに、ファインドファストから、 ファーストウェアでランドマークインって目的のものとしたら、 ランドマークのIDか、この私たちのイントワーカーでしたね。 IDはイントワーカーか。どうしたら、このときはイントワーカーですかね。 これでオプショナルか。見つかんないことがありますからね。 オプショナルでこれでいいですね。 ついでに、今回使うかわからないですけど、ランドマークYIDをバインディングランドマークの方にも 持たせておきたい気がするので、これをやっておきますかと思ったけど、 もう一個いい方法を思いついた気がする。 IDを持ってるじゃないですか、ランドマークが。 ランドマークっていうものは、アイデンティフィアブル持ってるじゃないですか。 これでいいですね。だからそうすると、シーケンスでいいわけですよね。 シーケンスで、これはいらない。いらなくする予定。 上のこれが残っていればよくて、 シーケンス、両方シーケンスでやる必要があるんですが、 こっちがランドマーク限定で、 もう一箇所としてはシーケンスで、ウェア、エレメントがアイデンティフィアブルね。 こうして開けると、ランドマークにならないのか。 汎用化させると名前がちょっと汎用的になっていっちゃいますよね。 そうすると、ファインドとかそういう名前になるんですかね。 ファインドになるか、ファースト。 IDだとファーストじゃないですよね。 別に。そうすると、エレメント。 名前が悪い気がするな。エレメント。 アイテム。アイテム持ってるよな。 何がいいかな。エレメント。ID。 そして、それで、シーケンスの他エレメントですよね。 で、ランドマーク、ID。 IDがファッシャブル。 ファッシャブルなら、ここがインプットじゃなくて、エレメントのIDですね。 こうしてあげると、いい感じ。 ここがランドマークではなくて、エレメントね。 ちょっと汎用的すぎて、微妙な気もするけれど、 まあまあ、これで良いですかね。 こういう風にしてあげて、そうすると、 さっきのランドマークコントローラー、 ランドマークのディフィケーションのコントローラーですね。 この中でIDによって検索ができるようになると、 モデルIDのランドマークス。 これのエレメントIDで取得したIDですね。 で、これで得られたやつをランドマークに入れてて、 これをどうか、塗りを強要している。 そこもちょっと問題なんですよね。 ノーティフィケーションコントローラーで、 モデルが仮に全部塗れたときに、どういう表示になるのか というのがね、とても気になるところなので、 えーと、どうしようかな。 このタイトルとかですよね。 パーツ、ビル、やってるけれど、 これら全部仮に塗らなかったとすると、 どんな表示になるのかなっていうのがね、 まず気になるところ。 これは何でかっていうのは分からないですけど、 数字が来たときに、なんか落ちられては困るとか、 そういうことなんですかね。 落ちるとどうなんだろうね、数字来たときに。 まあとりあえず、これで検索かけて、 とにかくノーティフィケーションコントローラーが、 特に何にもね、表示をしないという状況になると。 これで、これでシミュレーター1回 フォームに戻して、 で、投げ込むと、数字がポイッと来た後に、 反応ランドマークで5マイルですよと。 うん。そうですね。 これだけか。うん。 反応ランドマークで5マイル。 お気に入りのランドマークまで5マイルですよ、 っていう風に言ってるんですが、 これもまた問題がちょっとあって、 何にも値が減られなかったとき、 減らされてこなかったときに、 ノーティフィケーションビューの中で、 そこまで5マイルで行くよっていうね、 こういった表示になってるわけですけど、 これもしタイトルだけ渡ってきて、 メッセージが取れなかったときって、 この目的の場所の名前がパッと出るにも関わらず、 5マイル、そこまでしかね、行かないよっていうね、 そういった風な状況になっているので、 これはよろしくないですよね。 だから何とか動かしなきゃいけない。 あとは、リプレシーブやったとき、 ボディがこれですよね。 リプレシーブやったときに、これか。 ボディとリプレシーブってどっちが先に動いてるんでしょうね、これね。 リプレシーブしてどうなっているのかな、 通知が起きて、ボディが表示される前に何をするか。 代入してリプレシーブ、表示されるのかな。 そうすると、リプレシーブ、 ノーティフィケーションコントローラー、 このビューですって言って、ボディがノーティフィケーション ビューでこれを出すよって言っていると。 プリントリシーブ出してあるので、 プリントボディも出しておきますか。 プリントを出せないんだっけ。 もう出せるようにしてるっけ、今。 出ないか、してない。 どうするかなると、グループか。 これはグループにすれば出るかな。 グループ。 出せるようになってないし、 あとノーティフィケーションビューからですからか。 あ、そうか。 これそのビューとかやると、 そうするとこっちに関係してくるのか。 なるほどね。だからノーティフィケーションビューを 出さなければならないという状況になっていて、 これを出すためには、ノーティフィケーションビューの イニシャライザーか、この中にプリントを仕込めばいいですね。 なので、このイニシャライザーの中で、 プリント、イニシャライザーかな。 押してあげて、まずはどう動くか。 これを見てみますか。 エミュレーターは? えーと、あそこじゃないか。 シミュレーターが、こっちね。 台本の方こっち持ってこいよ。 要らないですけどね、今ね。 あれで、こっち。 これを投げ込んで、通知が当てて、表示が出ると。 この時に、バックメッセージとしては、イニット。 レシーブスタートイニットですね。 レシーブスタートイニットだから、 これはこれで大丈夫ですね。 そうすると、イニシャライザーのところで、 いろいろやっていけば済むという話になっているという感じで、 タイトル、メッセージ、ランドマーク。 でもこの辺は揃えてもいいのかなっていう気がするんですが、 とにかくヌルは良くないですね。 なので、ノーティフィケーションビュー自体は、 ヌルに許容しない方がいいんじゃないかなというのがまず1つある。 で、あとランドマークと、えーと、ランドマークと、 ランドマークどこで使ってるんだろうこれ。 ランドマークが取れた場合は、アプリにしか。 あ、なるほど。 イメージをね、表示するために使ってるのね。 で、タイトル&ランドマーク。 これもちょっと、このノーティフィケーションビューに至ったからには、 他にね、何も、もはや、えーと、 何もなかったみたいな状況は想定させないようにして、 表示だけなんでね、所詮ね、この外側で、 ちょっとやりくりしちゃったらいいのかなっていう気がする。 うん、あれか、ツイストリファイトと垂直に書くのを 歌ってましたね、このチュートリアルでね。 まぁ、垂直にはしときましょう、一応。 で、うん、こんな感じで、 ヌルは外で解決する状態にしてあげれば、 このノーティフィケーションビューの中はシンプルだし、 外の状況を知らなくてもね、 ちゃんと表示できるわけで、 これで良いかなっていう気がする。 うん、だからこれで、あとはイメージで、 ランドマークのイメージが、 このイメージもイメージがあるかどうか、 ここは歌っても良いかもしれないですね。 なので、ランドマークのイメージ、ここランドマークを 取っても、良いのかな、ランドマークを取って、 えーと、いやここはもう完全に柔軟に表示できるように しちゃった方が良い気がしますかね。 ランドマークのイメージ、これを受け取って、 だからイメージとしてね、 受け取って、イメージは無い可能性もあるようぐらいは、 ちょっとね、これを許容してあげて、 それでイメージ、それでランドマークのイメージを オプショナルで許容して、イメージと。 ここはどうしようかな、イメージを与えない可能性が あるときになかったら、 NILをね、定義できるようにする、 指定させるかどうかなんですけど、 あのイメージについては、ちょっとばかり、 自分の価値観に寄せてみますけど、 これはまあ、オプション、ディフォルト引数があっても 妥当な気がしますがね、なんとなくね、 それぐらいおまけのものっていうね、 そういった感じのイメージですね。 で、それで、ランドマークイメージがオプショナルだから、 ここで、ifret、イメージとしてね、 これで、イメージがあったときには、 イメージを表示するよ。 これ以外は、テキストとメッセージだけにするよ、 っていうね、一般の表示で。 まあ、シンプルでしょ、これでね。 そうすると、ノーティフィケーションビューの中にはOKで、 そしたらこっち、NILが許容されなくなったんで、 ここをなんとかしないといけないのと、 あとはどうかな、モディの中、ここね、 ここで揃えちゃいますかね、タイトルとメッセージと、 あと順番を取って、これはどうでもいいんですが、 イメージ、おはよう、ランドマークイメージの オプショナルとして持って、そうすると、 ここか、これがイメージで、こっちもイメージ。 イニシャライザーですね、やっぱディグレシーブで、 なんとかやっていくっていう感じになりますけど、 この中でやることとしては、このような、 ノーティフィケーションコントローラー、 イニシャライザーを持っていない、タイトル、メッセージ、イメージ、 ああ、イニシャライザーか、ああ、そっか、 オプショナルにしたので、そういう意味か、なるほど。 ノーティフィケーションコントローラーは、 最初、イニシャライズされなきゃいけないのか、 ああ、なるほどね、ディグレシーブするからにはね、 そういうことですね。 で、そうすると、オプショナルじゃないと、 運行が悪いのか、ああ、なるほどね。 これはAPIというか、フレームワーク上の制約ですね。 これで初期値を渡しておくっていうと、 もちろんあるんですけど、 そうすると、そうしたってね、あまり意味のない 初期値になってしまう。 これだったら、NILの方がね、まともな初期値に なるのかなっていう、そういったのが 確かにありますね、これ悩ましいですね。 どうしようかな、えーと、もう一つありますね、 オプショナルでもいいんですけど、 これ、実際に値を使うときには、実際に値が 入ってるっていう、そういった状況ですよね。 そうしたときには、オプショナルではなく、 単純なオプショナルではなくて、 気持ちアンラップのね、ああ、違う、アンマーカンラップ。 えーと、アンマーカンラップのね、オプショナル。 それを使ってあげるっていうのが、 本来というか、スウィフト的には通りですかね。 インプリストリアンラップとオプショナル っていうやつですね。 そうすると、使わないうちはNILでいいんだけど、 使うときには絶対値が入ってるよっていうことを 主張できる。なので、これがいいですね。 どうしよう。で、イメージの方がなくてもいいんで、 普通のオプショナル。 こんな感じにすれば、イニシャライズの問題は解消するし、 多分、レシーブしてからボディを表示するっていうまではね、 このタイトルとかメッセージとか伝わんないはずなんですよ。 いや、それは自分の想像を持っておかないですけど。 ね、そんなところがあるんで。 これは大丈夫ですね、これでね。 うん、じゃあこれでよくて、 次に考えなきゃいけないところが、 まずデータ揃えますかね。 えーと、ノーティフィケーションデータから 値を揃えるわけですけど、 ノーティフィケーションデータっていうのは、 ユーザーインフォーか。 ユーザーインフォーはハッシュアプリのエニーか。 なるほど。 そうすると、これは若干厄介なところがありそうですけど、 これについてはどうしますかね。 えーと、簡単に言っとくというか、 この文字列で渡すのってあまりよろしくない。 やっぱりね、APSとかね、こういったところ。 これを文字列で渡すのは よろしくないなというのを思うと、 クオリティアル的にしたいわけですけど、 その時に誰に持たせるかっていうね、 そういったところが何となく気になるわけですけど、 これはどうだろう。 ディクショナリーっていうことは、 ディクショナリーということは、 プロパティリスト。 どこ見えないですかね。 うん、どっか。 見えないかもしれないです。 これユーザーインフォーから、あとコンテンツ。 コンテンツは何事なんですかね、これね。 コンテンツは、UN Notification Content型。 これは多少使えそうですね。 これを使う手も一つあり。 ただし、えーと、もうネタ出しですね。 すべてのコンテンツが、この通知のために あるわけではないんで、 無理に拡張するのはちょっとやりすぎですかね。 そうすると、コンテンツの内容、 それをNotification Controller。 誰にしますかね。 えーと、Notification View、Notification Content。 あと1個作った方が、なんかいい気がしますね。 これやってみましょうか。 ちょっと、うまくいくかわからないですけど。 えーと、普通のスイッチファイル作って、 で、Notification Contentという形で作って、 で、それで、インポートで、 W、えーと、アリティとかの、えーと、UN Notification。 ユーザーノーティフィケーションかな。 で、ストラクトでいいですね。 ストラクト、えーと、ノーティフィケーションコンテンツ。 で、それで、要素としては、レッドでいいですかね。 中身は、書き換えても矛盾は生じないけど、 うん、どっちでもいいか。 バーでタイトル、これがストリングですよね。 で、バーでメッセージ、これもストリング。 で、バーでイメージ、あ、イメージじゃない。 えーと、IDですね。 だから、ランドマーク、ID。 これがインターバーですね。 これらを持つ型にして、 で、それで、エクステンションノーティフィケーションコンテンツ。 そして、イニシャライザーで、 フロム、えーと、コンテンツ、コンテンツ。 で、これがUN Notification Contentね。 ここから変換するよという形にして、 この中に全部ね、両方閉じ込めちゃえば、 いい感じにアクセスできるのかなということで、 えーと、そうすると、キーとして、えーと、 Eキーとして、どうしようかな。 APN、どこまで再現するかですね。 ま、そんな再現は、 こだわんなくていいかなと思うので、 これで、えーと、ユーザーインフォ、 これイコール、イニシャライザーでどうしようかな。 ユーザーインフォを取って、 うん、まあいいか。 ユーザーインフォコンテンツから、 ユーザーインフォね、取りますよね。 で、そうした上で、えーと、 ここはもう、普通に、 普通にやっていくしかないんですかね。 えーと、それでもね、キーをちょっと、 それはいいのかな。 えーと、どうしようかな。 えーとね、分かってくるものがこれなわけですよね。 ペイロード。 ペイロードか。ペイロード。 いい名前な気がしてきた。 えーと、ペイロード。 ノーティフィケーションペイロードとかにしてもいいかもしれないですね。 コンテンツとか。 というよりね、ちょっとさせてみます。 まあね、ノーティフィケーションペイロード。 ま、ちょっとやりすぎかな。 ペイロードってすると、 完全に形を合わせたい気もしないでもないですね。 あの、さっきの、 JSONの形と、 合わせたくなっちゃう予感もあるから、 ちょっと名前を移らせておきますか。 で、そうした上で、 さっきのね、初期化のコードを持ってくるわけですけど、 えー、まずマットとコピーさせてもらっておりますかね。 これと、ここら辺ですか。 で、これで、えーと、ランドマークIDキーもか。 ランドマークIDキー、ノーティフィケーションデータ。 ノーティフィケーションデータというのが、 ユーザーインポですからね。 これコピーして、えーと、 データまでとコピーする、えーと、 ストリングエニカ。 まあいいや、ここまででいいですね。 これで、キーを押して、 で、さらにちょっと、 失敗可能イニシャライザーの方が凄い良さそうですね。 押してあげた上で、 で、ユーザーインポ型は、 名前としては、 名前というか、 エニファッシャブルの、 エニカ。 エニファッシャブルね。 でもストリングに変えられるよっていう話をしてて、 凄いオプションなんです。 引き継ぎマークってことでね、 オプショナルをね、ひたすら、 あの、ついてっちゃうと、 どこで見るようになったか分かんなくなるんで、 これはやめた方がいいですね。 こういったことはね。 なので例えば、 APSを取るときに、 あ、APSね、フィールドを取るとき、 一応横に出しておきますか、 これね。 あ、横に出ない。 えーと、 横に出せない。 えーと、 これで、どれか? エクスパーナルじゃなくて、 ニューウィンドウじゃなくて、 えーと、ショートカットが無効になってる。 まあいいか。 ちょっと不便なので変えておきますけど、 えーと、ナビゲーションで、 まあ不便って言ってもね、 自分が慣れてないだけですけどね。 クリックするときのナビゲーションで、 ビットオプションで、 ファンピントタブじゃなくて、 えーと、デパレートエディターですね。 これにしておくと、オプションを押しながら クリックしたときに隣に出るから、 従来のエクスコードの動きですよみたいな、 それだけの話なんですけど、 これを出したくて、このAPSですね。 このAPSを取るときに、APSの情報重要で、 取れないとどうにもならないので、これがガード。 メッセージだけは取ったらいいのかな? メッセージだけは取って、取るともいかないですよね。 えーと、あ、そうもいかなくもないか。 この辺はどうするかですね。 APN、まあでもAPN取れなければ、 ショートカットのメッセージ取れないですからね。 これでいいですね。 で、これでユーザーインフォから、 ユーザーインフォから、ユーザーインフォから、 ゲット。 これはオプショナルじゃないですね。 あ、そっか。 これをストリング・エニーに当ててるのか。 なるほど、そういうことかもしれない。 だから、これをガードかな、ここもね。 ガード。ガードで結ぶんですが、 ストリング・エニーね。ストリング・エニー。 まあ、エニーとはこんな感じ。 で、これでストリング・エニー取れなかった場合には、 2両返す。いっぱいですね。 オブジェクトなので、この形にして、 取れなかったら、2両返す。いっぱいですね、これもね。 で、ここでこうすると、いろいろと大事な部分、 こうやって取れてるので、バラードというかタイトル、 いっぱい。だいたいと失敗が多そうですね。 どうしようかな、ベッド。ベッドというか、タイトルか、 ガード。ガードが多いですね。 タイトルイコール、APSのタイトル。 APSのタイトル。 ユーザーインフォーを持たせてしまって、 あとプロパティアクセスするってのもありますね。 まあ、ただそうすると、結局、ニルがいいのか。 ここで揃えちゃったほうがいいですかね。 まず、ストリングやってあげて、 それで、エルス。一旦、ニル。 なんか、いっぱいが曖昧な気がしますよ。 まあ、いいか。これでニルでしょ。タイトルと、オーディと。 もうね、いいんですけど、なんとなく、 ちょっと私、ガードレットが多すぎるのが、 個人的に気になっていて、 これはやっぱりプロパティアクセスで、 まずは名前でダイレクトに取れるように、 なんか、準備しちゃったほうがいい気がしますね。 ユーザーインフォー型でストリング取って、 どうしますかね。 コンテキストの中に、例えば、トラクトで、 ユーザーインフォーという型を持たせたとして、 これは内部でしか使わないので、プライベートでいいですよね。 それで、この中でパーとして、 ローユーザーインフォーかな。ローバリューでいいかな。 ローバリュー。ローバリューでいいですかね。 これで、ストリングにという形で持たせて、 今回の場合というか、APSのファイルを見ると、 ランドマー回避が数字がやっぱり縁にですね。 これしかないか。 こうしてあげて、それで、イニシャライザー。 ローバリュー。イニシャライザーが 勝手に入るから、いいか。 こうしてあげると、ここでまず、 ローバリュー、ユーザーインフォーとして、 ユーザーインフォーイコール、 ユーザーインフォー型でローバリューが、 コンテントのユーザーインフォー。 これがちょっとダメなんで、 これはここはガードでいいですね。 バードで、エルスで、 これでユーザーインフォーで、 イニシャライザーに閉じ込めるか、 というとこか、どうしますかね。 ユーザーインフォーは絶対に渡ってくると、 仮定するかどうかですね。 なので、こうしたら、 ユーザーインフォー、ローユーザーインフォー、 ガードレット、ローユーザーインフォーイコール、 コンテント、ユーザーインフォー、 アズ、アズ派手な、ストリング、エニーですね。 こんな風にして、これがダメだったら まず大失敗ですよね。 その後、ユーザーインフォー、 ローユーザーインフォーで初期化する。 こっちは失敗しないですね。 ローユーザーインフォー。 こうしてあげて、これでプロパティを いい感じに取ってくる。 こういった機能をユーザーインフォーに 載せてあげるということをすれば、 まあまあ、いい感じになるのかな、 という意味が何となくしますね。 これをやるためには、エクステンション、 ファイルプライベートにしますか。 ファイルプライベートにして、 ファイルプライベート。 エクステンション、エクステンション。 エクステンションとノーティフィケーションコンテンツの ユーザーインフォー。 これを拡張していきますけど、 これをやるにあたっては、 プロパティですよね。 ロープリは持っているので、この中で 必要なものというと、 APS、APS と、 APS と、 トラクト、トラクトと、 APS が持つのは、タイトルとコピーか。 APS のアラートか。 この辺は厳密さを求めるとダメです。 ダメとかダメですけど、大がかりになっちゃうんで。 APS は投資をスマホにストリングに返すようにして、 どっちが厳密のほうがいいのかな。 プライベートでとりあえずよくて、 APS バーデースをオプショナルにして、 やり方としてはバードレット、 結局バードはしていくことになるんですよね。 APS イコール、ユーザーインフォー、 ローユーザーインフォー、 ローバリューの中で、 これがストリングに合致するか。 合致しなかったら、ニル。 点が消えれば、得られたものを返す。 これそのまんまですね。 返せば良いということが分かった。 これでOKだと。 パワーとしてプライベートエクステンションにして、 パワーでタイトル。 タイトルはストリングでオプショナル。 これはAPS の配列からタイトル。 これを取ればOK。 これがパワーでメッセージ。 メッセージがストリングを返すようにして、 これもAPS が取れた場合のメッセージ。 アラートがまたエニのストリングを返すのか。 同様にプライベート、パワー、アラート、 そしてストリング、エニ。 これで取り方はAPS に対してアラートを取ってあげる。 そういった感じですね。 ストリング、エニ。 こうやっていくと、 意外と思ったよりは原因が分からないですね。 失敗がこのエラーだと、 このエラー表現だと、 成功が失敗かしか表現しないところがあるので、 これ以上知りたい場合には、 もっとエラーハンドリングを使ってあげて、 APS という項目がなかったのか、 期待していた形式と違ったのか、 そういった情報を返す。 今回の場合は、 そんな詳細に教えたところで、 リカバリできるものでもないのかな、 この辺でビックリマークとか、 こういったのを使っていく。 ちょっと期待しないと、 ニルだったときがダメなんで、 もうちょっと工夫がいるんですけど、 どうしようかな、これ。 まずはこれでいいですかね。 ボディのこっちは、 ボディのアドストリングか、 これでメッセージが取れますね。 あとスレッドID、 ランドマークID、 これについては、 APS と同等のところから、 このユーザーインフォで、 いろいろとアタイをたくさん取って、 取っていけるということになったので、 これによってタイトルとメッセージと、 ユーザーインフォのタイトル、 こんな感じで取って、 メッセージが取れるかどうか、 タイトルが取れなかった場合、 タイトルが取れなかった場合は、 ボディが意味がないという状態ですね。 ボディが取れた場合は、 タイトルが取れなかった場合、 ボディが取れた場合、 逆だと両方、 ユーザーインフォのタイトルと、 ユーザーインフォのメッセージ、 ランドマークIDもあるけど、 こういうふうに取ってあげると、 例えば、 個人的にはどっちが好きかな、 こっちかな、 この2つが取れたときに何をするか、 オプショナルパターンを使って、 こういう感じ、 タイトルが取れたときと、 メッセージが取れなかったとき、 タイトルが取れなかったとき、 メッセージが取れたとき、 タイトルのタイトルをアクセルして、 セルフタイトルとセルフタイトル、 セルフメッセージとセルフメッセージ、 タイトルだけが取れたとき、 セルフタイトルとセルフタイトル、 ノーティフィケーションコンテンツ、 ちょっと指標を見てみます。 ノーティフィケーションコントローラー、 オーバーライド化していく感じ、 カンゼルとか、 インタラクティブとかでは、 サッシュから、 サブタイトルから、 RST, 中断する術がないとすると、 何らかのメッセージを返さないといけない、 タイトルはそのままでいいとして、 メッセージはメッセージが得られなかったとき、 何を渡すといいんだろう、 5マイルで目的地に着くよ、 それを設定してるんですけど、 早速にメッセージが出なかったとき、 それはヤバいと思うんですよね、 目的地がランドマークニア、 近くにあるようにしたらいいのかな、 ランドマークニア、 英語じゃなくていいじゃんね、 という感じにしましょうか、 通常の話だと思うので、 わかる人は普通にわかると思うんですけど、 とりあえず、調べてみますか、 このランドマークが、 ほぼ表示されてますよね、 このランドマークが、 チャットGPが出てくれて、 すごい助かるのが、 今まで英語って合ってるかどうか、 どう考えてもわからないんですけど、 チャットGPのおかげでね、 英語が合ってるかもしれないというのは、 自分で判断できるようになったというのは、 英語の学習ですごい重要な、 ランドマークが強いというメッセージを、 とりあえず作れる可能性として、 メッセージが取れなかったときには、 こういうふわっとしたチャットのほうがいいでしょう。 本当に5分でいい。 メッセージだけが取れたときには、 セルフタイトル以降、 これはもうしょうがないですかね、 アンノーンランドマークという風にして、 メッセージとしてメッセージを指定する、 メッセージはオプション。 アンノーンランドマークって、 どちらにおけいがないですね、 なんだろう、 シークレットとか、 シークレットランドマークとかすると、 どうなるのかな、どうなると思うんですけど、 シークレット、シークレット、 これ英語合ってるのかな、 あと2択、秘密、秘密の場所、みたいな感じ、 秘密の場所、秘密の場所は、 英語で何て言うんだ、えーと、 シークレットプレイス、 あーなるほど、そうですね、 多分、多分だとしか言えないんですけど、 あーがあると、あまりなりそうな気がする。 こうして、メッセージがちゃんと送られてくるってことは、 例えば、5マイルにあるとか、 そういった情報が来る中で、タイトルだけが送られてこなかったら、 と思ったタイトルみたいなね、 こういった感じも、悪くないんじゃないかな、実装として、 アンノウンとかよりはずっと、 こうした感じで、タイトルとメッセージが、 条件完全にもう、あれできてない、塗るじゃない、塗るじゃない、塗るじゃないと塗ると、 あれ、ここが、色が、これも関係ないか、オプショナルか何かでしょ、 これで、両方ともオプショナル、両方塗るっていう画面塗れてますね、 そうそう、こういったのを設置分にやると、分かるんで、 重要ですよ、if文とかでやったら、 今、自分はバグを生んでたところを、 防いでくれたっていうね、そういった感じなので、両方塗ったとき、 そうしたときには、どうしましたね、えーと、 まあ、秘密のランドマークが近くにあるって、 最強の持ち上げぶり方ですけども、それにしようか、 案外言われてないなと、今、と思ってしまった、うん、ね、まあまあ、 完全にただの、サーバー側のバグで、これがアップロックパターンに なるはずなんですけど、それによって、何か、ちょっと、 ときめかせるみたいな、何か、騙してるような、何かね、 まあまあ、こういった感じにして、とにかくこれで、基本パターン、大丈夫になったと、 あとは、IDですね、えーと、ランドマークIDか、これを取ればいいわけだから、 ランドマークIDか、ランドマークIDをどう扱うか、 ここがちょっと気になっているところで、そういうのもですね、ランドマークIDで 定されたランドマークと、えーと、実際にIDから引けた、あれ、今、どう言ったっけ、 IDで引けたランドマークの名前と、タイトルに 指定されてきたランドマークの名前がずれたときっていうのが、 なんとなく怖いんですよ、まあ、そういうサーバー側の使用っていうのもね、 まあ、あるとは思うんで、いいのかもしれないけど、 絵が全然変わってきちゃいますよね、今回の場合ね、なので、そこをちょっと予防線 張っておきたいな、みたいな気がするんですよ、で、そのとき、どっちが信用できるかで、 まずコードの書き方が変わってきますね、サーバー側の情報が正しい、 まあ、正しかったらね、IDって言ってるんですけど、 でもね、クライアントの情報のIDがおかしいとか、そういった可能性も あったりするわけですよね、だから、そこを不審に捉えると、まあ、もしかするとね、サーバー側を信頼する、 まあ、ときはね、サーバー側があんまりクライアントの 事業を知らなくて、適当に作ってきちゃってズレるみたいなね、まあ、サーバー 信頼した方がいいかなっていう気がするんで、その方向で撮ってみましょう、 だから、これでやる方法としては、ifretですね、 えーと、どうしようかな、ifretか、えーと、個人的にね、何かとswitch文が好きなんですよ、 まあ、好みもあるんですけど、さっき言ったね、網羅性チェックがif文って何もなくなるんで、 この辺を加味するとね、まあ、あとは、何かこう、何かこうでブロック作っちゃうと、 その中複雑になったりとかするじゃないですか、できる、複雑にしてきちゃうイメージですね、 switch文で複雑にすると、すごい読みにくくなるんで、自分の中でswitch文を書く時って、 あんまり複雑にしたくないっていう、そういった意識が何となく働くんで、 switch文で書いた方が何かとね、コンパクトに洗練されるというのかな、 洗練は大げさかな、コンパクトな行動になっていく気がするんで、switch文を優先的に使いたい気がして、 で、こうした上で、switchで、ユーザーインフォの中のランドマークID、 で、これで、s、red、s、red、redIDのオプショナルパターンね、 IDが取れた時とIDがなかった時、この2つのパターンですよね、 で、これでIDが取れた時にはどうするかっていうと、 redランドマークイコール、モテルデータの、 モテルデータのランドマークスのエレメントIDで検索ね、 あ、で、これですか、ここで取れないことがあるんでしたね、そっかそっか、 そうすると、ちょっとswitch文が複雑になってきますね、こうするとね、 ランドマークのエレメントIDが取れて、で、その後もちょっといろいろやりたいんで、 どうしようかな、こうするとちょっと複雑な気がする、switch文でいいか、 もうちょっとswitch文で書いていってみますかね、 ここでifredでもいいですかね、ifred、ランドマークが取れた場合と、取らない場合ね、 ランドマークが取れなかったっていうことは基本的には予期しないものなのですが、 ここでアサート程度に押さえておいて、 で、ヌルだったらアサーションフィーラー、アサーションフィーラーにして、 メッセージとして予期しない、 予期しないじゃない、ランドマークID、 ランドマークIDが出されていませんみたいなことをメッセージで出して、 それでIDもついでに、ついでにも何もないや、 出されていませんっていうアサートを出して気づけるようにした上で、 今回気を付けておきたいのはセルフの、 イメージ、ランドマーク、あれ、ランドマークIDか、 ID、IDだっけ、コンテンツでID、うん、IDか。 ランドマークID、ここはIDを取りたいだけか、 だからこれでIDが取れたか取れなかったか、 取れないことはまずないと思うんですが、 ただしIDが取れなかったときには外側に、 処理を油断したいのでオプショナルにしましょうかね。 それでイニシャライザー、イニシャライザーは、 これいいな、これいいですね、イニシャライザーね。 だからこれエクステンションでやったけど、 イニシャライザーは、まあいいか、イニシャライザーはここで、 外側からイニシャライザーは別にしたくないので、 イニシャライザーを載せて、ここは初期値は別にやらなくて、 これはファイルプライベートでイニシャライザーできるようにして、 こうした上でここでセルフに入れていったわけで、 でもいいのかセルフで、セルフでいいか、 セルフに直で入れていくか、ああそれでもいいですね。 セルフに直で入れていくなら、 このイニシャライザーも別にいらないというか、 逆にやっぱりエクステンションであれば必要がなかないですね。 イニシャライザーエクステンションで実装しちゃうと、 メンバーワイドイニシャライザーが自動的に追加されちゃうんで、 それを今はちょっとあまりしたくない。 余計なイニシャライズ油断をね、広げないほうがいいんで、 これでファイルプライベートね、こうしてあげればいいですね。 そうしてあげて、こうやって取っていく中で、 失敗可能イニシャライザーになっていて、 ランドマークは、ランドマークがなければ基本的には、 いっぱい取られていいのかなっていう気がするけど、 あとか、あとはここが若干微妙でしたね。 これは外でやることか、中でやることじゃないですね。 ランドマークのメッセージが得られなかった時に、 どうするみたいな話。 こいつの情報は外ですね、中が得る余地もないな、 みたいなそんなところを感じるんで、 そうすると、もちろん書き換えないとダメですね。 コントローラーでやるべきものですね、この辺のファイルはね。 コントロールする側、情報を持つ側ではなく。 そうすると、ここはいや、データはよくてこれで、 データは閉じたと。 ここに開きたか、このコントローラーを、 こういう密になっちゃって、これを閉じればいいのかなってですね。 はい、そうすると、じゃあ情報が取れないことがある、 っていうことですね。 もっと言うと、なりゃないで良いということですね。 そうすると、なおさらパフォーマンスとかを考えるなら、 今のコードでいいんですけど、 そんなこと考えなくていいですね。 そうすると、やることとしては、 まずこのアクションで作ったユーザーインフォ、 これをもうまとめちゃう、これをローバリューというか、 ノーティフィケーションコンテンツ。 これが持つべきものは純粋にローバリュー。 ローバリューをコンテンツが差し替えられる必要はない。 差し替えられてもいいか、いいですね。 これは害がないのでこれで良いでしょう。 そうすると、イニシャライザーとしてもやることとしては、 ローバリューを設定することだけですね。 なのでこれだけで良くて、エクスペンションで、あ、どうか。 でもイニシャライザーで、別にこれをね、 初期化をやらせる必要はないので、 この辺のエクスペンションを言いますね。 このエクスペンションを持ってきて、 えっと、この辺に持ってきといて、 このエクスペンションもコンテンツに対して、よく実装して、 これのアクセスレベルはインターナルTですね。 うん、こんな感じ。 で、そうしてあげた上で、ローバリューのイニシャライザー。 これが、イニシャフロムってのをここで作ってますよね、これ。 これを、えっと、ファイルプライベートイニットか、 ファイルプライベートイニット。 これはイニシャライザー、これもインターナルTですね。 ですね。 なのでこれを、イニシャライザーをここに 生やす感じですかね。 で、それで、フロムコンテンツで、 バードレッド、ユーザーインフォイコール、コンテンツ、 ユーザーインフォ。 コンテンツ、えっと、うん、その手がありますね。 ローバリューがなかったよ、みたいな。 あ、でもなかったら変だな。 アニファッショブルもここが変ですけどね。 どうしようかな。 アニファッショブル、ローバリュー。 え、この、そうなんですけど、 ユーザーインフォが取れなかった時っていうのが、 ちょっと厄介だなというのが、思い浮かんでいるところで。 ま、厄介になったら厄介でいいか。 あまり狙ってすればいいってこともないんでね。 これでガードで、目的の方のユーザーインフォが取れなかったら失敗にしましょう、とりあえず。 で、それで取れた場合には、ローバリューですけど、これユーザーインフォでいいですね。 ユーザーインフォ。 そして、えーと、セルフだから、 セルフ、ユーザーインフォイコール、オーナー。 えーと、なんかインデッドがずれてたのは何だろう。 この後、これずれてますね。 バードレッドでコンテンツで忘れているですね。 リターンに、ここが抜けてるのか。 で、それでカード抜けたら、 セルフのユーザーインフォとして、 あのユーザーインフォをね、入れてあげるよと。 こういう形で大丈夫なのでしょう。 ところで、ここを持ったんですけど、 これガードベースとかやるとどうなの? あ、これが、ここがエラーになるか。 ここが、絵に行こうと。 行こうと。 そっか、これは、あんなのか。 うん、まあいいか。 これでいいか。 いや、ちょっとパターンマッチングで、 いい感じに描くのかなと思って、 バリューバインティングパターンが使えるのかなとかね、 ちょっと思ったんですけど、 ダメとかった。 まあいいや。 ユーザーインフォのノーティフィケーションコンテンツ。 ここで、コンテンツからユーザーインフォを通る形にして、 これで、ユーザーインフォの中のAPIですね。 これで全部、オプショナルの可能性はありますが、 情報がね、テキストで、 テキストというか、このシンボルで 通れるようになったよっていう感じで、 まあ、文字列としてはね、この中に閉じ込めてて、 この中っていうのはね、 まあ、ユーザーインフォに対するプロフェッショナルだと思えば、 OKですね。 これね。 で、これでOKで、 そうした上で、この辺のね、コードが役に立ってくるよってのが、 このコントローラーの方で、 ディスレシーブでノーティフィケーションを取った時に、 えーと、ここでね、 ネットコンテントイコール、 ノーティフィケーションコンテント、 ノーティフィケーションコンテント、 from、 えーと、ノーティフィケーションコンテントか、 リクエストか、リクエストのコンテントかですね。 こういう風にしてあげて、 で、これオプショナルか、 だから、ここでガードが、 いるのかな? ガードがいる、 ガード、 ガード、 ガードがいる、 ガードにするか、 エッドノーンにするか、 今考えてたんですけど、 ガードでいいですかね、 ガードで、 これの場合にはサーブをするという話で、 ここのタイトルとメッセージとイメージをね、 設定しないといけないという状況になっていて、 タイトルは、 えーと、 まあ近くの話だから、 アンノーンランドマーク、 リクエストでもいいんですけど、 アンノーンですよね。 えーと、で、 あとは、これがどこに入るか分からないみたいな、 どういったメッセージにしましょうか、 そうすると、メッセージとして、 えーと、ステージで、 アイドント、 アイドントが出るね、 ウェアリーツとね、 こんな感じで完全によく分からない状況にして、 それで、イメージ、これも見ると、 こんな感じでね、 何にも出られなかったとき、 あの時にはこんな感じで、 抜けてしまって、 アラート、これアラートですね、 アラート、アラートで、 アーサーと、アサーションペイラー、 アサーションペイラーで、えーと、 予期しない、予期しないコンテンツが通知されました、 みたいな風にして、ここにね、えーと、 ノーティフィケーション、リクエスト、 まあ、あの風にね、ここを開けておけば、 ここは普通に来ないわけですよ、 来たときにはデファクティブには落ちるし、 そう言わなければ、こうやってね、 よく分からないランプマークが通知されてきたっていうね、 ちょっと拝見しよう的な、 そんな感じでアプリを走行できると、 で、こうしてしまえばね、 もうコンテンツは手に入ったものなんで、 ここでですね、さっきやったやつ、 この辺が役に立っていきますね、 ここから、もう最後まで、最後まで言い過ぎか、 ここまでいけるんじゃないかな、 えーと、もう全部持ってきますか、まずね、 おそっと、カットして、カット5まで届かれて、 ユーザーインフォーを手に入れた、 ここのレッドがおかしいですかね、ユーザーインフォー、 あ、これもいらないやつだ、 だからこれ全部いらなくて、こんな感じですね、 で、こうしてあげて、このユーザーインフォー、これもいらないじゃないね、 で、これで、うん、これでコンテンツが見取りになって、 で、同様にこっちで、えーと、ノーティフィケーションというか、 コンテンツがね、手に入った状況、 ここですね、これで、ユーザーインフォーだ、 ユーザーインフォーか、どうしようかな、 ユーザーインフォーか、コンテンツですね、 ユーザーインフォー、コンテンツ、 コンテンツはこれでいいんだ、コンテンツなのかな、 ここで、トイッ 마스�にコンテンツが入ってるからいいんですね、 コンテンツね、これでタイトルとメッセージ Two-lineに対して、あの、振り分けしたりて、 で、ここはね、ノーティフィケーションコントローラーなので、 どんどんノーティフィケーションが来て、 そのノーティフィケーションをどう表示したいかっていうのを 絶対知ってる場所がコントローラーなんでね、 なのでここで、状況に応じて、 それは秘密の場所だ、みたいなことを言える、 そういった、あの、演言というか、何というか、 材料というか、それを持ってるわけですよ、 さっきのコンテンツの中でね、これをやろうとしてた時には、 もうそもそも、話わかんないし、 ね、人というか、状況によってはね、本当にアンノーンコンテンツだと、 アンノーンランドマークが欲しいっていうね、 そういった状況だったりするわけですよ。 なのに、コンテンツの中に、この振り分けを入れちゃったとすると、 もうお手上げになるっていうね、 そんな感じになるんで、必ずここに置かないとダメですね、これね。 で、こういうことにすることによって、状況に応じて、 メッセージが無かろうと、タイトルが無かろうと、 いい感じのメッセージを揃えることができて、 で、その例で、あとコンテンツのIDだと、 この辺も、IDから情報を揃えることができますよね。 モデルデータからランドマークを取り出して、 で、それで、ランドマークに対して、 イメージをね、取っていくという形になりますが、 まず取れなかったときね、アサーションフェイラーで、 えっと、アサーションフェイラーというか、 IDで取得したときに、 この目的のね、ランドマークが得られなかったときっていうのは、 メッセージの無償なので、 アサーションでしっかりと、あの、バグをね、 見つけられる状況にしておいた上で、 イメージをね、ニルにしておく。 こうすると、えっと、リリースビルドのときには、 このアサーションが無くなるんで、 検証ができなくなるんですけど、 まあ、無価値なITがネットに入ったときには、 もう、イメージは不一致が恐れてあるから、 ニルにしておくことによって、 仮想が表示されないんだけど、 この仮想が出ると知っている人じゃなければね、 あの、それが正常だと知っている人じゃなければ、 別に仮想が出てなくても、普通に動いてると思うのでですよ。 で、タイトルとメッセージは、 サーバーを信頼するってさっき決めましたよね。 なので、サーバーからちゃんとした近隣情報が来る。 ITが不一致がっていたっていうことは、 なんか、クライアントのデータの差なんだろうということで、 クライアントからのデータに左右されるものが表示させないで、 サーバーの情報だけを出すっていうことがこれでできますよね。 で、さっきリリースビルドのときには、 アサーションが出るので、 まあ、なんかね、開発段階でサーバーから 変な情報が来ちゃってたよっていうときには、 クラッシュして直すっていうことができる。 なので、これは完璧でしょう、きっと。 で、これで情報がちゃんとランドマークで取れたとき。 このときなんですけど、もう一つやりたいことがあってですね。 IDから取れたときに、このタイトルがシークレットの言葉なのか。 どうしようかな。まあ、シークレットじゃない言葉がありますね。 だから、これが正しいかどうか。 こういったこともちょっと知りたいわけですよ。 これをするためには、例えば、ランドマークが取れましたっていったら、 もう一個条件が必要で、 ifretコンテントのタイトル。 コンテントのタイトル上で開発をもう一回使いますね。 まあ、ここは効率よくするよりは、 オブジェクトやクライアントで考えたほうがいいですかね。 なので、パフォーマンスがちょっと犠牲にしますか。 パフォーマンス気になったらキャッシュ取ればいいだけなんで、 出したことじゃないので、 今は簡単に犠牲にしますが、タイトルがコンテントに 設定されていた場合ですね。 なので、ifretコンテントというタイトルですね。 タイトルがコンテントからちゃんと得られた状態。 だから、シークレット、ランドマークとか そういった話じゃなくて、 ちゃんとしたのか、取れた状況で、 かつ、そのタイトルとメッセージのセルフのタイトルか。 あれ、コンテントのタイトルじゃないや。 タイトルが取れた状態で、ランドマークのネーム。 これとが一致するか。 これもサーバーとの仕様によるんですけど、 サーバーは必ずタイトルにはランドマークの名前だけを きっちり設定してくるっていうね。 そういった仕様だとする。 そうすると、これがテップに使うわけですよね。 なので、これによって、例えば、 もしこれが、ifにしたときと、 これが、どっちがいいかな。 ガード。ガードじゃなくて、ifでいいか。 これで、一致していたときには正常なもの。 そうじゃなかったときには、ミスっていうことで、 ガードがいないのか。 ガード。ガードでと、タイトルを取って、 タイトルが取れて、名前が一致すること。 これを条件にして、そうじゃなかったときには、 情報が不安ということで、 ここでまた同じように、 えっと、アサーション。アサーションフィーラー。 アサーション?アサーションフィーラー。 で、メッセージとしては、 サーバーから与えられた、送られてきた、 なんていうのか。 タイトルの名称とランドマーク、 マークIDから取得した名称が一致しません。 こういった感じで、両方配置してあげて、 それで、タイトル。 そして、タイトルで、あとはランドマーク、 ランドマークネーム。 コール、コールでランドマーク。 こんな感じで、両方付加してあげれば、 これで問題として、認識できる状況にして、 さつ、その要は、IDから導いたタイトルが違うっていうことは、 うかつに画像を送れないよねって、そういったお話ですね。 なので、イメージここはニルにして、 これも立派音か、これ立派音っていうのはブレイクしたいな、 ブレイクでいいか、ブレイク。 こんな風にして、このタイトルは? これはオシマルか? タイトルは? ガブレット、ガブレットしましたね。 ガブレットか。 だからこれはコンテンツタイトル。 コンテンツタイトル。コンテンツタイトルで、 ここは、タイトルがニルだったとき。 タイトルがニルだったときもここに行きますね。 ニルだったときどうしようかな。 タイトルがニルだったときは、ニルでいいか。 だからこれで、こんな感じですか。 この辺はログメッセージなんで、 こんなに我慢なくても通じればいいよっていう感じですね。 開発者に送るんでね、大丈夫ですね。 これで、イメージニルでしょ、イメージニルでしょ。 Yのイメージニルとかやってるけど、 これにイメージを設定し忘れたときは、 検出できなくなってるんですよ、セルフが。 直接指定して、これら全部オプショナルなんで、 これは嫌ですね。 だから設定はしたいから、ここは確定書記が使いたいですね。 なので、そうするとやることとしては、 ティーズレシーブでコンテンツが得られてから、ここですね。 ここで、タイトルメッセージイメージでリターン。 リターンしてるから、これもいいか。 だからここら辺からでいいかな。 レッドタイトルがストリング。 これでレッドメッセージ、これがストリング。 レッドイメージが、イメージはランドマークイメージの オプショナルっていう風にして、確定書記化したいけど、 そうするとスイッチブックと若干相性が悪いんですよね。 同じ名前にしちゃうんで、 これ消すと代入できなくなってくるから、タイトルメッセージイメージ。 これでタイトルメッセージ、この辺は 名前をぶらさめていかないといけないんだよね。 やばいですね。どうしようかな。 もうちょっといい方法あるかな。 スイッチブックタイトルとメッセージ。 この辺ちょっと関数に分けますか。どうしましょうか。 そうすると、この辺のノーティフィケーション コントローラーの中で使うメソッドですよね。 エクステンションで、これに入らせますが、 プライベートエクステンションですね。 プライベートエクステンションにして、 それでまずはここでタイトルとメッセージを選ぶということですよね。 タイトルとメッセージを選ぶコンテンツからね。 これをするには、まずここまでカットして、 それでここでタイトル&メッセージ。 あまりメソッドに&というのを前付けないですけど、 一つの関数には一つの役割を持たせるということが、 基本原則、その原則が正しいかどうかは別として、 この方がシンプルに書けるというのがあるので、 あまりタイトルとメッセージみたいなことは しないかもしれないんですけど、 でもシンプルである状況をそれだけ考えれば、 普通にいっぺんに2つやってもいいとは思う。 &当たっちゃいけないとか、そういった問題ではないはずなのでね。 タイトル&メッセージとしてフロームコンテンツかな。 これでノーティフィケーションコンテンツ。 戻り値としてタイトルがドリンク。 メッセージがドリンク。 こういうふうに返すようにする。 これでスイッチのさっきオフィスできたやつを持ってきてあげる。 こうしてセルフとか言ってないで、この辺は全部ね、 普通に、あとはもうタップルで返しちゃっていいですね。 タップルで返しますか。 これいっぺんに書き換えるできるかな。 ま、とりあえずやってみますか。 これで選択をね、4箇所かな。 これで1箇所。 こんな感じにして、これ消していけばいいよね。 消して、丸パッポでタップルを書いて消していって、 ここの数一緒かな。 一緒だ。 だから、メッセージ、あとはメッセージ。 あ、上手くいったね。大丈夫ですね。 これでいいですね。 こうしてあげると、絶対にあの、メッセージとタイトルのね、 次がオプショナルではなく返せるっていうね、ここが大事。 なので絶対にこのメソッドの中でもではないというね、 そういったことですね。 そうした上で、ここで、えー、するのは、えーと、 これで、どうするといいんだこれ。 えー、タイトルとメッセージ。 あとでこれ、あの、えーと、なんだっけ。 確定書記か、確定書記か使いましたけど、 確定書記か使わなくても、タイトルとメッセージ。 えー、思ったんですが、これはアーティフレーシブか。 じゃあいいや。大丈夫。あの、イニシャライザーだった気がした。 イニシャライザーだと、タピックメソッドしかね、呼べないんで。 これでコンテキスト。で、こういう風にしてあげる。 あ、コンテキストじゃない。コンテントね。コンテント。 してあげると、そうそう。これで、あの、タイトルとメッセージが確実に決まりましたよね。 これでね、OKですね。 こんな感じで、ランドマークIDからイメージを同じように決める。 タイトル&メッセージフロム、オープン、オープン、タイトル&メッセージ。 うん、どうしようかな。名前をちょっと今考えてるんですけど、タイトル&メッセージフロムってなんか変ですね。 コンテント。コンテントが持ってるところからタイトルとメッセージを打ってますよね。これね。 ね、なんかシンプルには取ってないですよね。 なのでちょっと、メイクの方がいい気がするな。メイクタイトル&メッセージ、えーと、ビズかな。 こんな感じの方がなんとなくいい気がするけど、あれ名前がちゃんとわかんなかった。 メイクタイトル&メッセージビズコンテント、この方がいいですね。 こうしてあげて同様にイメージも同じ名前の付け方ができますよね。 えーと、だからこのランドマークIDを取って、この辺までかな。 まあ全部持ってっちゃいますか。とりあえずね。これで先に書いておきますかね。ここに、あれ今インデッド変だかな。 これでイメージイコールメイクイメージビズコンテント。 ちょっと名前が微妙な気がするけど、上はOKですね。 あとイメージを作ってる。まあ作ってるか。メイクランドマークイメージにしようかな。 ランドマークイメージ、イメージ。そうしようか。ランドマークイメージがあった。 ランドマークイメージ。ちょっとうるさかったかな。まあいいか。これでできたと。 ランドマークIDがいつの間にかいらなくなってるでしょ。これでこの辺で、ディプレシーブでランドマークイメージが。 ランドマークイメージはないよっていう風にして、ここでランドマークイメージ。 これでメイクランドランドマークイメージ。このメソッドを下に追加してあげると、ファンクション、メイクランドマークイメージ。 で、ウィズコンテキスト。で、ノーティフィケーションコンテキストで。 もと一はランドマークのイメージだけどこれはやられないこともありますよっていう状況にして、 コンテキストでコンテントね。コンテント。で、まずはランドマークID。この辺はガードで一決方ですかね。ランドマークIDが手に入らなかったんだったとしたら、イメージは安定のため取らないでおくっていうね。そういった選択に変わるんで。ガード、セット、ランドマーク、IDコール、コンテントのランドマークID。 これが取れなかったんだとしたら、アサーションフェイラー。アサーション、アサーション、アサーションフェイラー。アサーションフェイラーでランドマークIDが提示されていませんという風にね。 安定のためは何でも入れ替えればいいわけじゃなくて、さっきも言っている通り、ワクチンが持てない状況の時には画像を表示しないことによってさらっとね、話を済ます。 そういう話の済ませ方ができないときにはここがフェイラーですね。ランタイムにとっておかしいことを起こさないので、これでタイトルですね。 まずね、入れ替わりで突き進んでいける状況にしつつ、ランドマークIDが取れたので、そうするとここでね、スイッチブックが逆になった。この入れてる可能性がもう排除されてるんで、次のお話に行けて。 次のお話は何かというと、ランドマークがモデルデータから取らないといけないのか。 モデルデータはどこから取ればいいか。ランドマークwithコンテンツでランドマークをどう渡しますかね。 ここがね、元々ダメなんですよ。とりあえず。ランドマークの情報をここでディフォルトイニシャライザーで作ってるんですけどね。 ここでディフォルトイニシャライザーで作られても困るところがあるじゃないですか。 データは今どこに持ってたっけ?アプリケーションが持ってた気がするんですけど、ランドマークが。 ランドマークが持ってますね。プライベートバーでモデルデータ。プライベートバーか、ネスペとか。 これを渡したいんですけど、これを渡せるにはそいつとUIできるんですかね。UIとかアプリケーションで良かったじゃないですか。 NS UIアプリケーションシェアとか。UIアプリケーションシェアとかありますね。でもランドマークアップは取れなそうですよね。 取れるんですけど。取れないか。UIアプリケーションシェアとはプラスで取れますね。取れないですね。 どうしようかな。この両方。モデルデータ。ここで一元管理されてるわけで、これは取らないと本来ダメじゃないですか。 そうすると、モデルデータ。モデルデータを誰が管理するか。モデルデータをランドマークアップでアプリケーションですよね。 アプリケーションでやるとすると低ゲート。低ゲートが持つ感じ。ボディエンバイロメントでモデルデータを渡しているか。 モデルデータを渡しているけど、これをスペースで管理しないといけない。なるほど。 これもしかして、すんでません。コードが。管理の仕方がノーティフィケーションを想定しているように見えないような気がしてならない。 この中で、モデルデータでその中のデータを書き換える可能性があって、書き換えたとしてフェバリと書き換えることになるわけですけど、このデータは演作化してないよね。 だから、演作化だけならいいんですけど、なんだこれ。やばいじゃないですか。データが一元管理されてないのか。 だから、工夫しないといけないですね。ちょっと後回しですね。なので、このモデルデータ。 何かしないといけないことがわかったんですが、一応カットして。それでさっきの中に持っていきますけど。 だからここら辺、ガードのアプリかな。これで、これはもう完全にFixMeですね。 情報をこのアプリ内で。情報とかモデルデータですね。 モデルデータをこのアプリ内で共有。また共通のもの。なんだろう。モデルデータが。 モデルデータをこのアプリ内で。なんて言ったらいいんだこれ。アプリ内で買っているもの。日本語また変ですけど。 買っているものを買わないといけない。ここでですね。ここでモデルデータは買わないといけない。 なのにここに演作化している。やばい。なんかすごいやばい。とりあえずこれでいきますけど。 モデルデータからランドマーク2エレメント。IDによる検索をかけて。ここもガードでいいのかな。ガードでよくなりましたね。 これね。カードレッド。ランドマークでヘルス。もし見つからなかった場合には。 アサーションですね。またね。アサーションフェイラーで。 ここの中でメッセージとしてはランドマークIDのランドマークが見つかりません。日本語変ですね。 ランドマークIDのランドマークが見つかりません。 日本語力がやばい。これでIDはランドマークIDですね。 ランドマークID。これでIDこれが見つからないよ。 どこに見つからないのかというとモデルデータですけど。ここはいいや。とりあえず。 これでこの場合も画像表示しなければ済むだけなんで。 継続できないときはケータルエラー。これでOKですね。 そうするともうこれでランドマークが見つかったという点々になるんで。 どうしたらもう一個かどうか。カードが多すぎるけどもこれはアプリケーションならしょうがないですからね。 ランドマークのIDが見つかったときにさらに矛盾がある可能性っていうのが怖いんで。 判断するわけですけどちょっとこのアプリのことですね。見えるようにしましょう。 こうしてあげて。だから要はここですね。イメージを取るときに。 要はIDがあるかなんと。どれが重要ということにして。 で、IDに合体するランドマークが得られたかつ。 これがコンテンツで渡されたタイトルとランドマークのネームとが一致するか。 これが一致しないときにも安全のため画像を表示しないということを選択するという感じですね。 そうするとかなり安全ですね。こういうの重要ですよ。考えていく。 これでカードが揃って。もうこれで完全にランドマークが期待通りのものだという証明が得られたので。 この段階で一旦ですね。もうランドマーク。ランドマークのランドマークのイメージ。 こうしてあげれば完全に適切なイメージが取れましたというね。 こういったお話になってパンパンタイトル。またトピック墨が残ってますけどね。 で、これで切り回した後になるとこの辺がフォードだ。 ディプレイシープした後にコンテンツを取ってそのコンテンツからタイトルとランドマークイメージが取れました。 そうしたらというかもうこれで終わりですね。これでいいですね。 もしこの辺りの設定を忘れないように本気でしたかった場合には、 確定書記化を使って3つを例えばこれらを全部ローカル編成にしてしまって、 最後にね、セルフ、タイトル、イコールみたいな感じにしていく。 でもディプレイシープか。これでいいですね。大丈夫パターンマッチね。 パターンマッチの中でもと言い訳、失敗しないパターンマッチというのがね、 そういう人の中で4種類くらいあったと思うんですけど、それを使って代入していく。 こんな感じね。プロパティにもできちゃうというのもなかなか面白い工夫ですよね。 これと一緒ですけどね、これもアイデンティファイアパターンで代入してるだけなんでね。 はい、こんな感じ。これでディプレイシープOKですね。 この辺に残ってるのはもう残骸ですよね。たぶんね。 ユーザーインフォーを取ろうとしていたときの残骸なのでこれはもう消してしまえばよいか。 で、これでできた。できましたね。できたけどどこまでできたか。 ビルドをしないとちょっと忘れているという状況ですが。 これでこの辺がコンバートできない。 ITがコンバートできない。 このITがおかしいですかね。 ランドマークIDが間違ってますね。 ランドマークID。これで全部できたと。 これでビルドをかけて実行するまでできるんですかね。 これは大丈夫ですね。シミュレーターの実行するタイミングを切り替えますが。 これでOKと。 リプレイスでこれでシミュレーターが動いた。 動いて、これをホームに戻した上で ノーティフィケーションのテストを投げてあげると なんと1個のパターンが落ちた。ペータルエラーが落ちましたね。 タイトルがニルでネームがシルバー・サーモン・クリスか。 ランドマークは コンテンツはコードとなりに出しておきました。 UserInfoからアラートのタイトル。 APSのアラートのタイトル。 アラートが間違えた。 アラートタイトル。 バグですね。 アサーションがコードのミスを教えてくれている。 自分のミスしただけですけど。 アプリが動いてフォームに戻し。 通知が表示されていて。 動いてくれましたね。 こんな感じでリファクタリングをしてきましたけど。 時間の都合でこれくらいにしておこうかと思うんですが。 まだリファクタリングする価値が残ってそうな気がするんですよね。 気がするってここは大丈夫ですね。 ノーティフィケーションコントローラーはちゃんとリファクタリングできた感じがするんで。 あと残すところはフィックスミーですか。 これモデルデータどうしましょうかねっていうそういった状況になっていて。 フェーバレットを管理しないといけないという状況。 バインディング。 バインディングがまたライフサイクルに依存していた感じがあって。 アプリのライフサイクル内で何とかしないといけないわけでしょ。 そうするとどうするんでしょうね。 イングルトン?イングルトンで何かできるのかな。 その辺はもうちょっと考えないといけないんで。 ディパイはそれですかね。 そうですね。 次回はこの辺を見通したとおりですが、 モデルデータを何とかしないといけないというところと 残り他に何かアプリウォッチ周りでリファクタリング必要なところは何か そんなところを見ていこうかなと思います。 はいではこれで終わりにしますね。お疲れ様でした。

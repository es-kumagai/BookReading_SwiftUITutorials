Transcription & Summarize : とりあえず読書会 SwiftUI Tutorials #34

はい、ではというわけで紹介を始めていきましょう。 Swiftというわけでとりあえず、今までiOSで作ったものの、 マッチOSアプリが終わり、ついでにMacOSアプリがだいぶ進みという状況ですけど、 その状況で、ボードがちょっと微妙な感じがするところがあるので、 今日はそのリファクタリングを主にやっていきたいなと思うんですけれど、 その中でも、とりわけカテゴリーの検索ですかね、その辺りがなんとなく気になるところがあるので、 それを直していきたいなと思うんですけど、 前回の中で考え方としては、考え方次第では悪くないよねという話をしたのが、 このランドマークリストのカテゴリーフィルターの中にあって、 その中でフィルターの種類として、オールとレイクスとリバースとマウンテンズ、 この4つが用意されているわけですけど、 このレイクスとリバースとマウンテンズと比べて、 オールがちょっと異質に見えるというのがすごく気になるところで、 要はこの1つと3つ、この関係がすごく劣化が立って、どっちかというと綺麗に配達的に、 これまたはこれまたはこれまたはこれという表現をすると思うんですけど、 これはちょっと考え方次第でいいんですけど、 フィルターとしてつまり考えればいいんですけど、 カテゴリーとして捉えたときに違和感を覚えるというのがまず1つ。 ただしその考え方次第では、 ランドマークリストにおけるフィルターカテゴリーという価値観の中では、 この4つが対等に並んでいると捉えることが可能ではあるので、 それでもいいんですけど、 ただ報道を見たときにですね、フィルターの条件を作るとこですね、 フィルターランドマークですか、この中に条件として、 ここですね、カテゴリーフィルターがオールのときにはこれ、 それ以外のときにはこれみたいな感じで、 やっぱりバランスが崩れている感じがあるんですよね。 それ以外、条件分岐を同じ価値観だったら、 まず全部を均等に分岐するか、 または分岐されなくていいかみたいなね、 そんなふうな状況になるはず。 これが1つ気になるところと、 まずはここですね、フィルターのローバリューと ランドマークのカテゴリーのローバリューとで比較していますけど、 このときももちろんオールに対してローバリューというのは、 このカテゴリーのローバリューとは違うわけですよね。 あともう1つ言うと、 ランドマークのカテゴリーとフィルターが表すカテゴリーって、 オールさえなければ同じものなんですよ。 なのでここも、同じものだったら同じもので表現しちゃったほうが、 何かといいことあるんじゃないかなというのが気になるので、 またその辺りは直していきたいところ。 うん。 まずそれをやるか、 あともう1つ気になるところとしては、 今回、フィルターをつけたときに、 お気に入りか否かによってリストが変化して、 お気に入りのみってやったとき、 そのときにリストから除外されてしまうと、 要塞画面のところのお気に入りの切り替えが、 画面上表現されないっていうね、 そういった問題が起こっていたっていうのがあって、 前回なんとかね、ちゃんと動くように、 ボードを直したわけですけど、 そこがまだちょっと汚い感じするんで、 それを直していきたいなというのが、 これもこれですよね。 例えば、L、Uとかの、 レッドレイルというところの要塞をね、 見て、 で、これで、 お気に入りを切ったとき、 このときに今ちゃんときますけど、 あ、そうね、今切るのは当たり前ですね。 こうやって、えーと、 あれ、動いちゃうと動くよね。 カーソルが長いんだけど。 うん、まずこうやって、 あ、なんかもう1個出ちゃってる。 無事にしようか。 これね、これを選んで、 これでね、お気に入り、 こう入れたり消したり、 できるわけですけど、 これをお気に入りのみに絞ったときにね、 お気に入りのみの中で、 これで、 だを外すと、 この時点で、 何も手を加えてないときには、 ここの左側のリストから、 消えるんですよね、 お気に入りのみなのでね。 そうすると、この後ろのバインディングが 切れてしまって、 あの、オン・オフが、 ちゃんと再表示されないっていうね、 状態は変わってるんで、 まあまあいいんですけど、 お気に入り状態が、 反映しない。 また矛盾するというかね、 表示がね。 そういったのがあって、 お気に入りを、 こうやってオンにしたとき、 とかオフにしたとき、 お気に入りのフィルターが有効だったとしても、 消さないっていうね、 そういった対象とか。 ただこうすると、 他を選んだ瞬間消えますよね。 まあもちろん、 それで良いと言えば良いんですけど、 どっちかっていうと、 これ1回フィルターをオフのか有効か無効か、 こういったのね、 変えた後、 この、 フィルターの条件、 これが変化し、 するまでの間は、 表示をそのまま維持する、 みたいなことをしちゃったら、 良いんじゃないかなと思って、 まずそれやってみますかね。 そうすると、 こうやって、 お気に入りオフにしたときに、 他にどうしてもそのまま居座るっていうね、 そういった感じ。 どっちが好みかというか、 どっちが使用として求められるかによって、 変わってくるとは思うんですけど、 まあ今回ね、 あくまでも自分の考え方、 方針としては、 フィルターをいじるまでは、 フィルタリングしたものがそのまま残るっていうのをね、 やりたいなと思います。 そうすると、 えっと、 やろうとしていることというか、 これでできることとしては、 何がありますかね。 まあ要は、 フィルターした結果を、 なんかちょっと取っておく。 で、 フィルターの設定が変わったときにね、 この内容、 それを、 えっと、 反映させていく。 なんかちょっと取り直すって感じですかね。 まあそういったところをね、 やっていけばいいのかなと思うんですけど、 やっていくにあたってそういえば、 まあ今何やってるよっていうのを、 画面で見れた方がいいのかなと、 不意に思ったんで、 ちょっとテロップつけられるかな。 えっとテロップは、 えっと、 これか。 ちょっとやってみますね。 えっと、 材木のテロップ。 えっと、 打ってみて、 とりあえず、 えっと何でしょうかな。 えっと、 フィルター設定を、 あ、なんかバケてる。 えーと、 フォントの選択で、 あ、これじゃバケるな。 エルベティカになってるんで、 これを日本語フォントにしないといけないですね。 えーと、 日本語フォントは、 ひらぎのですね、 マックなのでね。 えーと、 ひらぎの、 えーと、 えーと、 どこだ。 ひらぎのフォントがたくさんある。 いやでも、 フォントも豊かになりましたよね。 昔は本当になんか全然なかったものですけど、 ひらぎの、 しかも綺麗だしね、マックだとね。 ひらぎのサンズ、 これでいいかな。 これで、 サイズは、 まあいいか。 太さがW3ぐらいかな。 こう出てきた。 ちょっと巨大すぎますね。 サイズは普通に、 そう。 あ、まだ出てないかな。 あ、まだ出てないか。 ということでね、 今調整中なので、 もう少しで出てくるので、 えーと、 少々お待ちを。 えーと、 それでフィルターの文字のサイズもそうだし、 フィルターのテロップのプロパティとして、 えーと、 フ� ちょっと小さいのか。 じゃあ64、 64ぐらいだと、 あ、それでもこんなにか。 ちょっと写しながらやってみますか。 せっかくなのでね。 えーと、 出るかな。 あ、これで多分、 上の真ん中辺に映ってると思うんですけど、 これからやろうとしてることね。 これを実際に寄せつつ、 どっちにしようかな。 右上がいい気がするんですよね。 ということで、 ここにしてできてるかな。 これはまだ有効にしないと。 移動しないと。 あれでね、どっかに移動したと思うんですけど、 まだちょっと小さいですね。 うーんと、フィルター。 フィルターの設定。 フォントが64とか近いのかな。 74、 96ぐらいにしてみます。 これで 見えないなりに、 ちょっとやってみますか。 左の線難しそうだからとりあえず、 あ、右の線難しそうだからとりあえず、 左上にしておいて、 フィルター設定を操作した時にだけ、 反映させるみたいな感じでね、 やっていこうかなと思います。 題目、題目、まだろ、まだか。 まずはね、こんな感じでやっておいて、 またね、ゆっくり調整しますが。 はい、じゃあこれで一本ずつ行きましょう。 じゃあそうなんで、やっていこうとしますが、 結集のトリッパーが一つですよね。 題目分かりにくいかな。 やろうとしていることをもっと細かく書いてますかね。 なので、つまりは、やろうとしているのは反映させて、 フィルター設定を操作した時にだけ、リスト、フィルター状況をリストを更新する。 これでやさそうですね。 やっていること、題目というか、 やっていることですかね。 まあいいか、題目でいいや。 はい、じゃあこれでOKですね。 やっていきましょう、さっそくね。 まずは、まず見にくいか、ほんのりにしてもね。 更新する。 これで下の方におとこかな。 下なら、あ、下いいですね。 スペース空いてましたね。 ここにしましょう。 よし、じゃあいけますよ。 そうすると、フィルターが変わったことを反映できる。 反映というか、認識できる必要がありますよね。 カテゴリーフィルターを反視するということになるのかな。 カテゴリーフィルターだけじゃないか。 カテゴリーフィルターと、あとは、えっと。 上フェーバリッツオンリーですか。 あとというと、上フェーバリッツオンリーだけ反視すれば十分な気がするんですけどね。 それだけでいいのか。 上フェーバリッツオンリーを純粋に反視して、カテゴリーフィルターの変更を変更しないといけないから。 この辺りをフィルタリングとしてまとめちゃったらいいんじゃないかなと思うんですよ、構造体で。 まずはね。なので、ランダムアップリストの中にフィルターという型を作りましょう。 エクステンションで、ここにかな。 フィルター、フラクトですね。 それでフィルターという形で作って、このフィルターを、例えば、バー、上フェーバリッツオ この2つ、これを構造体として持たせて、 これでフィルターを表現するという風にするのがまず1つ。 その時に、このフィルターをハッシャブルにしておけば変更を認識できるようになりますよね。 なので、これによってフィルターを判断できるようになる。 フィルターの変化をね。 それで、まずやってみますが、そうするとカテゴリーフィルターとプライベートバーのフィルターとして フィルターとして、フィルターとして、上フェーバリッツオンリーと 上カテゴリーフィルターの両方をそれに含めてあげちゃう。 そういうことをするんですが、この時にフォールを出して、フィルターカテゴリー。 これは、フィルターカテゴリーはオチOSではサポートを今してないんですよね。 なので、それをオリジナルフォードにする。 それとも、オチOSでもフィルターをできるようにするか。 まずは、いいか。まずは、MacOSとiOS。それだけで想定する。 そうなった時に、この型でちゃんと作っておいた方がいいんですかね。 フィルターで、カテゴリーフィルターはiOSまたはMacOSの中でね。 これで型作って、あとは初期値。初期値として、カテゴリーフィルターはフォールですね。 これを初期値にして、そうすると、この初期値がフィルターができ上がるので、フィルターができたらそのフィルターを使って、いろいろ条件を整えていきますが、まずフィルター側を解消しましょう。 フィルターは、今フィルター値が使っているところはね、そこね。 これがフィルターというのかちょっとわからないですけどね。オプション。まあいいか。フィルターの上フェーバリッツオンリーの状況によって推定しますよね。 あとはこの辺かな。まず1回フィルターしますか。カテゴリーフィルター。この辺がフィルターのカテゴリーフィルターですよね。 フィルターの消費フェーバリットオンリー。 こんな風にして、フィルターのカテゴリーフィルター。 カテゴリーフィルターでいいですね。そうするとね、怠くなったと思ったので、フィルターの消費フェーバリットでしょう。これでまずフィルターをかけてみましょう。 あとはどこだろう。ペン入れるのは。 mac os のフィルター。 カテゴリーフィルター、見付からないです。ランドマークリストのカテゴリーフィルターが mac os のところで見付からない。 ここですね。カテゴリーフィルター。 これがフィルターのカテゴリーフィルター。フィルターのカテゴリーフィルター。 ここもそうですね。フィルターの消費フェーバリットオンリー。 これで大丈夫かな。 あとは条件なんか忘れているところはあるかどうかですが、またフィルターの消費フェーバリットオンリーが、 ファイニング、フィルター消費フェーバリットオンリー。これが、 ファイニングと言われているプール。 消費フェーバリットオンリーは普通にプロポティ、これがリストメニューモディファイヤー。 消費フェーバリットオンリーのファインディング。 これは良いのか。フィルターカテゴリーはわかっておりそうですね。 これが良いとして、消費フェーバリットオンリーはここと、 フィルターが消費フェーバリットオンリー、名前間違えたかな。 フィルターの中で消費フェーバリットオンリーという形で出ていいんだ。 そうした時にビルドをかけて、ビルド成功ですね。 こうやってビルド成功したら、今まで通り動くと思うんですけど、ついでにもう1個やっておきましょう。 プランドマークリストのこのステップが、フィルターステップがあるところで、リストですかね。 ここがオンリーの中のリストの中で、オンチェンジね。 オンチェンジ、オブ、フィルター、フィルター、フィルターで、 消費フェーバリットオンリーのオールド、オールド、フィルターとニューフィルターですね。 ファイヤーを使って、この中でプリント。これで、どうしようかな。 ニューフィルター。フィルターが変わったことを検出できれば、まずはOKという感じですね。 なので、これをビルドかけてみて、ここはイコーダブルで良かったですね。 ファッシャブルじゃなくても良い。 だったらファッシャブルにしないという点も1つあるのかなというところで、気になる。 どっちが良いかな。ファッシャブル、イコーダブル。 ファッシュバトルでも良い気がするんですけどね。 推し差を取るときにファッシュ値を取って、マウス、まあいいか。とりあえず実行。 これで動きがまず問題ないことを確認しつつ、あとはログも一緒に見たいから、並べて実行しますかね。 これで並べてというか、見えるところで実行しますかね。ログはここですね。 ここのログで、今何も出ていない状態で、 まずリストを触る分には何もないです。 フェーバリットの状態チェックのログが出る程度ですよね。 この星をクリックしたところで状態変化が起こる程度。 このフィルターを変えたときに、例えばフィルターをチェンジしましたね。 そういうのとか、あとここでマウンテンズ、これも変化しましたね。 あとフェーバリットオンリー、これも大丈夫ですね。 動いている感じが見にくいかなと思うんですけど、ちゃんと新しいフィルターになっているんで、これで準備が整いましたね。 オンチェンジで検出してフィルタリングを整えられれば、これで問題なしですね。 そういった感じで実装を整えていきますか。 Xコードはもう再開ですかね。 それでやることとしては、まずはフィルターがもうフィルタリングできている。 フィルタリングの中のフィルターというのに入ったんで、 カテゴリーですね、ここね。リファクターリネーム。 カテゴリー、というかカテゴリーズ。 カテゴリーフィルターじゃないとしたらカテゴリーズですね。 カテゴリーによるフィルターができるようになっているし、 その名前も問題なくいい感じに表現できているかなという状況になった。 そしたら、フィルタードイスランドマーク。 これはフィルタードランドマークの中で。 これを切り出して、フィルタードランドマークの中に 加入したみたいな感じですね。 そうしたときにどうしますかね。 フィルタードランドマークでしょ。 フィルターを作るときにフィルタリングできるものとしては、 やっぱりランドマークリストですね。 なのでランドマークリストに持たせると良いということですね。 表示中のランドマークは、フィルターとか言ってないっていい気がしますが、 とりあえずフィルタードランドマーク、 これを保存型プロパティに取り扱えて、 で、プライベートセットですかね。 プライベートセットにして、 で、それで、アンス、新たに。 アップデートランドマークリストにしました。 こういった感じで更新するこの機能で、 フィルタードコンディションでフィルタリングを作っていって、 最後にリターンじゃなくて、フィルタードランドマークに バインドしたのを入れてあげるという感じですかね。 そうしてあげると、これで更新が可能になったので、 やることとしてはまず、フィルターが決まっている。 で、ランドマークのリスト。 これがバインディングでランドマーク数という形に。 バインディングでランドマーク数となっていますが、 なっているか、その初期値がまだ決まっていないのか。 今、ビルドするとこの28GBになるんですがね。 リフがイミュータブル、あ、これか。 これはミュータブルアクションですね。 アップデートはミューティング、ミューティングだ。 ミューティングファンク。 で、これであとは、パラメータ、 フィルタードランドマーク、ランドマークリストね。 このランドマークリストの定義の中で、 フィルタードランドマーク数の値が決まっていないので、 これを荒っていけるかな。 バインディングにしないといけないから、 バインディングで、あら、もうこれでいけるかな。 そういう拡張を作ったはずなんでね。 これも拡張はさすがにいけないですよね。 今、これなんで。 とりあえずフィルタードランドマーク数だからという状態でね、始まって。 それで、フィルターと、フィルターと、あとは、 No favorites only、要はフィルター。 フィルターが決まっている状況だから、 これ、そっか、イニシャライザーで頑張らなくてもいいですね。 これを、フィルタードランドマーク数を、 予期をしないでね、持たせた上で、 イニシャライザーを定義してあげて、 このイニシャライザーの中で消化すれば十分ですね。 なので、フィルタードランドマーク数に対して、 The update is self だから、 これだとダメですね。 あので、タップデートランドマークリストというのを作った上で、 それと別でプライベートファンクで、Makeランドマークリストとして、 オートリッジとして、バインディングのランドマーク。 これをね、とりあえずそういった関数を作ってあげて、 この関数内でリターンをする。 押してあげると良さそうですね。 押してあげて、で、リターンしたら、このアップデートランドマーク数では、 これを使って、フィルタードランドマーク数、それに対して、 Makeランドマークリストを入れてあげるということをすれば良いと思ったんだけど、 アサインできない、バインドランドマーク、あそこランドマーク数ね。 ランドマーク数、ランドマーク数ですね。 これでできたと。うん、良いですね。 これプライベートファンクションなので、ここにも良くなくないなというのは単純な好みですけど、 これはとりあえずカットして、で、場所としては、プライベートエクステンション、この中ですね。 ここは片手にしているだけなので、もっと下にしましょうか。 プライベートエクステンション、ランドマークリスト、で、この中で、ファンクション。 プライベートファンクションで、Makeランドマークリスト。 これで複製を無しの状況で使えるので、これができれば、このイニシャライザーの中でも、 Makeランドマークリストということで、フィルターを有効に使っていける。 次にフィルターも調整しちゃいますかね。 フィルターも初期値を与えるのではなく、これを、フィルターイコール、フィルターという形で初期化して代入してあげて、 ここでは片手にしましょう。フィルター。 で、これで良さそうですね。ちょっと順番変えておきますか。 順番変えるとインターフェース化が出てくるので、状況によっちゃうかなと思うんですけど。 で、ここから上のほうでいいですかね。 押してあげて、セレクティックランドマークがおそらく要らなくなるんですよ。 この状況で作り進めていくと。 なので、セレクティックランドマークのIDですね。 これを無くしておくか、それとも残しておくかというのが、一つ残っている意味のあるところ。 セレクティックランドマークを残しておくと、選択中のものが知れるという特典があるので、 これは残しておきますかね。 で、大体のところはIDを保持しているので、生まれていますね。 エンゲームで、セレクティックランドマークIDですね。 で、オプショナルで表現されているので、選択がなければ、二郎指すという感じですよね。 良いですね。 で、フィルターがあって、ショーイングメニューという状態変数があって、 ショーイングプロパティというプロファイルという状態変数というか、バインディングですけど。 これを待って、これでいいですね。できた感じがしますね。 で、あともう1個として、フィルターがこれだと更新されないので、 オンチェンジのところですね。 で、そこで、あったオンチェンジで、フィルターが変わったときに、 アップデートランドマークリストですね。 バーで、とか、ミューティングじゃないのか。 アップデートランドマークで、ランドマークを更新できるようにするには、 これ、ステッドにしないとダメですね。 アップデートランドマークステッド、プライベート版にしないとダメですね。 で、それで、その上で、アップデートランドマークリストを ミューティングではなくて、ノンミューティングにして、これでいいですね。 これでできた。今日も出てきたかな、これで。 まだ、ペラですね。明日か。 で、ここで何を待たそうとしているのか。イニシャライザーでショーイングプロファイル。 イニシャライザー作っちゃったから、 つけておかないといけない。 ショーイングプロファイルはバインディングなので、 ショーイングプロファイルはバインドですが、 アンダースコアはショーイングプロファイル。 あとは、メイクランドマークリスト。 あとは、メイクランドマークリストは自分のプロパティを使っちゃうから、 これじゃダメなんだ。 なので、やることは、スタティックファンクションにしないといけないですかね。 なので、プライベートスタティックファンクにして、 メイクランドマークリストwithフィルターとして、 データ型を受け取り、という風にすれば、 必要な情報が揃いますよね。 その前は、セレクティックをフィルターに残そうとしたんですよね。 ただ、今回はこれがいらなくなりますね。なので、 ブラグを変更するという事は、今回はしない。 と言うことにして、フィルターS5で、 セレクティックが。ここがいらないですね。 こんな感じ。 モデルデータでファインディングランドマークス。 ランドマークスは、モデルデータの ファインディングランドマークス。 これをフィルターしたものを設定しないといけないから。 ランドマークスは、モデルデータから取るのか。 そうすると、モデルデータはエンバイルメントですよね。 ここじゃできないんだ。なるほど。 そうすると、サティックファンクにする必要がなくなってきましたね。 イニシャライザーをセットして、そうですね。 なので、そうすると、モデルデータを渡すにあたって、 サティックである必要がなくなるから、 普通のファンクションにして、バインディングのリストをSということにして、 ビズフィルターもいらなくなって、それでこの後、メイクランドマークを イニシャライザー内では呼べないよという話になってくるんで、 つまり、ここでやることとしては、まず、 ジョイングプロファイル、イニシャライザーと同じような、 フィルターとして既定値。 それで、バインディングのランドマークスとして、 バインディングの値ですね。 ここでいいですね。 こうしてあげて、イニシャライザーがいらなくなって、 それであとは、フィルターというかランドマークのリストが更新されるように、 リストが表示されるときですよね。 このタイミングで、アップデートランドマークリストを読んであげる。 あと、フィルターが変わったときも読んであげる。 こうしてあげると、多分これで、フィルターができた後、 アプリが動いて、リストがちゃんと出てますよね。 リストが出ていて、これで、お気に入りをオンリーに変えると、 オンリーだけになって、 これを選んだときに、押してもリストからは消えずに、 あれ、押せなくなるのか。 あ、失敗しましたね。 えっと、押せなくなるか。 ファインドがおかしいってことですかね。 スナップショット。 リストを更新したときに、スナップショットが変わっちゃう。 エイクし直して、大丈夫そうな気がするんですけどね。 でも、ダメと言ってますよね、これはね。 明らかにね。 失敗しましたね。 これじゃダメなのか。 やったこととしては、フィルターが変わったときにオンチェンジが発動して、 フィルターが変わってなくてもいいか。 まずちょっと一回やってみましょう。 もう一回、アプリ起動して、 で、この後ね、何も変わってない状況。 フィルターを、この状況で押し、 もうこの中で動かないですね。 ダメか。 っていうことは、アップデートランドマップリストをやった時点で、 アウトってことですね。 アウトというのは、つまり、 ディテールで表示しているリスト、 これがリンクが途絶えちゃうってことですかね。 リンクが途絶える。 でも、押せてますよね。 押せてる気がするんですが、 えっと、ログ見ときますか。 このログで、えっと、まっすぐにできたのかな。 これで、一回クリック。 もう一回ぐらい押しておきました。 この時に、押せてる風になってないですね。 押せてる風になってないってことは変更が、 反映が全然できてないぞということで、 で、今やった変更は何でしたっけ。 えーと、ランドマップのフィルターの条件を、 フィルターが変わったときにフィルターし直すのではなくて、 えーと、キャッシュしておくでしたね。 なので、キャッシュしておいたとして、 フィルターをいじったときかな。 フィルターをいじって、用語が変わったとき。 で、バインドがもうなくなっちゃうんですかね。 えーと、フィルターでしょ、セレクティック。 どこをいじったかというとこのまずメソッドで、 このバインディングの返し方は普通に、 エンバイルメントからモデルデータを拝借して、 フィルタリングをやっているという状況と、 あとは、いつセレクティックをキープしてましたね。 最初はね、それをキープしなくなったというところが、 変化のあるところではあると。 これを復活させるとどうなるんだろう。 えーと、復活させるにはどこまでいけばいいんだ。 復活はいいか。 で、セレクティックで、メイクランドマークリスト。 メイクランドマークリストで、 えーと、そうね。 フィルター、あ、でも残ってるんですよね。フィルター自体はね。 そうすると、モデルデータが、リンクが 消えているということになるんですかね。 これ、やばいですね。 まだ自分が理解しきれてないということですよね。 このバインディング周りの仕様がね。 こういう問題にしちゃっちゅう打ち当たるような、 こんな気がするんですけど。 えーと、まずはどうしようかな。 フィルタリングで、あとはなんだろうね。 なんだろう、難しいな。 フィルタードランドマークス、 これがスペートになってますよね。 だからこれが変化すると、バインディングが崩れるのか。 あー、バインディングが崩れる可能性ありますね。 そうすると、このフィルタードランドマークス、 これが書き込み可能でなければならない、 ということなんですかね。 書き込み可能とするには、一つの方法としては、 えーと、クラスで包んでポイントにする というのがいっぱいあるんですけど、 それ、なんか下手ですね。なんとなく。 そうすると、あとは計算型プロパティにする。 計算型プロパティにするにしても、 えーと、ダメですね。それだとね。 多分これが、フィルタードランドマークスが スペートだからまずいという発想で、 多分いいんだと思うんですけど、 だとすると、例えば、やれることとしては、 例えば、クラス、エータソースみたいなものを作って、 これが内部で、バーとして、フィルタードランドマークス、 そしてバインディング、ランドマークス、 こういう風に持ってあげて、 それで初期値がこれでしょ、という風に やっていくんですかね。 バインディングが、バインディングに対して、 ラップドバリューに大事できるのかな。 もしかして、バインディング、ラップドバリューだけ やってみますか。 そうすると、アッドスペートじゃなくて、 フィルタードランドマークスをプライベートバーにしたときに、 この中で、ここ初期化しておきますけど、 バインディングのパラダイスですね。 これのフィルタードランドマークスのラップドバリュー、 これに代入はできないか。 これが大事なものね、バインディング。 これで、メイクランドマークリストで、 バインディングを作らなかったとして、 ランドマークをバインディングを作らずに返すとして、 これはダメですね。バインディングを作らないと、 リンクがちゃんとできなくなっちゃうんで、 これはダメですね。 これで、ランドマークのバインディングを 差し替えないといけないから、 これだとダメで、ここアンダースコアは? これもダメですか? そうですよね。やっぱりデータソースとして持たせて、 初期値がこうあって、それでデータソースとして、 これがイコールデータソースですよね。 データソースとしてあげて、データソース。 これのランドマークを代入することができますよね。 これでデータソースがこの辺ね。 これと、あ、ここは違いますね。 データソース。 そして、あのエラーはなんだ? ドローイングプロファイルのイニシャライザー。 ここのイニシャライザーが、モデルデータを消えて、ここもOKで、 フィルターもOKで、ドローイングメニューもOKで、 ドローイングプロファイルがバインドで、 やっぱデータソースがOKで、 イニシャライザーがないってどういうことだ? プライベートプロテクションレベルか、 ランドマークイニシャライザー、どういうことか。 というのは、ここだ、プライベートでフォークしちゃった。 これのことか、データソースか。 データソースをプライベートでフォークしたことに、 これでなっちゃうっての面倒ですね。 まずはちょっとプライベートやめてみますか。 ちょっと待ってね、イニシャライザーを作らなきゃいけないのが面倒なんで、 これで実行をかけてみて、うまくいくかどうか。 あれ、うまくいくかなんですけど、データソースはバインドか。 これでいいんだ。 あ、全然ダメですね。リストが更新されていない。 更新されていないというのは、 フィルター状態が変化して、フィルター状態が変化すると再評価が走って、 適切なランドマークリストが再度作られたって感じだ。 やっぱりキャッシュが問題ですね。 だから、バインディングを生かすためには、 フィルターが変わったらそれを検出して、 それで検出した後に再評価でいいのかな。 バインドはそのままで再評価か。 バインドはそのままで、難しいね。 フィルターアップデートができたということでいいとして、 あとは、それが変化を検出しないといけないですよね。 検出もそうですね。検出しないといけない。 ただし検出するとバインディングが終わってしまう。 ということは、リストが一緒だったら更新しない。 ということでもあるのかな。 再評価。あとバインディングを更新するというのが 一つ手としてありそうですけど、 バインドを更新か。アップデートしたときにバインドを更新する。 例えば、アップデートしたときに何かをする予定なのであれば、 データソースがランドマークリストを持っていて、 フィルターかバインドはバインドを差し替えるには、 変更が整ったときにはモデルデータ。 モデルデータからフィルターをしてしないといけないけど、 それはやってますね。 フィルターはやっていて、モデルデータからはやっている。 やってますね。 では、何だろう。要はフィルターとランドマークス。 バインディングのランドマークス。 ランドマークスのバインディングが新しいものから作られて、 そのバインドが画面と手になってないのか。 画面がこっちかな。バインディング。 バインディングしたものと画面側。 画面側が古いバインディング。 大変難しかったですね、スノープショット。 別のスノープショットの取り方としては、 IDをリストで保存しておいて、 それでジュージュっと書けていくみたいな。 そういった形でもいいかなとは思うんですけど。 でも、なんかもうちょっと普通にというか、 エンバイルメントのランドマークから普通に行いたい気がするんですよね。 なので、それをちょっと模索したいんですけど。 そうしたときに、今までの計算型プロパティだった場合には、 この通りのものができて、そうじゃないとすると。 その後にフィルタードランドマークに 代入したときに、まず情報が古くなってしまう。 古くなるとね。 データでやってないから、 更新されたというのが起こらない。 これと一緒ですね。 リストUIで更新をあえて書ける方法としては、 これはやりたくないですけど。 やりたくないので書き忘れる気がするんですけど。 例えば、トリガーをプールで用意しておいて、 このトリガーを動かしてしまえば。 アップデートのランドマークリストで、 これでトリガーを動かしてしまえば。 トリガーとかなかったっけ。 間違えてる。トリガーね。 してあげれば、データが変わるので、 代表化されると踏んで良いのかな。 雑な考え方なんですけど。 Uで使ってないからどうかな。 こうしたときはね、出てくると思うんですけど。 クリックしないと更新されなくなる。 これもダメか。だから根本的に間違ってるんだ。 ダメですね。このやり方ダメか。 計算型とフォトン型。 フォトン型で演習して代入して、 バインドだからいけないってことだと思うんですよね。 そうすると、どうしようかな。 そうすると、ランドマークリストでバインディング。 バインディングを使ってるから問題だと。 そういうことにして。 そうすると、ランドマークのリストを作るときに。 どうすると、データソースをやめて。 微妙ですけど、まずは動くものを作ってみましょうか。 データソースをやめて、データソースをやめる代わりに計算型プロパティをまず 復活させるということをやって。 あともう一個重要なところとしては、 フィルターのIDですね。なので、アクティブかな。 セレクティブランドマークIDと同じように。 ステートで良いのかな。 良い気がする。 ステートでプライベートバーで、アクティブ、アクティブじゃないか。 リストに表示されているって何て言うんだろう。ディスプレイングかな。 アクティブでも良い気がするけど、アクティブ。 アクティブランドマークIDみたいなのを用意しようかなと思ってるんですけど、ディスプレイングにしようか。 ディスプレイング、ランドマークID。 そしてこれがヒントの配列で、とりあえず何も表示していない予定状況を作ったフィルターがありますよね。 こうしたときに、このランドマークIDでフィルターをオールバック。 良いでしょうね。これでやることとしては、フィルターとランドマークはIDが含まれているものを出す。 フィルターとランドマークとしては、ランドマークを出속して、 まずモデルデータからABPが出てきて、モデルデータのランドマーク。 これがMakeランドマークリストから取られたけど、この中でターゲットは、Filter conditions append, あとはモデルデータのBindingランドマークからフィルターするか。 そういうことをするんじゃなくて、モデルデータの中からBindingランドマークですね。 それで、これに対してフィルターをかけていって、フィルターの中のランドマークをインにして、 ランドマークの要件は、DisplayingランドマークContains この中にBindingランドマークのIDがあるとかですね。 こうしてあげてフィルターができて、Bindingしたランドマークのリストがこれで取れるので、 Getランドマークイコールですね。 そして取れたら、これをReturnでBindingに対してランドマーク数ってやってあげると、自分で確定したプログラムを使ってBindingランドマーク数に変換してくれて返せる。 これでフィルターのランドマークが取れたと。それで、Updateランドマークリストじゃなくて、これはランドマークIDsになりますかね。 UpdateDisplayingランドマークIDs。これを更新するときに、これはもう中身持ってきちゃいますかね。 別々に分けるとか、そういったことしなくてよさそうな気がするんで、プライベートファクション定義したのは、 Makeランドマークリストによっていろいろやっていたのを、この関数の名前を変えるって言うのもありますけどね。 ランドマーク、DisplayingランドマークIDsってやるって言うのもあるのか。 Displaying、Make、Makeって言うのが変なんですね。 Getもあんまりすごい新しくないなと思うので、持っていこうかな、中身を。 あんまりこの分けた関数をわざわざ削除するほどの価値があるのかなと、今ちょっとまた疑問なんですけど。 とりあえずね、これで、さっきのUpdateランドマークIDs、この中で今のコードをデッキを押してあげて、Returnじゃなくて、ランドマークIDsに対して。 ダイニューしてあげる。 Displayingですね。ランドマークIDsに対して入れてあげるわけですけど、 その前に何かやりたいことがある気がするのが、フィルターでしょ。 フィルターに対して、モデルデータ。モデルデータからBindingランドマークと言ってますけど、 これだけしかないでしたっけ、今。パーでモデルデータのランドマークがありますよね。 だから、モデルデータから、もうBindingとかはどうでもいいですよね。ランドマークでフィルターとして、条件を満たすもの、というふうに取ることができますよね。 フィルターも、ランドマーク、フィルター、というのを引き継いで、直接渡せますね。 これで、フィルターしたやつですよね。これで、もういいじゃないって感じですね。 これをダイニューで入れてあげれば、これで完成ですか。そうすると、条件を満たした。 これだけだとダメなので、.mapでIDかな。これでいいかな。 フィルターして、今何が変わってるんでしょうかね。ランドマーク数とまずランドマークのIDですよね。 それでフィルターして、これのせいですね。 ここでID。これを取ってあげると、もうIDのリストが取れるね。これで良さそうですよね。 IDが変更して、IDの変更によってトリガーになって、モデルデータからBindingを適切に取得して利用がする。良さそうな気がする。 データソースが無くなったのと、データソースが無くなっただけだ。 だから、フィルターとランドマークを取れば良くて、あとはここだ。アップデートランドマークリストじゃなくて何でしたっけ。 アップデートディスプレイングランドマークIDですね。 読んであげる。 アップデートディスプレイングランドマークID。 UIのこのオンアピアから見た時には何か違和感を覚える名前ですね。 アップデートランドマークリストのほうが何か分かりますね。 こっちはこんな名前。アップデートランドマークリスト。 そうするとアップデートランドマークリストという関数の中でやることとしては、フィルターに満たすものでランドマークIDを更新する。 そうするとアップデートランドマークリストが変わってくれるので、関数としては名前通りですよね。 これで実行できたのかな。 これで押してみる。大丈夫ですね。次にフィルターを変えた時にどうなるかですね。 フィルターを変えて、例えば、まずはMountainsみたいな風にして、これ大丈夫ですね。 アイスペインというところもフリップでいけてますね。 そしたらいよいよお気に入りオンリー。そうすると2個ですよね。それで今はこの星を外すと、星が外れた状態でお気に入りではないんだけど、リストには残るという事を変えたので、こう残ってますね。 今回始めた最初と違うところは、別のリストを選択しても、ディスプレイングIDでキャッシュしているおかげで残ったままはいいですね。 こっちもお気に入りとか外せますよね。残ったものだから選択できますよね。ONにする。できましたね。 この上でリストを例えば、Rakesにすれば、この時にリストがちゃんと変わりますね。お気に入りのみのRakes。 これでOFFにするとかもちゃんと聞いてたから、今なんか1回ミスしたのかな。 あとはもう1回Mountains行って、アイスペインを選んでOFF。大丈夫ですね。 これでFavorite Onlyを外せば、当たり前にFavoriteじゃないのが出てきて、失敗した?なんか1個出てなかったですよね。最初ね。 これでON、OFFはいいんですけど、もう1回再現するには、これでFavorite Onlyにして、Favorite Onlyでなくせばいいんですかね。 出てきますよね。これはなんか、遅延のことがあるから、遅延なのかな。なんか嫌ですね。こういった謎強度はね。 他にもう1個、もうちょっといろいろいじってみますか。ALLにして、選んだ時に別にリストがおかしくならないですよね。 これで、この先止まりRakesをお気に入りにしておいて、他のお気に入りにしようかな。Hidden Rakes。 などなど入れて、これでお気に入りのみに変えて、お気に入りのみですね。これで先止まりRakesをOFFにしたり、アイスベイをOFFにしたり、やって、それでFavorite Onlyを外すでいいのかな。 外すと、こんな感じになって、この時にクリックした時に、大丈夫そうですかね。もう1回リバーズにして、リバーズでFavorite Onlyを入れて、これお気に入りを外して、Favorite Onlyからオープンに直すと3つ。 なんとこうやるとですね、オープン大丈夫なんじゃないかな。ということで、OKということに、回しておきますかねって感じですか。 こんな感じで、ヤッシュが、なんかちょっと理想と外れちゃったんですけど、バインディングがちょっと使いにくい。難しいですね。 ビューの再ビュー化が発生してしまうと、古いバインディングが効かなくなっちゃうんで、これも考慮して、新しいビュー化になった時に改めてバインディングを取らないとダメということは、バインディング以外でなんとか状況を把握して、その状況を使って、バインディングをね、計算型ブロックバティーで取っていくっていうのが、まあ大げさに言うとセオリーになってきそうな、そんな感じが印象としてしまいましたね。 なので、これで良いでしょう、きっと。で、あとはセレクティブランドマークID。これは使ってないけど、残しておくはやっぱり残しておいていいですかね。 今後もし選択して、あるランドマークに対して何かをするみたいなね、そういったことをしようと思った時には、セレクティブランドマークIDが取れることって重要だと思うんで、これは用心にしましょう。 これでフィルターがこうやって作られた、あとショーイングメニュー、これはいいですね。ショーイングメニューとこの辺ステップをまとめたい気もしないでもないけど、まあいっか。 あとステップ、あ、トリガーがもういらないですね、実際ね。こんな余計なものはいらないでビルドちゃんとできますよね。できるね。 はい、で、それで、これまとめたっていうのかな、こんな感じで。で、OKで、ここ気持ち悪いんですよね、タイトルストーリング、ここで何かごてごてやってんのとタイトルっていう名前そのものがね、なんか気になるんでこれもいじりたいなと思うところですが、これはまた次回にしましょう。 フィルターとランドマークがこうやっていい感じにかけてるから、OKですね、スマートにかけてる感じしますね。 コンテインズ、まあコンテインズも大丈夫かな。で、あとアップデートランドマークリストもいい感じに落ち着いた気がするけど、このネットとかプールとかを使ってる、このコンディションを作ってるところ、この辺をなんかもうちょっと接続、フィルター型を作ったから、そこに何かするか、またはフィルターコンディションという型を作って、なんか任せるとかしたい気がしますね。 この辺をもうちょっとこれも次回やりますか。この中でね、内部にビジェクトの関数とかコンディションにアペンドとか、これ理解するの大変ですよね、自分が作ったコードの間合いですけど、人のコードがいきなりこんなの来たら何だこれはみたいな難しいところになるんで、ちょっと約面を凝縮した、ちゃんとした型を作ってあげて、これを綺麗にする。 で、あとここも次回ですけど、フィルターのローバリューとランドマークのカテゴリーのローバリュー、これで比較してますけど、カテゴリーという観点でうまく組み合わせていけば、ランドマークのカテゴリーとフィルターに設定されているカテゴリー、この2つは同じものとして判断できる。今はそれができなくて、なぜできないかというとそれはシンプルで、フィルターのカテゴリーですね、ここカテゴリー、ここ名前はあれですね、カテゴリー、カテゴリー、カテゴリーズ、カテゴリー、あれ1個だけ取れてるスイッチで、カテゴリーズですね、そうそうここが違和感ありありじゃないですか、名前 が混ざってるからっていうね、こういった理由、しかも今回の場合、オールが混ざっているという理由だけでできないというね、そういったところがあるんで、ここちゃんとライトウォンのカテゴリーで比較したいなという、そういったのがあるんで、これも今後、リファプターで直していくというのをやりましょう。で、あとは、この辺はだから封殺だよーというのかで、どこかで溶かしてしまえばね、あとはもう、モデルデータからランドマークスの条件によったフィルターをIDでね、取得する。 ランドマークスをフィルターして、これぐらいだったら、状況によってはね、これをドップレイジーとしてね、1個1個やっていく、あ、でもランドマークレイジーがないって言ってますね、何だっけ、モデルデータ、あ、モデルデータにはないですね、それはね、ここですね、ここでレイジーって言ってあげると、フィルターとマップ操作をね、後回しで、1個1個に対して1回ずつできて、で、そのうちにフィルターでかかったものをマップをしないということができるけど、これは何かしら効果ないかな、例えばね、この後にファーストみたいなのを書くような場面では、フィルター1回かかったもの、フィルタリングさ を書いたほうがパフォーマンスが良くなるっていうね、見たことがよくあるんですけど、今回はそんな変わんないですね、なのでこれでいいや、で、こうしてあって、ボディの方は特に問題ないですからね、ランドマークIDの検出と、ランドマークリストと出ていくロードのね、表示された段階で、1回ランドマークリストのね、IDのリストを更新することによって、適切なリストを出せるようにする、表示前に表示するから大丈夫ですよね、で、それで、あとはフィルターが変更するたびにそのIDのね、リストを、あの、内容を計算し直す、で、計算し直すことによって、代表が動かすのが、フィルターを変えたときには、 入ってるディスプレイング、ランドマークIDと一致してなかったときだけ入れるっていうね、そういったパフォーマンス向上も多分あり得そうですよね、フィルター変えたら再利用がでいいでしょうっていうような感じがするんで、これでいい気がする、今回は、で、あと気にするところはそんなものですがね、利用範囲を綺麗に整えたはずなんで、代表ですね、じゃあ次回はこの辺のね、カテゴリーを、オールをちゃんと特化して、カテゴリーでフィルターができるようにするのと、フィルターが、カテゴリー、フィルターがというか、フィルターの調整用の機能をね、どこかに置いて、より綺麗な感じのコードに

Transcription & Summarize : とりあえず読書会 SwiftUI Tutorials #29

はい、ではとりあえず紹介を始めていきましょう。 今日は引き続きリカタリングですね。 Apple Watch用のタブレットが完成しようとしたんですけれども、 個人的にびっくりするような行動を見かけたのと、 それでいいのかどうかは理事大だと思うんですけどね。 その辺りがちょっと気になるので、まずはそれを考えていって、 どうやっていくのがいいのだろうというのが、 まだちょっとSwift UIの常識ではどうやるのかというのが見えてないので、 その辺りを模索しながらやっていきたいなと思います。 で、どんなところかというと、 ModOS用にアプリを作っていくという流れの中で、ここですね。 モデルデータをNotificationController、要はユーザーノイフィケーションですよね。 これで表示されてきたものを表示するViewの中で、 Viewをコントロールするコントローラーの中で、 デフォルトイニシャライザーを使ってモデルデータを生成して、 それでモデルデータの中のランドマークと合わせていくみたいな、 そういったふうなコードになっているんですけど、 このモデルデータというものが元々どこにあるかというと、 アプリの中ではですけど、 なんだっけな、ランドマークアップという人かな? この中ですよね、この中に、 あ、こっちですね。 この中に、 こういった状況になっている。 この中で、モデルデータをデフォルトイニシャライザーで作った時に、 このモデルデータの場所というものが全然関係ないというか、 出生は関係ないですよね。 内部のコード名は普通に、 JSONから取ってきたデータでランドマークを作っているんで、 そんなに最終的には一致しているんですけど、 いきなりこんなところでデフォルトイニシャライザーで生成するなんてやってしまうと、 これはちょっとね、なんかもし今後、 バインドなんかする必要が出てきたりなったり、 そんなような時に、 このモデルデータの方、どっちの方を書き換えるかという問題が出てきちゃうんで、 このあたりはね、一箇所に統一した方がいいんじゃないかなという、 そういったところがあるんですけど、 これをどうやるんでしょうね。 例えば今回のランドマークスアップの場合は、 モティフィケーションシーンというものを、 このアプリケーションの中で作ってますよね。 それで、モティフィケーションコントローラーとカテゴリーを渡しているという、 それだけの状況なので、 ここにコンテキストを渡すというわけには、 そういった可能性はあるんですよね。 コンテストアプリカー普通に、 コンプレットコンプローラーですよね。 なので、そうですよね。 だから簡単に、 何か表示をする仕組みというのが、 あるわけでもないのと、 あとは、 モティフィケーションコントローラーは、 このモティフィケーションシーンによって作られるんだと思うんですけど、 この時に何の情報も渡ってこないという、 そういった状況になっちゃってるのかなというのが気になっている。 だからそうした上で、 まずはそうですね。 通知が来た時のまずボディが動いてるのかなというのが、 ちょっと気になるんで、 これはどうしようかな、 ここでどうやるといいんだろう。 んーと、 そうね、ここでどうやりますかね。 例えば、 プリントしちゃえば済むんですが、 AppDelegateでも用意してみますか。 AppDelegateは、 えーと、 ファイナルクラス。 で、 AppDelegate、 そして、 これNSオブジェクトから検証をさせますよね。 それで、 えーと、 これで、 アテアとデリゲートか、 NSのUIアプリケーション、 ん? UIアプリケーションか、 そっか、 UIキットじゃないか。 だから、 インポート、 UIキットですね。 これで、 UIアプリケーションデリゲート。 これ、 ちょっと待って。 えーと、 アプリケーションデリゲート、 アプリケーション、 あ、 ウォッチキット? あー、 ウォッチキット。 ウォッチオーエスオブ用のデリゲートか。 あ、知らなかったかもしれない。 ウォッチキットのデリゲートか。 なるほど。 まあ、 一回やってみますか。 その時の、 で、 フィニッシュ、 ランチング。 で、 これでプリントをね、 対応。 で、 ロンティス、 なんか全格になっちゃったけどもいいか。 で、これで、 えーと、 デリゲートですよね。 あと、 えーと、 まだ、 えーと、 デリゲートのアダプターはどう使うんでしたっけね。 ちょっと調べてみますか。 えーと、 UI、 SwiftUIで、 アップデリゲート。 これ調べれば、 まあ、 なんとか、 わかるでしょう。 うんと、 やり方としてはね、 UIアプリケーションデリゲートアダプターか。 だから、 このアダプターがウォッチキットにもあれば、 これをね、 使っていきますが、 アプリウォッチキット、 アプリケーションデリゲートアダプターありますね。 えーと、 さっきの見忘れた。 アダプターの後にアダプターの型を書くのか。 なるほど。 アップデリゲートセルフで、 あー、 デリゲートかな。 デリゲート。 まあ、 こんな感じで良さそうね。 これで、 まず実行してみますか。 そうすると、 起動したかどうか。 これアプリを止めればいいんだと思うんですが、 まあまあ、 まずはやってみましょう。 えーと、 これで、 今さっき一瞬、 エラーがあったような気がするんですけど、 それはどうなったんですかね。 もう一回実行してみますか。 ビルドフェイルですね。 ビルドフェイルなのにログが出ていないという、 そういう状況になっているけれど、 まあでも、 ビルドの失敗で出てますね。 アプリケーションデリゲートアダプターで、 アップデリゲートが、 アップデリゲートアプリケーションデリゲートアダプターですよね。 だからまあ、 これで調べてみればいいか。 iOS用の調べるのではなく、 ウォッチOS用にしっかりと調べていけば、 何かが出てくるのでしょう。 ウォッチOSでWXエクステンションデリゲートは使えない。 ここにかな。 デリゲートをやると、メッセージが出る。 エクステンションベースドプロセス。 リモート通知とか、 うーんと、 これだったか。 こっちだいかな。 プロパティアッパーで、 デリゲートをラッキッドで使うやつで、 これでデリゲートのタイプで使い方としては、 他にも書いてないか。 アイグレッティングトゥスウィスト ユーアイライフサイクル。 この中で何か書いてあるのかな。 デリゲート。 オーディアプリケーションの中で。 ユーアイアプリケーションデリゲートアダプターですね。 これはね。 ウォッチOSのデリゲートアダプターはどこだろう。 まずは、ちょっとわからないけど、 デリゲートをちょっとやめてみますかね。 もうちょっと簡単に書いてみますか。 ターノアドリビュート、WK、ウォッチキット。 ウォッチキット、UIキットじゃないのかもしかして。 ウォッチキットか。 で、ビルドかけて。 これもダメか。 モジュールのディペンデンシー、ランドマーク数4iOS。 あとが、ウォッチOSとAppOSで、 両方ビルドすることになるからこれじゃダメなんだ。 ウォッチOS限定の機能という形で、 実装してあげないといけなくなっているってのを忘れてましたね。 エンドイフ。だから、エラーが出たのは純粋に、 アップルウォッチ用のビルドじゃないところで、 エラーになっていったという感じですかね。 これで、これならビルド通るでしょ。 まだダメか。 ビルドフェイルで、ウォッチキット、モジュールディペンデンシー。 ここもですね、ウォッチキットね。 これも条件に入れないといけない。 こんな感じですかね。 これで、ビルドをかけて。 ビルドが通りますよね。さすがにね。 これで、よしと。 そしたら、やることとしては、実行か。 実行してみて、まず、文字の7、起動がね。 あと、デイゲートで認識されてプリントされるかどうか。 まずはされると思うんですけどね。 これで起動した。 次に、起動しましたね。 これ1回ログを消して、それでフォーム。 これを落として。 これで投げ込んでも別になんともならない気がするんですが、 一応やっておきますかね。 これを、ノーティフィケーションのテストのやつね。 これを投げてあげて。 これで通知が。 あれ、投げの間違えた。 こっちですね。これを投げてあげて。 通知が出て、ビルドが表示されたようという、 そういった段階になった時に、 いろいろログが出てますが、 レシーブしただけですよね。 レシーブしただけっていうことは、この時には、 ランドマークアップはすでに動いていると捉えていいんですかね。 アプリが動いているだけと。 アプリが動いているイコールランドマークアップが動いているといいんですかね。 まあまあ、それで仮に用意として、 エリケートが動いて、 あと、これをアプリを一回止めてですね。 これでバシッとしっかり止めて、 この上でチェック。 これを投げてみる。 そうすると通知が出て、 アプリは起動したことになるんですかね、 というそういった感じね。 この時には、レシーブの後。 レシーブだけか。 あ、そうか。 レシーブだけか。 これが動いていない状況。 動いていないというか、 目が呼ばれていない状況か。 なるほど。 悩ましいですね。 これもう一回動かすと、 普通に移動したところからになると思うんですよね。 まずね。 あ、違う。 ログが見れなかっただけだ、今の。 あ、そうですね。 ログが見れなかっただけか。 あ、なるほどね。 ログが見えないとなると、 Apple Watchのログっていうのを シミュレーターから見れるんでした。 デバッグの中に コンソールみたいなのがあるのかな。 システムログか。 えーと、システムログで見れるのかな。 まあまあ、どこかで開いているのかな。 うん。 なるほど。 まあアプリがね、 あとは、Xコードの中の、 ウィンドウの、 ウィンドウじゃないか。 えーと、デバッグじゃないか。 ウィンドウ、ウィンドウディングのビューデバッグ。 これは何だろう。 これエラーキーとレンダリングパッケージなんですか。 ウィンドウですかね。 ウィンドウの中のデバイス&シミュレーター。 この中のシミュレーターで今動いているのが、 えーと、 OSのシミュレーター。 Apple Watchの11ですよね。 これの、 リリースどっちか。 42、46、46かな。 あ、でもこれもログが見れないのか。 別に。 まあ、えーと、 システムログ。 ターミナルのシステムログを見よう。 と、一応書いてある。 iOSシミュレーター。 えーと、他。 iOSシミュレーターのログを見ると、 あとは、iOSシミュレーターバージョンシステムログ。 えーと、マーペリックス。 うん。 バーログシステムログでいいんですかね。 ちょっと見てみますか。 えーと、バーログシステムログ。 これの下の方ですかね。 この下の方で、 えーと、20、19分とか20、15、13、21。 うん。 入ってなさそうですね。 ここじゃない気がする。 そうすると、あとあり得るところは、 ライブラリーのログの中に、 iOSシミュレーターというのがあるらしいので、 じゃあそれをちょっと見てみますか。 えーと、ライブラリーのログ。 あー、ログ、見ますね。 一応ね。 えーと、この中にシミュレーター。 えーと、どれだ。 ログの中にCoreシミュレーターかな。 この中にIDがシミュレーターログだと見てみますか。 これ自体は特に何もないと。 そうすると、シミュレーターのID。 例えば、ProWatchのだとEDDのC13。 えーと、EDDのC13。 これですね。 この中にログがあるんですかね。 これを開いて、その中にシステムログ、GZで保存されている。 GZは10月9日、10時、0時、0時5分、プラス9時間というところかな。 これの可能性もありますけど、GZIP、ZIP圧縮。 まあいいか。なんか一時に圧縮するんですかね。 GZIP、GZIP、まあいきなり開いても絶対出ないですよね。 これね、0、0、0ですね。 これバイナリファイルですよね。 だからこれを、UNZIPのパッドかな、コマンド。 システムのログの0。 これを展開してあげようと思ったけど、 えーと、Signatureのパッド。 CPでシステムログの0のGZを、とりあえず添付にコピーしてみますか。 で、添付のフォルダーの中にコピーしたやつ。 これをダブルクリックで開くと展開されて、 で、それが中身がどうなっているのかを見るドローカウントかな。 あったけど、システムログTがリスタートしたと予想ならばですね、 どこか開発の過程がわからないですね。 iOSかWatchOSのログが見れた。 まあそうすると、その辺は調べてみてもいいのかもしれないけれど、 ちょっと別の手段で見てみますかね。 ログ見れた方が楽だと思うんですけど、とりあえずそればっかり調べててもなんとなく、 面白くないテレビ用のもんでもない気がするんですけどね。 出てこないので、出てこないきっと中のが見つかんないかなと思って、 もうね、もう一個だけちょっとやっておきますか。 えーと、ログ。 ログというか、デバイスとシミュレーターのiPhoneの方。 これとエアーを組まれているiPhoneだから、いくつになるだ。 えーと、起動しているエミュレーターを見ればいいんですかね。 この中で覚えているのが16EのiOS26。 16Eですね。だから16EのiOS26、ここですね。 どこにも何もアーミナルとか、コンソールとか出てこないのね。 今のときのね、昔出てたような気がするんだけど、出てないのか。 じゃあしょうがないな。 コンソール。コンソール。エミュレーターアイテム。 えーと、コピーロー。これはコピーないか。クリアコンソール。 バックフワークフロー。なんかいろいろとありそうな雰囲気も感じるけど、 今のときは読めないですからね。 じゃあこれでデリゲートできたけど、あとは大事なところとして、 あーそっかそっか。コメントかコメントじゃないや。 イニシャライザー。モデルデータ。 モデルデータがインスタンス化するタイミングがいつなのかなというのが、今のときになったので、 これも印刷プリント。これもクモマークでいいですかね。 モデルイニシャライズ。こんな感じでね。 これで1回イメージこうすると、普通はすぐできるでしょう。 実行。デリゲートよりはどこかな。あ、さっきかな。という感じで動くと思うんですけど、 これでモデルデータが作られて、起動しましたよね。 それで、いっぱいアプリを登録でなくなっちゃうから、 普通のコンソール出しておきますか。アーミナル、こちらコンソール。 普通のコンソールで、これで86とApple Watch出てきた。 これでいいんじゃない。これで開始ってやると、Apple Watchのログが取れないんじゃないかな。 ちゃんと。これでもう1回起動してみますか。 だからこれで、エクスコードでもう1回登録していこう。 こうすると、アーミナルのほう、こっちが僕出てくんちゃうなって思ったけど出ないか。 iPhoneはiPhoneのほうと、こっちのほうとPCのほう全部登録取っておきますか。 この上で、こっちはいっぱいログ流れていくと思うんですけど、 この中で、エンスタブとして、なんだろう。 Apple Watchとかやると、両方がエボられてくるのかな。 で、まあ、エボられるのはいいとして、この2つのデバイスがあって、 iPhone16のログがいろいろ出てますね。 出てるけど、特に大きな問題はないか。 これでじゃあ、投げ込めばどっちが出てくるかもしれないですね。 一旦、フォームに戻して、さっきのノーティフィケーションの投げ込みを行ってみましょう。 こんな感じで、そうしたときにログとしては、iPhone16Eのログは、 なんのほうだったかな。 えーと、どうもなってないかなって感じがなんとなくしますね。 で、あとは、こっちのPC、MacBookのほうはというと、これも特にはなってないですかね。 で、Apple Watch、こっちも別に出てないですね。 どうか、分かんないね。これで出てくれるつもりままだったんですけど、出ないか。 立ち当たり次第、やるしかないか。 まあ、これ渡しとこ。 とりあえず、この通知が来たときにですよ。 このときにメッセージを、通知が来たときにモデルデータを再度訂正している。 これを何とか渡したいんですけどね。 渡す手段が、もしかしてないのかな。 そうすると、ちょっとヤバいですね。 どうするんだろう、これ。 ノーティフィケーションコントローラーに対して、この中でモデルデータを作る。 まあね、それで良いとすれば良いんですけど、 まあ、良いのかな。 ノーティフィケーションコントローラーのデータをどう渡すんでしょうね。 要は、WKユーザーノーティフィケーションホスティングコントローラー。 これですね。 これに対して情報を渡したい、といったお話なんですが、 まずちょっとこのWKノーティフィケーションホスティングコントローラー。 これについてちょっと見てみますかね。 A3とUIの機能追加まとめ。 エインとして色々できたのと、 ドキュメントグループセッティングス、WKノーティフィケーションシーン。 定義されたカテゴリのリモートスマークから、通知が受信した際に表示されるシーン。 表示されるシーンか。 ああ、なるほど。 表示される。 ここに落とせばいいんじゃない?っていうのをちょっと思った。 これ例えば、できるのかな? でも、クラスなのがちょっと気になるんですが。 例えば。 ここで、コントローラーがクラスですね。 だからシーンは別にアプリの場所でこれですが、 このシーンは自動的に足渡ししてくれるだけだから、 ここに渡せないのかな?渡せるのかな?渡せなそうだなっていうね。 そんな感じで見ますが、とにかくシーンがありますね。 WKノーティフィケーションシーン。 ここに情報を渡していきたいが、というところで、ごまかして渡すならできると思うんですけど、 WKノーティフィケーションシーン。 これで、あとはシーンのイニシャライザーがあるぐらいで、普通のシーンは。 シーンとして、こうやって普通のシーンですよね。 で、その後シーンの中でシーンを継承してますね。 シーンを継承しているか、マイシーンとしてシーンフェーズ。 シーンってなんだ?これはどれか。 自分で定義して作ってあげて使う感じですか。 で、マイシーンはマイルドビューを表示するような、そんな風になっているという状況で、 それと全然別だと思うんですけど、 WKノーティフィケーションシーンはストラクチャーですもんね。 インスタンス化してるから当然そうだと思うんですけど。 そうすると、この定義一応渡ってみますか。 これでシーンがあって、これは普通のシーンを継承している感じか。 普通のシーンを継承していて、シーン自体にはエンバイオメーターとか渡せると思うんですけど、 今回の場合はちょっとそうもいかないですかね。 普通どう渡すんだろうね。 これを要は、モデルデータってこれなわけですよ。 アプリの中の最初のステップとして用意されているモデルデータ。 これと話がくいちがっては困るんで、 普通はこんな変なところにモデルデータがイニシャライズされるという状態で送るっていうのは、 普通はやんないのかなっていうね。 あとはコンテンツですね。一個気になるのはね。 コンテンツは何が渡ってくるかというと、コンテンツとして、ノーティフィケーションコンテンツ。 この方はノーティフィケーションコンテンツでユーザーインフォーを持ってますね。 ユーザーインフォーを持っている。 そのコンテンツは実際にノーティフィケーションコントローラーが呼ばれるまでは分からないということですね。 だからここに意図的に情報を入れていくということは、シーンの中で何か特別なものが用意されていない限りはできない。 こんなことになりますね。 デフォルトストア、アップストレージ、シーンとノーティフィケーションコンテンツを使う。 デフォルトのストレージ。あとは続行のシステムオーバーレイズ。 あとはサフ復元用とかウィンドウマネージャーとかツールバーとかエンバイロメント。 エンバイロメントがちょっとそそられますけどいいのかな。こんなの使っちゃって。 ちょっとやってみようか。 エンバイロメントでモデルデータ渡せればそれだけで終わるんですけど。 どうなんだろう。こんな勝手なことやっていいのかな。これで例えばコントローラーのほうに。 コントローラーのほうにエンバイロメントのほう持たせてね。 こんなことできるのかっていうのが全然わからない。 この中でモデルデータのセルフにしてはモデルデータってやるでしょ。 これで持たせたところでディフレシーブのところでモデルデータというのを表示してあげて。 これでクラッシュするかでまず一つわかりますよね。 やってみますか。クラッシュするかどうかっていうのは実行して。 これでシミュレーターが動いてアプリが動いた状況でこれをフォームに1回持たせてあげて抜け込めば動くわけでしょ。 抜け込めば動くわけでしょ。そうしたときにどうなるか。面白いですね。 面白いけどなぜかこうやってもね。どうなんですけどね。出た土地にも出るのがですね。 えーとどうなのか落ちてる。落ちてますね。ダメですね。 オブジェクトが渡されてこないクライアントエンバイロメントだとダメですね。 そうか。渡してくれればいいのにね。どうじゃないとすると伝達はどうするんだろう。 これはもうなんか土地が出てるけどこれは落ちてますよね。何回も選んでね。 だからこれでオブザブオブジェクトのモデルデータが取らなかったって言ってるんでこれはダメと。 そうすると、ノーティフィケーションコントローラーをセットするときに ノーティフィケーションコントローラーのインスタンスを持たせばよかったけど、ダメですね。メタタイプを渡してるだけですからね。 メタタイプを渡してるだけでは情報が共有できない。インスタンスを共有できないですね。 インスタンスを渡すスタイルだったらね。 ここのノーティフィケーションコントローラー情報としてインスタンス取るんだったらよかったんですけどね。それもダメとなるとエンバイロメントはダメでした。 という所で。 chatgptに聞くしかないのかな。 これがWKノーティフィケーションシーンで、チャットGPTは、 これで良しなのかな。みんな的には当たり前にちゃんとした情報源を統一してやれてるのか、それはどうなのか聞いてみましょう。 とりあえずね。 スイフトで通知を受け取った時に表示されるノーティフィケーションコントローラーだったんですが、 コントローラー、これですね。ノーティフィケーションのコントローラー。 メタタイプやGPTね。 これのインスタンスでいいかな。 インスタンスに任意の情報を渡す方法を教えてください。 こんな感じでやってみますか。 ちょっとダウトな質問になりますけどね。 これで良い質問? これはどうでもいいか。 これは情報任意の渡した方法は、 繰り繰り返してやればできそうなことを言っている。 一つ目は、タブクラスがデータ的に生成されて、 データレシーブが実行されて、 この時にちゃんと一つの方法としては、 表示した情報を全部送ってあげれば一つはOKですよね。 基本的にはサーバー側から。 でも今回はランドマークのイメージはローカルから取りたい都合で、 IDを渡していて、IDから先のモデルデータを探して、 その中で見つかったランドマークの画像データを表示するというね。 そういったことをやろうとしているので、 画像データを別にBase64とかで括ったりとかして、 通知と一緒に送るとかすれば全然問題ないと思うんですけど、 でもそうじゃない方法をやりたい気がして、 ここだとノーティフィケーションコントローラーで モデルを定義していて、 それでボディの中でモデルを使っていて、ディプレシーブでモデルとして、 ノーティフィケーションモデル、フロムノーティフィケーション。 この流れで、システムが自動生成してより多数が認証で、 任意のイニシャライザーは用意がないと。 で、ユーザーディフォルツなどを配置して、 両方共有することになる、UNノーティフィケーション。 これを使うと丸、エイロード、ユーザーインフォー経由では多数という方法が推奨で、 ディプレシーブ内で取り出していると。 で、ユーザーインフォーとして、パスタ向きにいいので、コンテンツのリカーで、 ノーティフィケーションリクエストで、コンテンツのトリガーという形でリクエストを追加していると。 ああ、なるほど。今回は、APNs、そのファイルを投げ込んでやっているので、 そこに埋め込んでおくということなんですかね。 そうなのかな。あとは、OS側と、iOS側、通信側か。 通信側、通信側は、まあいいか。 で、写真側でいろいろやるというのは、これはOKなんですけど、 あと他に、ユーザーディフォルツ、アップグループ。 アップグループね。ああ、なるほど。だから、情報をユーザーディフォルツとかなんかに入れておく。 ファイルじゃなくて。それなら、まあ、いけますね。 確かに。ファイルもファイルでね。それでいいよっていうことにすればいいんですけど。 あとは、ユーザーインフォーと、バインディングみたいなのもできないけど。 あ、まあ、できてる。ステアとマテリア。うん、なるほど。 ユーザーインフォーね。とりあえずね。ユーザーディフォルツね。 あとは、ノーティフィケーションセンターやエンバイロメントオブジェクトが限定的だが、できるのか。 オフエンバイロメントは。えっと、ノーティフィケーションセンター。ノーティフィケーションセンターは。 ああ、そっか。アプリが生きていれば、ノーティフィケーションセンター使うこともできそうな。 なんか、そんな予感がしますね。 あとは、エンバイロメントはどんなときになるかな。 えっと、とりあえず、UIの、SwiftUIのビューを起こすとできる。 で、えっと、通知受信時に新規作成されるコントローラーのため、アプリ実行中のデータ共有には向いていない。 もともと向いていないんですかね。よう言うね。 まあ、見ればなんとなく雰囲気はわかりますが。 とにかくそれで、シェアアドモデルとしてオブジェクトで、これで情報を持っていって、 ノーティフィケーションビューの中でエンバイロメントとしてシェアアドモデルを持っていって、 それで、コントローラーの中でシェアアドモデルをインスタンス化してますね。 ここは、まあ、シンクルフォームを使えばね、そういったことはできると思うんですけど。 で、これでノーティフィケーションビューでエンバイロメントオブジェクトにシェアアドモデルを渡す。 ただ、他の最初の作っちゃってるところが個人的には気になってるところなんで、 これは何とかしたいなという発想ですよね、今のところはね。 だから、エンバイロメントはちょっと違うかな。 それと、ユーザーインフォーカーアップグループかノーティフィケーションセンターということになるのか。 あとは、アプリケーションのインスタンスが取れれば、 また、どっちが出てくるのかなというのがあって、 それを可能にするとしたら、アプリケーションのまずインスタンスを取ってみようですね。 ここで取れるかな。 UIアプリケーション。WKかな?アプリケーションって呼ばれるもんね。 WKアプ、ダメかな。アプリケーションを取るには、レシーブの直下に色々書いてみますか。 アプリケーション系、WKアプリケーション、ありますね。 WKアプリケーションステートってなんだ。 WKアプリケーションの中にエアードがいますね、とりあえずね。 エアードがいるとデリゲートが取れるという、 そういったおいしい情報があるわけなんですけど、 デリゲートに行こうかな、そうしたら。 とりあえず、シェアードでアプリケーションが取れることを、 大丈夫だと思うんですけど、確認してみますか。 まずはね、これでアプリケーションがどんなインスタンスかというのを調べて、 その上で色々やっていく。 ここまで来て、1回アプリを置いて、その後、このAPNsから投げてあげましょうね。 これで投げてあげると通知が出て、色々動いたよという状況の中で、 ロゴを見ると動いたからまずいんですけど、レシーブとしてWKアプリケーション。 とりあえずインスタンスは当たり前ですけどね。 そうしたら、もう一つ考え得る方法としては、デリゲートですね。 これ、WKアプリケーションデリゲート。 これを別のファイルにちゃんと作っておこうかな。 ランドマークアップのところから、ランドマークアップデリゲートにします。 これでウォッチOSだけに入れておくという形を取って、 ここに作っちゃったけど、ここじゃなくて、 ウォッチOS用のアプリケーションのところに持っていって、 それでこのアップデリゲートのところに対して、 アップデリゲート、これを持っていきますが、 ファイナルクラスのランドマークアップデリゲート。 これがNSオブジェクトを結晶しつつ、かつWKアプリケーションデリゲートを結晶する。 結晶するというか順調するですかね。 これがインポート、何だ、WKアプリケーションなのかなとですね。 こうしてあげて、まずここまででいいかとすると、 このデリゲートを要らなくなって、 それでウォッチキットのインポート、 これは必要なのかな。 SwiftUIが入っていれば大丈夫かなとだけしてみました。 これでランドマークアップデリゲートが取れますね。大丈夫ですね。 これでデリゲートが走りますよね。 デリゲートが走ったということで、デリゲートが取れるということになっていて、 この状態でモデルデータがこっちに移っちゃって大丈夫なんですかね。 ライフサイクル的に。 ライフサイクル的に痛い目を見てるんで、 ちょっと心配なんですけど、やってみよう。 SwiftUIか。これで全部いきましたね。 これでモデルデータがステップとしてデリゲートになって、ここがいいのか分からない。 とにかくこれでやってあげると、 このモデルデータというものはデリゲートの中ですよね。 この中にモデルデータがあるわけですが、 これはインアクセスブルプライベート。 プライベートにしちゃってるね、ステップが。 ステップじゃダメですね。 ステップはローカル、プライベートってこのチュートリアルで習ったわけですけど、 ローカルにしたらどうなんだろうね。 ステップをリプレイしちゃっていいのかな。 とにかく通るようになった。 まずはフェイルを動かしてみますかね。 これでちゃんと遊べるかどうか。 これをまずやってみて、 これはスコープにないってエラーが出ましたね。 これはもしかすると、このファイル。 iOSは別にいらないんで、こうですかね。 これでビルドをかけると、ビルドがフェイル? まだダメか。 さっきからエラーがちゃんと出なくなってるんで、 どこにエラーがどんな風に出てるのかっていうのがビルドのロゴになるわけね。 これでデリゲートがスコープ内にないと言っている。 これはウォッチOS用に作っちゃったんでね、これはないですね。 だからこれを。 これをやるとすると、ここでデリゲートの。 なのでこれはランドマークアップデリゲートをホモンに持っていって、 それでランドマークアップデリゲートなんて持ってたのかな。 間違えた。ランドマークアップは全部に入ってますよね。 ランドマークアップ持ってきました。 ホモンの下のほうから持って来ました。 レッドランドマークアップデリゲートを同様にホモンに持ってきて、 Logic OSとIOS両方で使えるようにした上で、 それでステップとしてモデルデータを持たせた上で、 それでこのデリゲートの形状を、まずここでエクステンション。 エクステンションでできるのかな。ランドマークアップデリゲートに対して、 ダブルキーアプリケーションデリゲート。大丈夫そうですからね。 ここまで大丈夫だったら、ラフ・イフ・オーエス・ウォッチ・オーエスとやって、 ラフ・エンド・イフ、こんな風にしてあげると、 これでウォッチ・オーエス用のデリゲートができるでしょう。 それと同じで、こんなに楽しいのかな。 わからないけど、IOSの時には、大丈夫そうかな。 UIアプリケーションデリゲートとしてあげて、 これでランドマークアップデリゲートは共通で使えて、 でもね、そこを共通化したからといって、 ここはわからないとダメですけどね。 WKアプリケーションデリゲートのプロパティラッパー。 プロパティラッパーってそういえば、 カタエリアス使えるんですかね。よくやってみたくなってしまった。 例えば、ここで、TypeAliasApplicationDelegateAdapter イコール、UIアプリケーションデリゲートアダプターという風に作ってあげて、 同様に、そっちのウォッチOSでも、TypeAliasで、 WKアプリケーションデリゲートアダプター。 後ずり違ったらしい。どっちも怪しい。 ターゲットはIOSにしましょうか。 IOS。今はIOS。IOSにして、こっちで、 UIアプリケーションデリゲートアダプター。 アダプターはここにありますね。 こうした時にアダプターはここにありますね。 こうした時にアダプターはここにありますね。 こうした時にアダプターはここにありますね。 これで、TypeAliasを、これをプロパティラッパーに使えれば、 このディフィブもいらなくなるためですか。 これ、いけますね。ビルドが出てきましたね。 今、IOSのターゲットね。 これでビルドが出てきて、ビルドが取ってくれれば、 うまくいったでしょ。 さらにこれがうまくいった後に、 お気に入りをフォーカスできれば、デリゲートの中に、 ステップを置いとくということが許されていることが、 大予想間違いないという、公式の情報じゃないんで、 本当か分からないですけど、そんなのが、分かるじゃないですか。 テキストだったというのが、大予想通りで、 行くじゃないですか。 なので、これで今度、実行してみますけど、 実行できたのか。 これですかな、ところの画面は。 画面を描くデバイスのサイズはどこでしたっけね。 サイズ、サイズ、いろいろな、 コマンドいくつか出てくると思うんですけど、 コマンド、1、2、3、4、これでいいや。 面白いな、シミュレーションでこんなのが出てくるんだ。 今はしなくていいです。 という感じで、実は動かしたからか。 動かした記憶はないけど、まあこれで。 あ、実はクリックしたのか。 でも意外と多いな。 マップに毎日情報ぐらい使わせますか。 それでもう一回、こっちを動かしてみて、リプレイしていいかな。 これで、iOS用のアプリが、こっちか、こっちかもしれないですね。 で、これを、画面的にはこれくらいのサイズでいいですかね。 で、今ちょっと起動待ちですが、これ移動してくれて、 ネットワークをいじれたら、これで情報共有はバッチリいけそうだな。 情報一元化ね、バッチリいけそうだなという予感がするんで、 うまくいくといいですけどね。 でもまあ、エプリアルでね、スペースはプライベートで、 スペースと言われてるのがちょっとあって、それは引っかかってるんですけど、 とりあえず、ここまでは動いてますね。 で、これで、例えばこの辺をタップすると動きますよね。 で、お気に入り入りますね。 レイク・マクドナルド、これをお気に入りのリストにすると、 レイク・マクドナルド、動いてくれてますね。いいですね。 そうすると、ここまでできたら話は結構簡単で、 そうですね、AppDelegateとApplication、 だから、AppDelegateというか、Applicationですね。 だから、いわゆる言葉だとね、ダイレクトで取れると思うんですけど、 それなりが、だから、どっちOS用のもので、 特別に用意しなかったら、今回ね、DelegateとApplication。 この2つですね、Applicationのところが、 だから、Delegateがいいですね。 このDelegateの中で、例えば、WatchOS。 このWatchOSだと思ったけど、Appleですって言いましたね。 じゃあ、ちょっと、すごいと思ったんですけど、 Applicationのパターンもちょっと違いますね。 じゃあ、WatchOSだけにとりあえずしておきますか。 この辺でWatchOS用のコードを書く中で、 エクステンションで、エクステンションで、 あとWatchOSにしておきますかね。 WatchOS、エクステンションで、WKアプリケーション、 これを拡張する。 で、この中で何を取らせるかというと、バーでDelegate。 このDelegateを、ランドマークAppDelegate。 これをやらないと、先にやらないでみましょうか。 これ無しでいくと、例えば、ここで何かあるんでしたっけ。 何と言ったか、コントローラー。 コントローラー。Notificationコントローラー、あれですね。 これをいじるときに、エンバイロンがダメだったので、 そうすると、この中で、 これはモデルデータをインスタンス化している方ですね。 ここで、新たに作るんじゃなくて、Delegateを持っています。 なので、WKアプリケーションがレア度で、 共有しているので、これのDelegate。 これを取りたいんですけど、これは、AnyWKApplicationDelegateの オプショナルという形になっているので、 ここからいきなり何か取ることができないわけですよ。 そこで、これでWKアプリケーションに対して、Delegateとして、 ランドマークアップDelegateのオプショナルという風にしてあげて、 ここで、Delegate、Self、Upper、Upperの方が出てきたっけ。 Upperのオブジェクトを忘れている。 Delegate、UpperのDelegateが出ないか。 アプリケーションですね。WKアプリケーションで、 NSオブジェクトはDelegateを持っていない。 WKアプリケーションのDelegateを見てみますけど、 WKアプリケーションは、UpperはNSオブジェクトですね。 SelfがDelegate、そんなことできたっけ。 さっきのアクション、プラス継承しないとダメですね。 ちょっと思い出したんですけど、 ランドマークアップで、ランドマークオブジェクトでしょ。 この中で、Built-inのインフォ。 インフォの中で、アプリケーションのインスタンス。 ここにないか。オブジェクトの方だと、 アプリケーションのインスタンスが、どれだ。 書いてないか。書いてないですね。 じゃあ、追加すればいいのかな。 クラスを指定できるはずなんですよ、確か。 この辺で、追加はないですね。 追加はどこだ。 追加は、これに対して、ここだ。 これで新たに追加で、それでプリンシパルクラス。 プリンシパルクラスってどっちが大きいんですかね。 ちょっとやってみますか。 ランド、まあいいか。何にすればいいんだ。 アプリケーションとかやって、 とりあえず動かしたときに、エラーで落ちてくれれば、 効いてるってことになるかと思ったら、そのままにコンパイルエラー。 これが、SelfのDelegate。 これはやってもダメですよね。 プリッパーしようか、そうね。 これはやるわけにいかないんで、今ちょっと工夫してるわけですけど、 実行してアプリを落としてみて、 作業してくれればわかんないですけど、 今、フィルトはエラーで落ちた。 アプリケーションを持っていけたかとか、ここをまだやっとした。 これをちょっと動かし、これが、L8をもうちょっと、 イニシャライザーで作るだけにしておいて、まずアプリを落とす。 実行がかかって、動いて、 アプリがもう落ちてると嬉しいんだけど、戻れば、何とかなってるかな。 今、マルブが見えるなら、ちょっといい。 また強制で映された。 これで、覚えたかね。 プリンシパルクラスダメか。 イニシャライザーされちゃいましたね。 プリンシパルクラス。 これを消しておいてあげて、 別の方法としては、若干美しい方が良くて、 共通インターフェースで全部狙っていいとか良かったんですけど、 プリンシパルクラスが効かないのか。 IOSの方でやってみましょうか、プリンシパルクラスね。 さっきの書き方すると落ちると思うんですよ、アプリが。 プリンシパルクラスとして、アプリケーション、いやなんでしょうね。 これで実行してあげると、多分IOSの方が落ちるはずなんですよね。 IOSの方動かせばよかったですが、 これで覚えてるね。 起動するところがIOSにしてみますか、これ。 とりあえずね、IOSにしてビルドをかけて、実行してみる。 そうすると、基本的に落ちると今言ってますけど、 もちろん今のところに引かれて実行でしょ。 これで実行してシミュレーターの方へ行って、アプリが覚えてありましたね。 どこに行っちゃうのか。プリンシパルクラスですよね。 プリンシパルクラスで、ビルドセッティングではなかったですね。 インフォビリストでいいんだと思うんですけど、プリンシパルクラス、アプリケーション。 どうですか、プリンシパルクラス入ってない。 アプリしかた、オール、プリンシパルクラスだから。 とにかくIOSの方が入ってましたね。 プリンシパルクラス、これは例えば、 生きているのが本来なんですけど、どうなのかな。 プリンシパルクラスが見つからないと言われて 落ちてくれるのが普通なんですけど、どっちか。 あ、動いちゃいますね。あれ、おかしいな。 プリンシパルクラスコンプリケーションプリンシパルクラスってなんだ。 あとは、ここプリンシパルクラス今作りましたけど、 インフォ。このインフォの中で今出ましたよね、プリンシパルクラスが本来ね。 プリンシパルクラス、これね。で、消してみましょうか。 プリンシパルクラスを消した。で、ビルドセッティングに戻るといなくなる。 面白いですね。昔はこんな感じじゃなかったのに、 いつの間にかインフォPDFとビルドセッティングが一緒になっている感がある。 で、プリンシパルクラスはどう使うのかな。 プリンシパルクラス。調べるといろいろ出てくると思うんですけど、 iOS、iOSプリンシパルクラス。 こうすると、多分プリンシパルクラスを返しますと、 これなんですけど、プリンシパルクラスを返しますと、 そんなメソッドがあるのか。誰が持っているんだ、これ。 プリンシパルクラスはバンドルが持っているのね。 今回使わない気がしますけど、 プリンシパルクラスは基本で、最初クラスだと。 プリンシパルクラス、メソッドを知りたいわけではないんで、 そこでですね、UIアプリケーションを継承した ガスタマンのアプリケーションクラスを使う。 ガスタマンのアプリケーションクラスを UIアプリケーションと継承して持たせて、それで、 どういう方法ではなく、UIアプリケーションメインアプリケーション。 これを使っているのか。なるほど。 これでUIのメインがあるので、あれを使っているのか。 それで、いろいろと勝手に起動するのか。 プリンシパルクラスではなくなった感じですかね。 これがちょっと情報が、ユーザーインフォ。 これを使った方法を書いていなかったんですけど、 さっきの設定のようなところからできるんですが、 プリンシパルクラス。 プリンシパルクラスを使う人は、直接は使えないか。 オブジェクティブCとかUIキットで使っていくというお話ね。 そうすると、ここにプリンシパルクラスが書いてありそうですね。 プリンシパルクラスを削除する。 大胆な説明ですね。 無条件で決していいものではないので、プリンシパルクラスはね。 新コンフィギュレーションも同じじゃないかな。 アップデリゲートのインスタンスカバーのデリゲートで、 ここがエントリーポイントになっているから、 アプリケーション。アプリケーション。 アプリケーション型があるじゃないですか。 これを活用しましょう。 今、無理やり新たに作ったアプリケーションデリゲート。 この中で何とかしようとしていたんですけど、 ここで型をメッキしないと、普通のUIアプリケーションデリゲートという 共通インターフェースだけしか取れなくなっちゃうんで、 そうするんじゃなくて、Apps。 これはAppsデリゲートか。 WatchOS。Watchにして、マシンをクリックするんですけど。 これでデリゲートをファイアしますが、 このファイアする先を、例えばアプリケーションのエアーとか、 どうしようかな。悩ましい。 WKアプリケーションでやっぱり使いたいっていうのを何とかするんですけど、 それはちょっとやりにくいので。 ファイアするべきはランドマークアップですね。 ランドマークアップ。 ここでこれをスタティックバーにしてあげて、 それでこのデリゲートは、セルフデリゲートじゃなくて、 WKアプリケーションのシェアと、この中のデリゲート。 このデリゲートはちゃんと、さっきのと言えば、ここで作ったやつ。 ランドマークアップデリゲート。 この型にオプショナルがこういったふうにできる。 ランドマークアップデリゲート。ランドマークスでしたね、名前はね。 リネームでランドマークスアップデリゲートね。 これでファイル名も変わってるか。 ここのコメントも変わってるか。 ファイル名も変わってるか。ここのコメントも変わってるか。 ランドマークスアップデリゲート。ここに拡張がでていいですね。 デリゲート、ランドマークスアップデリゲート。 だからシェアとWKか、WKアプリケーション。 これはもしかすると、もしかするものにもないか。 アプリケーションデリゲートアダプターと同じように、タイプエリアスで Uiアプリケーションをするのと、WatchOSの場合はタイプエリアスで、 アプリケーションはWKアプリケーションっていうふうにね。 拡張先がランドマークスアップに対して、デリゲートとして、 ランドマークスアップデリゲート。アプリケーション、これ何にもいらなかった。 いらないときはまだいらないでしょ。 こうしてあげれば、気をつけていいですね。これでデリゲートがちゃんとね、 いいとした方で接続できるよっていう状況が作れたと。 あとはデリゲートだから、ランドマークスアップの中で、 デリゲートちゃんと持たせてますね。 デリゲート持ってるじゃないですか。 なのでそこを考えたらこれ強制アンラップにして、 これは無しにすると、これでもいいのか。 これでいいんだ。オプショナルではない。 これをアンラップした気がするの。 言語仕様的にどっちでもよくわからない。 とりあえずこれでいいや。 ランドマークスアップのデリゲートを参照すれば、 ダイレクトに安全なものが手に入るっていう約束ができたんで、 そしたらランドマークスアップのモデルデータを取るときに、 これをランドマークスアップのデリゲートのモデルデータっていうふうに指定することができると、 これでちゃんと動いてくれればOK。 アプリケーション内でメインで使うデータもそうだし、通知で渡ってくるときに使うデータも、 両方ともデリゲートの中に入っているモデルデータを使っている。 これらのソースは一箇所になりますよね。 このためにアプリケーションを使ったほうがいいよっていう話だったんだ。 なのでこれでOSの頭の採用を吸収した上で、 ここで吸収したほうを使うと。 これでビルドが通りますよね。 あ、通らなかった。通らなかった。 どこだ、通らないの。 ワイビルドポジティブはこっちのほうのビルドで、 ノンファンクション UIアプリケーション UIアプリケーション UI、WKアプリケーション アプリケーション ビルドをもう一回書きます。 ビルドはここですね。 これでUIアプリケーションと言いましたね。 もう一回チャントを試してみます。 OSのビルドの中でノンファンクションタイプ、関数の方とかではないUIアプリケーション、 これが呼び出された後がもう一つのęp勝です。 アプリケーションシェアと、呼んでみます。 アプリケーション、WKアプリケーション。 これでシェアと、WKアプリケーションですよね。 これがデリゲートを持ってますよね。 デリゲートを持っていて、これで一回ビルドを書いてみますけど、 どういうビルド? ミシングリターン、これですよね。 リターンのミシングが良いと書いておくとして、 それでビルドを書くときにビルドが失敗で、 ビルドの失敗箇所が2箇所が何となくサーブデリゲートですね。 それで一回クリーンビルドを書いてみますか。 ログとかキャラの箇所が出てくるととても助かるんですけど、 今のところ出てくれてないので、ビルドフェイル。 出ないか。 これがコンソールが動いてますね。 コンソールが動いている。 これが何か入っちゃったりするかな。 コンソールはもういいや。 これコンソールが動いてる。 一回停止をやってみて。 それで一回iOSの方をビルドしてみましょうか。 こっちがまずビルドできるかどうか。 これのビルドはこうすると、もう出てなかったですね。 同じiOSの方もエラーで。 これでちゃんと出てますね。 エラーがね。 ノンフランクションタイプUIを。 あーなるほど。 これはプロパティですね。 ただのね。 だからこれで良くて、これが使われてないでしょ。 こっちで一旦エラー無いですよね。 ビルド書きますよね。 まだエラー。ここでUIアプリケーションのノンフランクション。 今コントロールできますよね。 アプリケーションのシェアアド UIアプリケーションですよね。 これでディレギュートで。 良いと思うんですが、ビルド書けて、どこのエラーはどこですかね。 ここのノンフランクションタイプ。 同じ名前だからダメなんですかね。 ディレギュート1とかやってすごい誤魔化すんですが、 こうした時にエラーがどこになるか。 エラーがどこになるか。 アプリケーションのシェアアド、ディレギュート。 アプリケーションのシェアアド、ディレギュート。 例えばこれ、縁に出て誤魔化しますけど、 ビルド書けた時にこれ前はこんなディレギュートか。 ちょっと自分の勘違いかもしれないですね。 ディレギュート1、スタティックバー。 で、計算はトッププロパティで、 アプリケーションのシェアアドはプロパティですね。 で、それでちょっと言い戻りますか。 UIアプリケーションのプラスバー。 プラスバーでUIアプリケーション。 いいですね。ここはいいでしょ。 いいのになんでダメなんだろう。 UIアプリケーションのトップを真面目に書いてみましょうか。 UIアプリケーションのシェアアド、ディレギュートでランドマックスアップディレギュート。 そしてこれを、これをビルド書けてあげると、 ビルドが失敗してますよね。 エラーがちょっと出てくれてないですけど、 もう出てるとか一緒ですね。 呼び出せないバリューの番数ではないか。 ノンファンクションタイプのUIアプリケーションの値を呼び出せないと言われてますよね。 で、これ丸く書いたってところはそれでよかったんですけど、 今はそんなこと書いてないじゃないですか。 一旦クリーンしてみて、これでやってみますけど、 エラーですね。 これがエラーの様子がちょっと変わった。 Unavailable、UIアプリケーションは ウォッチOSでは使えませんになりましたね。 iOSの中ではビルドできましたが、 ウォッチOSのビルドが欲しかったのか。 ウォッチOS。ちょっと植えとけたと思うんですけど、今。 ビルドは。 どうしようか。そうするとちょっとわかった気がしますね。 例えばこれをウォッチOSに変えたとき、 ウォッチOSに変えたときに、 このWKアプリケーション、 WKアプリケーションのシェア、これがメソッドでしょうか。 そうですね。このせいですね。 WKのエアードとかメソッドね。 この辺でどっちだってもダメっていう、 そういった状況ができたという可能性があって、 そうするとなると、別に定義するしかない という可能性が出てきますかね。 エアード、アプリケーションに対してエアード。 そうですね。 あとは考えられる方法としては、 例えばこうですね。 どうしようかな。 悩みますね。 アプリケーション、エアードを所得するときに、 ここは別に頑張って共通化する必要もないと 言わせるんですけどね。 エアードをシンプルに取りたいなという希望を なんとなく感じていて、ランドマークスアップに対して 今、定義ゲートを載せるということは、 ここをずっと配慮してもいいのかもしれないですね。 例えば、ランドマークスアップでシェアと。 例えば、ウォッチOSの中では、アクションをランドマークスアップに対して、 そして、これでアプリケーション。 これを返してあげるよというふうにしたときに、返す値は、 AAアプリケーションのシェアですよね。 こうしてあげて、これを結局、iOSのほうにも書かないといけないんですけど、 これをiOSのほうではシェアアドのUIアプリケーションですよね。 これのシェアアドでプロパティ。 こうやってあげると、ランドマークスアップのシェアアドで 差を収集できるんで、あとはこれを使って、 デリゲートは普通にランドマークスアップから 自分自身のシェアアドからデリゲートを取って、 そのデリゲートをランドマークスアップデリゲートに丸めてあげて、 丸めてあげた型を見切ってあげて、これでコンパイルコンパイル取れますね。 これが今、ウォッチOSか、ウォッチOSのほうで通ったので、 こうしたら、テストができるんですかね、できますね。 このデリゲートから取るようにしたんで、これで引っ越して、 動いて、オームに戻して、ここからAPMSを投げてあげると、 なんと通知が出てほしかったんだけど、出てこなかったね。 ダメですかね。これでエクスコードのほうで落ちてる。 ああ、ここの後で落ちてますね。 シェアアドのデリゲート。 デリゲートをやったときに、今の型変でしたね。ランドマークスアップデリゲート。 これはランドマークアップデリゲート。 間違えてる。これはWKアプリケーションデリゲート。 これじゃないですね。取りたかったのは、 えーと、何でしたっけ。これですね。ランドマークアップデリゲート。 ランドマークスアップデリゲート。 あ、あってますね。デリゲート取れなかったですね。 これはどうと思いましたね。 だからそうしたら、落ちますかね。ここでブレイクポイントを貼ってあげて、 どうなるか。もう一回行きましょう。 デリゲートが取れてない、作られていない可能性を考えると、 このやり方は全然ダメでしたね。 で、ブレイクしたと思うので、行くと。うん、してますね。 で、セルフとして、ランドマークスアップ。 ランドマークアップは構造体で存在してますよね。 これに対してモデルがイニシャライズ。 あ、これは最初は、最初起動したときですね。 これで、Poで、シェアとか言ったけど、シェアとかじゃないですね。 セルフ、セルフは関係ない。あ、一応セルフ出しました。 これは普通に、なんてこともなく、普通にセルフの型を出そうと思ったんですけど、出てこないですね。 えーと、デバッグ、デバッグの表示持ち、出てこないですね。 それだと困るんですけど、出てきた。 で、Poでランドマークスアップ、ここのシェア。 これを出すと、インスタンスが取れましたね。 で、この取れたのが、えーと、ワーニング。 ワーニングですが、エアド、ランドマークスフォーチューブ11、アプリケーション、ATとかの名前が出てますが、これはクラスですよね、多分ね。 Poタイプオブ、えーと、ランドマークスアップのシェアをね、こんな風にして取ると。 で、えーと、関係は、出てきたのがこれかな。 えーと、タイプ、タイプ、あれ、えーと、んーと、なく実行できてない。 Poタイプオブ、ランドマークスアップ、エアド、これを動かしたつもりだったんですけど、えーと、これね。 タイプオブここに書いてあった、えーと、タイプフォールバック、トゥイフト、AST、コンテキスト、アツトゥー、オペレーター、ワーニング、これワーニングか。 まぁちょっと出てないですね。 どうか、えーと、どうしようかな。 Poをもう一回やってみましょうか。 ランドマークスアップのシェアと、これはもう一回ちょっと出てくれるんですかね。 出てこないとしたら、ここで色々プリントを入れ込んで様子見ますか、一旦ね。 プリント、で、それで、例えば、なんかね、ここで出していくとして、3個、2個、2個ぐらい、3個ぐらい欲しいかな。 これで、例えばまず、エアードですね。エアードで、インスタンスがどうなってるのかを見たいのと、デリゲート。 これがねどんな形になっているのか見たいのと、あとはАWKアプリケーションデリゲートって言うのがありますね。 AWKアプリケーションデリゲート、ランドマークスアップデリゲート、なんか凄いヤな予感が出るんですが、ランドマークスクアップデリゲートってここにありません。 なんか、えぐスペンション、ないのか Egyptページ出てなかった、そうか、ランドマークスアップデリゲートで、ランドマークスアップデリゲート。 エアードに対してデリゲート、あ、ここがいいんだ。それでタイプオープン、それの型を実際に見たい、シェアードのデリゲート。 この3つが分かってここでブレイクしてくれれば基本大丈夫でしょう。一応、データを元において、このシェアードのデリゲート、これはオプショナルな可能性がある。 これは良いですね。実際実行してみて、デリゲートがどんな風なものになっているのか、ちょっと見ていきましょう。 おかしいな、デリゲートがちゃんと取れると思ってるんですけど、ラップされたら困っちゃいますね。 あ、そうか、通知を投げないとダメか。通知を投げないとダメってことは、まだデリゲートを参照してないからですね。 そうそう、これは良いんだ。なのでこれで、EMSをこうやって投げて、この時にブレイクを打っているはず。これで、WKApplicationDelegateが入ってますね。 WKApplicationDelegate、WKApplicationDelegate、ランドマークスアップデリゲートは、ランドマークスアップデリゲートで持てるデータですよね。 ここでは、WKApplicationDelegateが入った。この上ですね、オプショナル、エクステンションデリゲート、すべてはエクステンションデリゲートのこのアドレス、Wi-Fiのエクステンションデリゲートなんていうのがあるんですかね。 ここを見てみますけど、エクステンションデリゲート、WKエクステンションデリゲートというのがありますね。 これは何だ?メソッドモニジットレベルの動作は実際エクステンション。これは関係ないね。 そうすると、 そうすると、UIのエクステンションデリゲートのアドレスというものが入っていて、それになっているから取れないのかどうか。 これはちょっと困った感じですね。 取れればよかったんですけど、デリゲートが取れないのか。 デリゲートが取れないとなると、もう一つ考えられる要望の共有パターン、シングルトンですか? シングルトンね。シングルトンでもいいんですけど、どうか。 デリゲート、デリゲートがアプリケーションエアワード、シングルトンちゃんと取れてますよね。 このデリゲートがアダプターが入っているんですか? もしかしてデリゲートアダプター、関係ないかなそれは。 デリゲートアダプター、アプリケーションデリゲートアダプターってどういうプロパティーなのか。 これで、デリゲートタイプとして 型を持っていて、wrapped valueがデリゲートタイプなので、 なんかねwrapしてデリゲートを持ってると 思われるんですね。 そのことでデリゲートタイプはアダプタで、 observed objectのwrapper、protected value、 あとはイニシャライザーと デリゲートタイプがオブザーバブルだったときとかで、 あとは、センダブル。どうでもいいけどセンダブル。 ここまでですね。どうかデリゲートが取れなかった。 困ったなあという感じだ。 そうすると、モデルデータを共通でデリゲートに入れておいて、 これを使いたかったというのが、簡単なお話なんですけど、 モデルデータを共通化すると考えられるのは、 普通にロストティックバーができるんですかね。 ロストティックバーもできるか、これを使っておけば、 モデルデータシアートでもいいのかなってところはありますけど、 モデルデータシアートで、そうですね。どうしますかね。 デリゲートが取れなかったとなると、 あれでも取れなかったのを一回やったことが、 iOSからできたんですかね。やったことある気がするんですけど、 デリゲートを持たせてプリンシパルプラスをいろいろいじってみたいな、 そういうやつ。できなかったならしょうがない。 そうすると、例えばモデルデータをシングルトンにするというのが、 一つ考えられる方法かもしれないので、それをやってみますね。 モデルデータ。このモデルデータの中に、アットステート。 アットステートがスタティックにつくのかという問題もいいんですけど、 シアートイコールモデルデータ。こんな風にしてビルドをかけると、 これビルドが通るのかな。取れなかった。 今から練習するか。モデルデータをどう扱うかですね。 これをメインアクターから扱うようにアットステートする方法が一つと、 シアートじゃない方法が一つですね。闇雲にメインアクターで縛るのも難なんで、 ここのアプリケーション。ランダムアップアップのところ。 ここでいいかな。ランダムアップアップのところにモデルデータ。 モデルデータとしてスタティックバーで持たせて、これだけだとビルドは失敗ですが、 ランダムアップアップはメインアクターで保護してるんですが、ビルド取れますね。 こうしてあげて、こうしてあげるとメインアクターが取れるはずなので、 取るはずがわからない。取ってくれていいのかがわからない。 とりあえずこれで、OSのほうのまずはノーティフィケーション、コントロール。 ここだけ持っていってみましょうか。ランダムアップアップの中にモデルデータを用意した。 なのでこれを使ってあげれば、ちゃんとイメージを取ってきてくれるだろうというままできたり。 これは大丈夫でしょうね。テストっぽいこと何もしてないんで。 これは普通に情報を持ってこれるので、ちゃんと画像が表示されるよという状況になってくれる。いいですね。ここは良かった。 次はiOSですね。問題はね。iOSはプロダクトをiOSに変えて、それでコンテンツビューか、そのままですかね。 アプリケーション、ランドマークズアップの中で、確かエンバイロメントでこうやって渡してるわけですよ。 デリケートのモデルデータ。これをセルフのモデルデータ。 これに変えてあげて、スタティックメンバーをちゃんとネットで渡せるんだったら、これでとにかく情報の一元化はできたということにはなる。 でもそんなこと気にしなくていいのかな。通知が終わって、閉じたらもう終わりですからね。 なのでその瞬間のスナップショットを持っていればいいという、そういった発想で考えれば、 ちょっとリアルにあったみたいな、いきなりディフォルトイニシャライザーでインスタンス化するというのも、ないと言えばないですが、それならシングルトンがいい気がしますね。 ファイルマネージャーみたいな方は、必ずどこからでもシェアアウトで呼び出すことによって、同じソースを使うことがインスタンス化。 変わることもないんですけど、できるという、そういった感じのアプリ。 で、素直に作るならそっちですよね。チールルート、これいる? これのお気に入りを外して外れた感じしますね。 それで戻ってあげて、テリストの方を見ると2つだけ。あとは例えば、ツインレグ、これをお気に入りに入れて、それで戻ってあげると、ツインレグもお気に入りに入った。 なので、スタティックパワーであっても大丈夫ということが、とりあえず動いている限りの現状を見る限りでは、わかった。 この状態で、これオフしてあげて、投げ込んであげた時の通知も、同じスタティックからの情報を見てるんで、どっち出てるの?あれだけでいいのか? あれだけしか、ホストが付いてるからかな?違うか。これはデバッグのモードが違うからかな? シミュレーターが動いてるんで、どうなってるわけではないですよね。 これでもう一回投げてみましょうか。これで投げてあげて、これでできたとタップすると終わってきましたね。 で、画像が出てるし、OK。で、リスミスを押すと、これをもう一回投げて、そしてこの辺を押すとアプリに戻ると、この時のデータソースは全部一緒の後、おそらく。 モデルデータが、もう一回これ消して、アプリ終わって動かしてみましょうかね。これで実行かける。 で、こうして動かして、いや、動いてくれればそれでいいんですけど、いいんですけども、なんとなくどこか微妙なんですよね。 これでいいのかな?そういうふうに言われても、ちょっとリアルのように本当に気にしないでインスタンス立ち上げてあげればいいのかわからない。 とりあえずこれで、今モデルイニシャライズが2回超えたのは余計なところ、余計なところが残ってるんで、2回イニシャライズしちゃってるっていう状況ですね。 それで、オフにして投げてあげると、はい、投げるだけですね。これを引いて投げて、これで出てきた。 この時に別にイニシャライズは増えてないですがね、ここが満タンで、上がここまで、そうね、レシーブ。うん、そうね、これで良さそうですね。 そうするとコードが随分と簡単になりまして、簡単というか、これは私のほうか、これね、デリゲートがまずいらなくなる。 デリゲートに置きたかったんでね、今回ね、デリゲートにこのモデルデータを置きたかったんですけど、結局のところ置いた場所ってアプリケーションになったじゃないですか。 なのでこのステートのスタティックバー、これ自体をもうアプリケーションに持たせた方がいいですよね。 こんなスタティックバーに置いているのを見たことない気がしてならないんですけど、こうなるとプライベートできますから、まあまあ、テオリーには乗るんですけど、こうして、これでエクステンションこれいらないでしょ。 デリゲートも結局のところ、逆に今回は当たらなかったんでいらなくなるでしょ。 そうすると、この辺のデリゲート周りのものが一切いらなくなりますよね。 これは消しちゃいましょう。で、消しちゃいけて、で、ここまで来ると、あとは、ビルドが来るともう取るんですかね。 デリゲートがもういらないですよねっていうお話。 で、ビルドが来るとビルドがまた通るのか、モデルデータがインアクセスティブル、あ、プライベートが、あ、そっか、モデルデータのランドマークのモデルデータ、プライベートが結局できなかったですね。 そこから渡せるんだったらいいんですけど、そもそもスタティックバーじゃなくてよくなりますよね。 ここね、ノーティフィクションコントローラーに渡したいっていうね、そういう要求ね。 これでビルドが来るとこれでビルドが通りますよね。これで終わりという、そういったお話になってくると。 終わっていいのかな、これっていうそういう雰囲気をなんか感じてるんですけどね。 これが共通、共通ができたし、ステートも共通ができたし、問題ないのかな。 インスタンス、ノーティフィクションコントローラーが勝手にイニシャライズされちゃう以上は、何かを渡すことができないし、 それに対するイニシャライザーというものもね、プロトコルで規定されているものを使ってインスタンス化するんでしょうから、 特別なものを渡すということは難しいのかなと思われる。 プロトコル準拠という型があって、プロトコルに準拠、メタタイプで型があって、イニシャライザーを呼んで、 ステートのスタティックバーでいいのかな、本当にいいのかな、これ。 まあいいか、いまいち大丈夫だと思うんですけど、ちょっと気になる。 あとはステートを管理するためのマネディアみたいなのを1個、 後で作って、これをね、グローバルにアクセスするっていうデータであればなんでもかないと思うんで、 それでもいいと思うんですけどね。 とりあえずアプリケーションね、グローバルの1個のインスタンス。 これ結構アプリケーションの世界の中では絶対的じゃないですか、必ずアプリケーション1個ですよね。 なのでここに置いたほうが楽、とりあえず。 なのでここに置いたということで、OKですね、とりあえずね。 はい、じゃあこんな感じでデータは1箇所に置きましたよということにしようかな。 いやでもここグローバルに置いたらね、エンバイロメントで持っていく必要がなくなるじゃないですか。 どこからでもこのモデルデータにアクセスすればいいっていう話になりますよね。 なのでね、ちょっとばかし良くない持ち方、なんかいろんなところにブレを、 いろんなところはいいすぎか、ちょっとしたところにブレを感じるんで、 なのでノーティフィケーションコントローラーに渡したい。 だとすると、通知が表示されるための情報をAPIのSファイルにちゃんと入れておけっていうね、 それに尽きるような気もするんですけどね、画像とか。 あとは画像だけをIDから取れるようなデータを持っておいて、画像は差し替えないっていう前提だったら、 これは別に、ファインドアドと立立してインスタンス作ってもそんなに気にはなってこないのかな。 バンドルからね、画像のIDを元にバンドルから画像を探してくるみたいな、そういったコード。 これをなんか、ファイル名渡せばいいんだ。 APIのSファイルで、ランドマークのIDから画像を引っ張ってこさせるんじゃなくて、 本当にランドマークの画像のID、ファイル名、そういったのを渡してあげるでもありますよね。 あとはね、最初の頃に言った、ペース64の中で埋め込むとかね、 情報量多くなったら面倒なんで、バンドルから取ったほうがいいかなと思うんですけど。 もしないと、ノーティフィケーションコントローラーとの連絡が難しい。 そこが非常に厄介ですね、っていう感想。 そこまでで十分かな、今回のチュートリアルとしては。 チュートリアルがそんな課題を与えているわけではないのですが。 まあまあ、これでいいや。ひとまずはそうしておきましょう。 あとは、今日はこれくらいにしておこうかと思うんですけど、 あともう一つやっておかなきゃいけないことがありまして。 それは、チュートリアルを操作しながらやりながら、 勝手にiOSのほうを見るとわかりやすいのか。 このプロフィールボタンをランドマークスのほうのトップに出している複雑な画面のほうに、 複雑な方にプロフィール表示用のボタンをチュートリアルで使っていたんですけど、 これタブパワーだったので、どっちにも欲しいよね。 勝手に配送したこのプロフィール表示ボタン。 これがiOSではうまく動いていたんですけど、Apple Watchになった時には、 インターフェースはシンプルに使用最初限のものを用意しないと使い勝手が良くない都合で、 このApple Watchはリストだけの画面、 これをチュートリアルで作っていたことになったんですけど、 この時にユーザープロファイルが表示されているわけですよ。 なので、これを表示しないようにしたい。 まあ、シャープイフでOSだったらそういった感じで排除する方法もあるし、 または別の滑らかなフラグを用意する方法もあるしみたいな感じで、 いくつかやり方はあるので、サクッとできそうな気もするんですけど、 これはまた次回にしてみましょうか。 次回これをやってみて、サクッと解決するならすべていいですし、 複雑になったら1時間だったら後に見ていけばいいですし、こんな感じにしましょう。 はい。では、これで終わりにしますね。お疲れ様でした。

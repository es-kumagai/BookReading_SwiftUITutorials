Transcription & Summarize : とりあえず読書会 SwiftUI Tutorials #16

はい、では今日も「とりあえず読書会」を始めていきます。UIチュートリアルはパート4まで進めてきましたが、そろそろ形になってきたかなという段階です。リアルタイムに追いかけながら進めているので、まだやったことがない内容もありますが、引き続き取り組んでいきましょう。今日はどこから始めるのかはまだ把握していないので、これから確認していきます。

やろうとしていることは、デザインとレイアウト、つまり「Working with UI Controls」です。UIコントロールを使って動作させるわけですが、何を追加するのかを見ていきます。Landmarksアプリで、ユーザーのパーソナリティを表現するプロフィールを作る、という流れのようです。ユーザーにプロフィールを変更する能力を与えるために、編集モードと編集用の画面を追加して提供する必要があります。そして、共通のUIコントロールを使ってデータ入力を行い、その変更をモデルタイプに反映していきます。ここで言っているモデルタイプは、おそらくLandmarksのモデル（たとえば`UserData`）のことだと思います。まだ全体のイメージは固まっていませんが、進めながら理解していきましょう。

次に進むにあたって、必要なファイルをダウンロードする指示があるので、まずはダウンロードしておきます。最初にユーザープロファイルの表示を作ります。Landmarksアプリはローカルストアに保存する構成（Configuration）です。Preferences（環境設定）や詳細の扱いについても触れられています。Preferenceは「好み」という意味ですが、アプリ文脈では「環境設定」と訳すのが一般的ですね。そういった設定をローカルストアに入れる形のようです。

ユーザーが詳細を変更する前に、まずは編集不可の概要表示を用意して、情報を読み取り専用で見せるところから始めます。つまり、編集コントロールを持たないビューを先に作る、という方針です。

まずは定義からです。モデル側にユーザープロファイルを追加します。`Profile.swift`というファイルを作成し、`Models`グループに入れます。ここに`Profile`を定義します。コピペで入れていくのが安全ですね。`Foundation`をインポートして、`Profile`には`username: String`、`prefersNotifications: Bool`、`seasonalPhoto: Season`などを持たせます。`username`は文字列で、通知の可否、季節ごとの写真（あるいはシンボル）を選ぶための`Season`を持たせる形です。デフォルト値として、`Profile(username: "g_kumar", ...)`のような初期値が用意されています。この「デフォルトのプロフィール」をどう扱うかは使いどころ次第で要注意ですが、ひとまずサンプルに従います。拡張で`Profile.default`のように生やしておくのは分かりやすいと思います。

次に`Season`です。`Season`は`CaseIterable`や`Identifiable`に準拠します。チュートリアルでは`enum Season: String, CaseIterable, Identifiable`として、`rawValue`に絵文字などのシンボルを入れ、`id`に`rawValue`を返す実装が出てきますが、個人的には`rawValue`にシンボルを持たせるより、`symbol`のような計算プロパティで返す方が意図がはっきりしていて好きです。たとえば、`var symbol: String { switch self { case .spring: return "🌷" ... } }`のようにします。`Identifiable`の`id`は`String`ではなく`Season`自身を使って、`var id: Season { self }`としても良いでしょう。その方が`rawValue`に依存せずに済みます。`CaseIterable`は必要になるかどうかはこの先の使い道次第ですが、季節の全ケースをリスト表示するときなどに役立つので、ひとまず付けておきます。

このあたりを調整したうえで、`Profile`のデフォルトを拡張で用意しておけば拡張性も確保できます。インデントや`switch`の`case .spring:`のコロンなど、細かい構文も整えておきます。

準備ができたら次に進みます。`Views`の中に`Profiles`という新しいグループ（フォルダ）を作成し、その中に`ProfileHost`というビューを作ります。ここは、保存されているプロフィール名を`Text`で表示するだけのシンプルなビューから始めます。`Text(profile.username)`のように、編集はできないけれど概要を表示する役割ですね。サンプルでは「Host」という名前がよく使われていますが、ここではプロフィール表示・編集のハブになる想定なので、なるほどという感じです。

こんな流れで、まずは読み取り専用のプロフィール表示を作り、次の段階で編集モードや編集画面（エディター）を追加していく、という方針で進めていきます。 まず、`ProfileHost` を表示してみます。ここではデフォルトプロファイルを使っていて、デフォルト値が入っていますよね。これが少し気になるところで、`ProfileHost` は本当にそういうものなのかなという疑問があります。多分、初期値はここで直接持たず、イニシャライザーで渡したほうがいい気がしますね。この場で渡してしまうほうが自然に思えます。

ただ、`defaultProfile` というプロパティ名であればありえなくはないですね。このアプリには「デフォルト」という概念がプロファイルの中にあるのでしょう。例えば太郎くん、花子さんのような感じで、初期の代表値を指すものです。では、ひとまずそういうことにしておきます。テキストとしては、今のところ `ProfileHost` の初期値が表示されるようになっている、というところまでできました。

`ProfileHost` は、このビューがプロフィール情報と編集モードの両方をホストします。両方を `@State` で持つ、ということですね。「`@State` ってなんだろう」と一瞬思いますが、つまりステートとして保持する、という意味です。ああ、なるほど。とはいえ現状は両方エラーで真っ赤になっていて、どうするんだろうという状態です。`ProfileHost` をセットアップしたら、次は別のビューに進みます。

プロファイルのグループとして、`Profile` インスタンスを受け取る `ProfileSummary` を作ります。`ProfileSummary` は基本的なユーザー情報を表示するビューです。ここは `Profile` のバインディングではなく値を受け取ります。親ビューである `ProfileHost` がこのビューのステートを管理し、`ProfileSummary` は表示専用で変更する必要がないので、これで良いということですね。 なので、これを`ProfileSummary`にします。`ProfileSummary`はここでこんな感じになるはずです。ここは問題ないですよね。`Profile`は特に変更しません。別にバーでもいいのですが、`name`のほうが変更されないだろうと期待するかもしれません。そんなつもりで進めます。バーでも全然大丈夫だと思いますけどね。

`body`で`ScrollView`を使い、`VStack`で、`Text(profile.name)`などいろいろ表示します。通知はオン・オフできるようにし、`profile.prefersNotifications`で切り替えればいいですね。いつもここでグローバルになっていますが、これはシンボルを書き換えたやつです。`Goal Date`は普通に`Text`で表示します。できましたね。これでいい感じです。といっても、特に大変なことはないですけど。

それで、`ProfileHost`で表示します。そのために新しいビュー、つまりさっき表示した`ProfileSummary`を使って表示します。説明は特にないですが、コードを見ろということですね。`ProfileHost`の中では、`body`だけ変えれば大丈夫ですよね。これをコピーして`ProfileHost`のほうに、`body`を`Text`だったのから、さっき作った`ProfileSummary`に書き換えます。これでデフォルトの`Profile`を渡しています。デフォルト表示ができました。なんとなく言い訳もあるけど、できました。

次に新しいビュー、`HikeBadge`を作ります。`HikeBadge`って作るのかな？ 新しい`HikeBadge`。`Hikes`フォルダの中に`HikeBadge`というビューを作って、そこに組み合わせる`Badge`（前に作ったやつ）を置きます。さらに、ハイクについての説明テキストを表示する、そんなものも来るらしいです。まあいいか。これもコピペになっちゃいますが、`HikeBadge`を作ってみます。`HikeBadge`は`Hikes`フォルダ……と思っていましたが、`HikeView`はコントロールに入っていますね。今度の`HikeBadge`はビューの気がするので、ビューに入れておきます。やっぱりビューなのか。じゃあコントロールでもいいですが、この中に入れましょう。

`HikeBadge`は`View`で、`name`が渡ってきています。`let name: String`ですね。デフォルトとして中央に`Badge`があって、すでに`Badge`は表示されています。それに加えて、いろいろとテキストも含めて`name`が表示される、という形です。プレビューのテスティングは、貼ったばかりでほとんど直していない感じですかね。じゃあ次行きます。

これで、バッジは主にグラフィック部分だけです。テキストは別。`HikeBadge`にはアクセシビリティもあり、そこに対してテキストのラベルを付けています。アクセシビリティをちゃんと考慮しているのはすごいですね。とりあえずそういったところをちゃんとやった上で、フレームのサイズに合ったバッジが描かれていきます。望ましい見た目（Desired appearance）にするために、今回は300×300のフレームに描いています。最終的なグラフィックサイズを得るために、レンダリング結果を小さなフレームに配置して、デザイン時のフレームと比較して確認する、といった趣旨です。よかった、次行きましょう。

`ProfileSummary`を更新し、いろいろな種類のバッジと、バッジの獲得理由を追加します。だんだんコードの説明が薄くなってきていますが、今までと同じかな、という感じで進めます。

では、`ProfileSummary`のどこにこのコードをペーストするかという話です。`ProfileHost`はここ。`ProfileSummary`の中で、今コピーしたやつを、`Divider()`を挟んで、その後に`VStack`、さらに`ScrollView`でバッジをいろいろ並べます。`HikeBadge(name: "First Hike")`、`HikeBadge(name: "Earth Day")`、`HikeBadge(name: "Tenth Hike")`のように置いて、`grayscale`や`hueRotation(Angle(degrees: ...))`で色を変えます。色がちゃんと変わります。こういう便利なモディファイアがあるのですね。色を変えるのは`hueRotation`です。まあまあ。 とりあえず、コード的には問題なさそうです。インデントがすごく深くなってしまっているのが、やっぱり気になりますね。せっかくなので整理して、先に進みましょう。

まず、`ScrollView` は必要です。その中に `VStack` があって、この中でプロフィール部分があります。ここは `ProfileView` として切り出してしまってもいいと思います。`Divider` の後にバッジが続くので、そこも合わせて整理します。

`ProfileSummary` に `extension` を生やして、その中で `var profileView: some View` のように切り出します。ただし、`some View` を返す都合で複数ビューを並べる場合はコンテナが必要なので、`Group` にまとめました。これで `Group` に入れたうえでプロフィールが表示されます。

不要なものは削除し、プロパティにまとめました。`ProfileView` 側もこれで描画できます。下はバッジのビューなので、このあたりもパーティショニングは大丈夫そうです。`VStack` の中で、ここまでがバッジの領域、すなわち `BadgesView` ですね。ここは `CollectedBadgesView`（名称は仮）として切り出し、`var collectedBadgesView: some View` のようにして貼り付けます。

`Completed` という名前は分かりにくいので、`CompletedBadgesView` にリネームしておきます。こうしてあげれば、インデントが浅くなるのと同時に、`ProfileSummary` は `Group` の中に `VStack` を連ねる形で、`ProfileView`、`Divider`、`CompletedBadgesView` で構成されている、と説明できます。コードと見比べれば分かりやすいですよね。こんな感じでよさそうなので、次に進みます。

最後の仕上げとして、`ProfileSummary` に `HikeView` を含めます。つまり、`HikeView` を入れておしまい、ということですね。`Divider` を挟んで `HikeView` を追加します。

その際、`Hike` データを使うために `ModelData` を `Environment` から取得する必要があります。たとえば、`@Environment(ModelData.self) var modelData`（あるいは環境オブジェクトを使う場合は `@EnvironmentObject var modelData: ModelData`）のようにします。プレビュー側でも、環境に `ModelData` を注入しておきましょう（例: `.environment(ModelData())` または `.environmentObject(ModelData())`）。

アプリケーションのクラッシュは極力避けたい一方で、`Environment` を多用する実装を歓迎しているのは、個人的には不思議だなと毎回思います。環境の注入を忘れただけでアプリがクラッシュするのはつらいので、それならいっそ強制アンラップのようなものも使ってみてほしい気がしますが、とにかく今回は `Recent Hikes`（最近のハイク）が表示されるビューだと見て分かったので、`HikeView` として入れておけば当然理解できるはずです。これで、各部分が何をしているのかも分かりやすくなったのではないでしょうか。 なので、`ProfileView` はこれでいいんです。ええと、これですね。やっぱりこの辺はまとめておくと、何かと良いことがある気がします。ということで、これもカットして、この中で `RecentLikesView` という感じでプロパティを作って持たせます。場所は…ここかな。いや、ここじゃないですね。ここでいい。あ、違う違う。

`RecentLikesView` というサブビューを返すようにして、この中にさっき持ってきたやつを貼り付けます。インデントがずれていましたね。`VStack` のトジカッコが変な位置にありました。大丈夫ですよね。インデントを直すショートカットが変わっちゃったのかもしれません。新しい Xcode だからかな。ちょっとずれていますよね。どうして悪かったのかはひとまず置いておきます。

とにかく、こうやって `LikeView` が `RecentLikesView` として名前付けられました。念のためもう一度確認します。ああ、この辺のインデントが間違っていましたね。そういうことでした。これで、`ProfileView` があって `Divider` が入り、別のビューがあって（ここは省略）、さらに `Divider` が入って、最後に `RecentLikesView` が表示される形で `body` が成り立っています。それがスクロールする構成ですね。はい、まとめ終わり。ここまで OK です。

では、`CategoryFormView` に進みます。`CategoryForm` の中で、ユーザープロファイルボタンをナビゲーションバーに対してツールバーモディファイアを使って表示します。プロファイルボタンをそれで表現して、押されたときにプロフィールを表示する、というのをやっていきます。

どんなコードかを簡単に書いておきます。`toolbar` を使って、`Button` で `showingProfile.toggle()` を呼びます。これは SwiftUI（いわゆる Twitter 的な UI）でよくあるやり方で、状態を変化させることで画面状態を切り替えるというやつですね。

あまり全部をコピペするのは好きではないので、この辺は入力します。まずデータとして `@State private var showingProfile = false` を用意します（既定では表示しない）。この名前の付け方は良いですね。現在表示しているかどうかが一目で分かります。

次に、`body`…というかツールバーのアイテムです。`NavigationSplitView` の中でツールバーに出すので、一番下あたりで良いでしょう。`List` のところに `.toolbar` を付けてボタンを置きます。ナビゲーションのタイトルの下で大丈夫です。

具体的には、`.toolbar { Button { showingProfile.toggle() } label: { UserProfileButton() } }` の形です。`Button` のアクションは `showingProfile.toggle()`、ラベルは `UserProfileButton` を使います。アイコンはそれですね。はい。 とりあえずトグルでいきますが、トグルの挙動が変だったら後で直しましょう。トグルでやって、あとシートですね。で、プロフィール。これを表示していきます。

あ、またここ、クリックを忘れていました。ツールバーの次でしたね。ここでいいはず。で、シート。シートとしては、こっちかな。`sheet(isPresented: $showingProfile)` で、プロフィールを表示します。コンテンツとして何を入れるんだっけ……コピーしておけばよかった。シートの中身は `ProfileHost` ですね。

`ProfileHost` に `environmentObject` を渡しておきます。`ProfileHost().environmentObject(modelData)` のようにします。`ProfileHost` 側は `@EnvironmentObject` を持っているのですが、それでもここで `environmentObject(modelData)` を渡す必要がある、ということですね。ここはまだ自分も完全に把握できていません。とりあえず入れておいて、後で外してどうなるか実験してみましょう。

これで表示はできました。OK ですね。

それから、`ListStyle` のモディファイアを使ってリストのスタイルを調整します。コンテンツに合う良いものに合わせていきましょう。今回は `listStyle(.inset)` にして、リビルドして確認します。ライブプレビューで挙動を確かめて、プロフィールボタンを押したときにどうなるかを見ます。プロフィールボタンを押すと、これが出てきて見られる、という感じですね。やってみましょう。

どこにあるんだっけな……`ContentView` に行って、プレビューが表示されていますね。チェックしたときに、プレビューはピン留めしておきましょう。こうして、これを確かめていきます。

まずは、カテゴリのフォームではなくて、プロフィールのところなので……`LandmarkList` じゃないですね。`ContentView` か、あるいは `CategoryHome` の `body`。`LandmarkList` のときにはプロフィールは出していないですよね。そういうことか。まあいいか。`FeaturedImage` のところなので、`CategoryHome` ですね。`CategoryHome` に限らず、同じように `showingProfile` を使ってシートを出します。アイテムは、ちゃんと用意して、まだ表示しないということなのかな？

プレビューは変わったかな……`environmentObject` を一回入れて、プレビュー変わっていますよね？ これを開いて、変わってますね。見たときに、これが「シーズン」……じゃなくて「シーン」でしたね。名前はシーンでした。

例えば、一番上……もっと上ですね。`ContentView` ではなく、アプリケーションのほうかな。この中で `environmentObject(ModelData())` を渡しているわけです。例えば `ContentView` で `.task` を使って `modelData` にアクセスすることもできますが、あ、そっか、今はまだ何もしていませんでした。`ModelData` の中に……入れてないか。`landmarks` や `hikes`。あれ、どうだったっけ？

どこまで戻ればいいんだ……このあたりかな。`ModelData` があって、`Profile` があって、これで表示しているものはどれだ？ `Profile` は外から与えられてくるから、`ProfileSummary` をどこで取っているのか……`ProfileHost` ですね。はい、これです。 ドラフトの話ですね。さっきは何度か「デフォルト」と言ってしまいましたが、正しくは「ドラフト」でした。ドラフトということは、ここで「デフォルト」とするのはやはり違和感があります。おそらく編集対象のプロフィールのことを指しているはずなので、ここがデフォルトというのは、この`ProfileHost`がやるべきことではない気がします。もう一度カットしますね。

それで、プロフィールを使うところで、ドラフトのプロフィールとしてデフォルトを渡す、という形なら良いと思います。ただ、今はその渡し方がうまくできていません。型が抜けているので、`Profile`を明示してあげます。これでここもOKだと思うのですが、`init`で`draft`を`@State private`にしてしまうと、そうなっちゃうんですよね。モデルから取ってくる、みたいなことを言っていた気がします。うーん、もう少し腑に落ちないのですが、ひとまずはデフォルトを渡すことにしましょう。

それで、`ProfileHost`の中で`Environment`などを指定していませんが、これは要らないですね。`ProfileSummary`の中に書いてみます。`ProfileSummary`では`Environment`を通過しています。`ModelData`があって、どこで使っているかというと`Hikes`ですね。これは`hikes[0]`を取るのに使っている、という理解で合っているようです。

この中で`Environment`は、プレビューでは渡す必要がありますが、`ContentView`の`Preview`では要らないのではないでしょうか。どうしようかな……。配信はできているので大丈夫ですね。MacBookが止まったかもしれません。やろうとしていることは、プレビュー間の違いが分かるようにしておくことです。具体的には、`Landmarks`側の`ContentView`の`Preview`を書き換えて、`Hikes`が参照できるようにしておきます。もう一箇所の`ProfileSummary`については今のままにして、その結果どうなるかを見る、という方針にしようと思いましたが……何にしても、MacBookが完全に止まりました。こういう止まり方をすることがあるんですね。どうしようかな。しゃべりながらやるにしても、キーボード入力ができません。いろいろ試してもダメなので、強制再起動するしかないですね。MacBookをハードリセットするのは久しぶりです。少し迷いましたが、気になさらずお願いします。

やろうとしていることは、とりあえずプレビューで本当に`Environment`が要らないのかどうかを確かめることです。そこを確実に試していきたいです。そのあとは、やろうとしていた別件です。先ほどのプロフィール表示のトグルが本当にトグルで良いのか、という点ですね。他のシミュレーターで動かしたときに、もしかするとボタンが残るかもしれません。残った場合は、もう一回押したら消える、というのは自然な動きだと思うので、それなら問題ありません。シミュレーターのモードを変えて試してみます。

もう1つやりたいことは、フィーチャード画面だけでプロフィールを入れる形で良いのかどうかです。ナビゲーションのボタンなので、リストのほうにも影響があって不自然ではなさそうです。リスト側から持ってきてもおかしくなさそうなので、こちらも試したいです。ということで、今からやっていきます。復帰が意外と早くて助かりました。Xcodeが立ち上がりました。そんな感じで進めていきます。

プロフィールを変えるにあたって、こちらは`Environment`があるので良いのですが、`ContentView`というかアプリ側、`Landmarks`ですね。この中では`Environment`として`ModelData`を渡しています。確認のため、`ModelData`について見ていきます。`Group`に対して`environmentObject`を渡しているところは良いでしょう。`ContentView`の中の`CategoryHome`、さらにその中で……いや、違いますね。`Profile`です。ここは良い。プロフィールの表示を作っているのは`Profile`。この中で`Environment`をインポートして……コメントアウトして試してみます。今ちゃんとエラーが出ているということは、この`Hike`ビューは問題ないわけです。

例えば、ボタンを押したときに`present`で`Profile`を出す、という動作にします。どこかこの辺に作りました。 例えば、`var`として`env2`とか。Environment…いや、Environmentではなく、`ModelData2`として、`ModelData`があって、とりあえず2つ作りました。

それで、`.hack2`で例えば`ModelData`を…あ、これは書き換え可能にしないといけないから、書き換え可能にするのに、このあたりを`State`にしちゃっているのかな。あ、でも`ModelData`はクラスでしたっけ。あ、クラスだ。じゃあいいや。参照型なので、プロパティ自体は書き換えられなくてよくて、中身は書き換えられますよね。

この中で`landmarks`がありますよね。これに対して、例えば`.insert`…`insert`、`newElement`ですね。これかな。`insert`で`newElement`として`Landmark`を作ります。`id`…`id`って何でしたっけ。何かあって、`name`として「テスト」にして、`park`が何かあって、`state`も「テスト」で大丈夫か。何でもいいや、とにかく。`image`は…`image`は何だ。えーと、`image`は`.init`でやるか。`.init`。`name`か。`name`は何だっけ。`landmarks`で`name`として…。`name`を変なことにするとダメかな。テストはダメかもしれないですが。`coordinates`は`init`で、まあ何でもいい。北極とかでいいのかな。いや北極じゃないか、適当なマークか。えーと、それと、`category`も何でもいい。これも何でもいい。`isFavorite`は一応`false`。で、あと`at: 0`ってやってね、先頭に入れていく。ここがダメなだけ？ もう一列じゃないのか。`name`が使われるか。

こうやって`ModelData2`を設定して、これを`Environment`に設定していくと、データが変わるじゃないですか。`ModelData2`が出てくるのかな。プレビューがちゃんと進んでくれる…進んでくれなかった。えーと、これはどこまで落ちたかな。えーと、ここだ。

チラッと見たら、スキームをビルドしたらビルドに失敗か。はいはい、ビルドに失敗ね。何ですか、この落ち方。本当の`CategoryForm`、この辺で問題があるらしい。`Environment`に渡すのが間違っていたかな。`Environment`に渡すときには、アプリの方では`State`にしないとダメそうね。危ない。分からないですけど。あと`State`ね、こうしてあげて…。あ、これで大丈夫そうね。はい、そしたら、プレビューが…。 まずは動作とビルドエラーの有無を確認します。とりあえず、ここではモデルデータを `ModelData2` に差し替えただけなのですが、これでもダメなのかを見ています。`Image`、`landmarkImage`、うーん、これがダメなのかな。`Environment` にして渡したけれど、それではダメなのか。ランドマークのステップで `Environment` に対して…いや、`Binding` じゃないですよね。かなり適当にやっていますが、それで良いのかという問題があります。ダメですよね、やっぱり。

`Environment` でこれを渡せなかったのかどうか。渡せなかったのが気になっています。`CategoryHome` で、モデルデータを `State` で定義していますよね。アプリ側にも戻りますが、アプリでも `State` でモデルデータを定義して、それを `Environment` に渡すスタイルになっています。これと同じことをやったつもりなんです。

もしかして、ここのカッコが変ですね。ああ、カッコが変だ。これ、ローカル変数だったのか。なんでこれでできていたんだろう、という状況になっています。ローカルスコープに残っちゃっていたんですね。よくわからないけれど、どっちにしても、これでいいや。これでもう大丈夫でしょう。

ビルドをかけて、ビルドが通ることを確かめたら、プレビューは落ちないと思っています。ボタンを押したときに動くはずです。動いた。

この中で、名前はこれです。`Environment` に渡していますよね。渡しましたよね。`ProfileHost` にも渡しました。`ModelData2` ですよね。`landmarks.insert(newElement, at: 0)` という形で挿入しています。

その状態で `ProfileHost` に行き、`ProfileHost` の中で…あ、違うか。`ProfileSummary` があって、その中で `Environment` が…いや、同じか。渡してあるから、ここまで伝播されるはずですよね。おかしいですね。

`ProfileSummary` の中で `Environment` を使っていて、`modelData` の…あ、`hikes` か。全然違う名前を出していました。`hikes` ですね。なるほど、ということは問題はありません。それはそれで問題なしです。

`modelData.hikes` の `insert` として `newElement` は、これです。`id` は書かないけれど、`name` はテスト、`distance` は…なんだっけ。キロメートルなので 100 として、`difficulty` は…もういいか、10。これで何もないというのが `HikeView` に表示される、という状態です。これを押してみましょう。あ、出てきた出てきた。100km、テストで、グラフがないという状態。落ちないのはいいですね。

このサンプル、チュートリアルでは落ちるんですよ。強制終了します。素晴らしい、うまくいきました。何にしても、こうやって `Environment` でモデルデータを渡してあげれば、ちゃんとここまで伝播します。コンテンツビュー、つまり `ContentView` の中の `CategoryHome` で、こうしておけば、`HikeView` が大元のものになります。ローカルで勝手に変えたものではなくてね。これでいいと思うんですが、違うのかな。自信がなくなるほどではないけれど、ちょっと変だな。まあいいか。これで良いということにしましょう。いいですね。

さて次です。あと二つ言いましたよね。トグルが気になる問題。トグルが気になるのは、これですね。ボタンを押すと隠れるので、押しようがないじゃないですか。出るときに、手でホイッと下に動かせばいいわけですけど、これが他のだったら…そもそもないか。画面の外にこのアイコンが表示され続けるのであれば、それはそれで良くて、またそれをポチッと押せばいいわけですが…。

あれ、また止まった？ 動いているか。なんかマウスカーソルがいなくなっているんだけど、これもしかして OS の不具合かな。いなくなって…入力が効いているのか。Enter を押したらどうなる？ どうなるのか。Command+Tab…。えーと、コンピューターは動いていますね。ユーザーインターフェイスだけなくなっちゃうんだ。あ、そう。えーと、あ、キーボードが効かなくなった。今、ほら、OS…なんだっけ、固まっていました。 文字起こしテキストをご提示ください。いただいた内容を次の方針で整えます。

- ですます調に統一し、文体や句読点を整えて自然な文章にします。
- 要約はせず、内容は削りません。
- 明らかな誤認識（例: G言語→C言語、万全オキス→万全を期す など）は適切に修正します。
- コードは、短いものはインラインで`こういうふうに`、長いものはコードブロックで表記します。
- 複数人の会話も、発話者名は付けずに自然な文章へまとめます。
- テキストが途中から始まっている場合は、最初の不完全な文は無視して次の文から整えます。
- 与えられていない内容（挨拶など）は追加しません。

長い場合は分割して送っていただいて大丈夫です（順番が分かるようにしてください）。 画面録画でやっていましたが、できたかなと思ったら、やっぱり固まってしまいます。マウスカーソルが見えず、今は画面も映っていません。クリックでフォーカスを外すことはできたのですが、マウスがどこか変なところにいる認識になっているのか、操作がうまくいきません。調整終了……あ、動きました。けれど、やっぱりよくわかりません。またダメですね。どうしましょう。マウスがやっぱり見当たりません。二度試しても固まってしまうので、ひとまず調整は終了です。もう一回だけ試して、ボタンがちゃんと動くようならそれでよい、という感じでやっていきます。

さっきの Tutorial の Environment は何だったのでしょうね。間違えた機能なのか、昔の Swift の仕様なのか。あそこでイベント連鎖が途切れたのかもしれません。Environment がアプリ落ちの原因になるのは困りますが、落ちる場所は決まっているはずなので、開発中に気づければそれでよいと思います。

そうこうしているうちに復活したので続けますが、MacBook が固まりすぎるのは嫌ですね。困りました。アップデートしてから、こんなことはなかった気がします。だとすると、いまは画面共有が、ログインしたからなのか反応が鈍い状態で、なんとか試みてくれているところです。それにしても、どうしたものか……。刺し直したら出ました。一応この調子でやります。これでプレビューをもう一回動かして、iPad mini のプレビュー表示をしたうえで、プロフィールボタンがどういう動きを見せるか、ここからですね。

ここで確かめたいところとしては、`showingProfile` です。これがボタンでプロフィールを表示する、という状況になっていますが、ボタンから直接代入してやればそれでいいのではないかという発想です。ボタンが隠れるだけで済むのなら、それでもよいと思います。変に矛盾する動きにはならないはずです。

いまターゲットが iPhone になっていました。iPad ではないですね。iPad に切り替えます。iPad でプレビューを出します。ここだけ確かめて……もう一つ確かめたいことがあるかもしれません。Mac が順調に動くようなら、これを進めていきたいです。あと、Mac mini がすごく熱を持っていますね。今また止まってしまった感じがします。カーソルが動きません。止まってしまったかどうか、今は判断できませんでした。ということで、いったんこのくらいにしましょう。

それともう一つ、これをリストに切り替えたときに、ユーザーの編集ボタン、つまりプロフィールボタンがいらないとも言い切れない気がしていて、そこを確かめたいです。ボタンが必要かどうかを見つつ、必要なら両方にプロフィールのボタンを入れなければなりません。ただ、そうすると両方の画面に対して `showingProfile` を持たせるのは、少し賢くないと感じます。もし両方からプロフィールの編集画面を開けるようにしたいなら、どう改良していくか、そのあたりを考えたいです。

Transcription & Summarize : とりあえず読書会 SwiftUI Tutorials #1

とりあえず紹介を始めていってみましょうか。今日から SwiftUI のチュートリアルを読んでいきたいと思います。以前にも読んだことがあり、そのときのアーカイブも残してはあるのですが、いろいろ遊びながら進めていて、Apple の Vision Pro の映像を重ねて表示していた都合で、すごく見にくいんですよね。可能性はあるかなと思ってやってみたのですが、やはり素直な二次元の表示のほうが勉強会には向いている気がします。見られないことはないけれど、音だけ聞けばいいかという感じにもなってしまって、そこが気になっていました。なので、改めて SwiftUI のチュートリアルを普通の感じで読み直して、最後まで通してみようかなというわけです。

自分は SwiftUI をそこまで積極的に使っていません。誰かが使っているからというわけでもないのですが、そういう事情もあって馴染みが薄いところがあります。だからこそ、この機会に SwiftUI の本を読んでおいて、慣れておくのは重要かなという気持ちで読み進めていこうと思います。

まずは SwiftUI チュートリアルのドキュメントを見ていきます。おそらく英語版しかないんですかね。自分は英語が得意ではないのでスラスラ読めるか不安はありますが、最近は英語を読むためのツールが世の中にだいぶ広がっているので、なんとかなるでしょう。

そんな感じで読んでいきますが、まずは導入部分からですね。SwiftUI はモダンな方法でユーザーインターフェースを定義する、Apple プラットフォーム全体で使えるフレームワークです。いわゆる宣言的な UI の定義という形で、モダンな潮流に乗ったやり方ですね。Android でも Jetpack Compose がありますし、各プラットフォームが同じような表現方法を選んでいく動きがあります。デザイン面でも、一時期のフラットデザインの流行では Apple も Microsoft も、そして Google も取り入れていました。こういう流行がどう形成されていくのかを見ていると不思議です。

今回、Apple が次の OS で「リキッドグラス」というデザインのユーザーインターフェースを発表しますが、ベータ版を使ってみる感じではなかなか良いですね。最初は微妙かなと思っていたのですが、バージョンが上がるにつれて、きれいで良い感じになってきている気がします。これもそのうち他が真似て一斉に動くのかもしれません。

まあまあ、雑談はこのくらいにしておきます。SwiftUI の今どきの UI の書き方は、結構書きやすい感じがしますよね。 なので、これを学んでいくのが立ち上がりとしては良い感じかなと思います。美しく素敵なアプリを、以前よりも早く作れるらしいですね。UIKit の描画速度については気を付ける必要があります。UIKit の裏側では GPU をきちんと使って描画するので速い、という話はよく聞いていましたが、SwiftUI はどうなのでしょう。構造が全然違うでしょうから、速度の違いも面白そうです。まったく別の特徴が出てきたりするのでしょうか。

「Get Started」を押すと何が起こるのかを見ると、SwiftUI Essentials ですね。1つ前の画面の下にある、この SwiftUI Essentials。今日はチャプター1、Drawing & Animation から始まるということのようです。これが全部「章」ですね。では、ここを普通に読んでいけば良いのでしょうか。「Creating & Combining Views」と書いてあります。とりあえず「Get Started」を押してみます。ここには結構しっかり書かれていますね。

では、ここから読んでいきます。ビューを作ったり組み合わせたりしていくようです。SwiftUI チュートリアルを見ていきましょう。SwiftUI では Landmarks というアプリを作って、見ていく流れみたいですね。このアプリは、お気に入りの場所をシェアしたり、詳細を見たりできるもので、まずはランドマークの詳細ページを作るところから始めるようです。レイアウトにはスタック（Stack）を使い、`Image` や `Text` といったコンポーネントを組み合わせて配置していきます。マップビューを追加するために、標準の MapKit を使うこともあるようです。

デザインをより良くしていくために、リアルタイムフィードバックがあり、コードの変更をすぐに確認できるらしいです。プロジェクトファイルをダウンロードして、このプロジェクトをビルドし、ステップに沿って進めていけば良い、ということですね。読んだのですが、細かい文言は忘れてしまいました。とりあえずダウンロードして、いじっていけば良さそうです。少し試してみますか。ダウンロードしたものを開く感じですね。ただ、その前にもう少し読み進めてみます。

新しいプロジェクトを作って、キャンバスのプレビューを見ていく流れのようです。新しい Xcode プロジェクトを作成し、テンプレートのコードとキャンバスのプレビューを確認します。キャンバスでプレビューを見て操作できるようにして、Xcode のキャンバスからプレビューを見たり操作したりします。ここに書かれているのは、このチュートリアルで説明している機能ですね。Mac で進める前提で、必要な環境が書かれていますが、こちらは問題なさそうなので、進めていく感じです。

まずは Xcode を開いて、 とりあえず新規プロジェクトを選択してプロジェクトを作っていきます。テンプレートは iOS のアプリケーションを選び、次へ進みます。プロジェクト名は「Landmarks」と入力し、インターフェースは `SwiftUI`、言語は `Swift` を選択して次へ進みます。保存場所を決めて Create し、プロジェクトが作成できました。

次はステップ4として、プロジェクトナビゲータで `LandmarksApp` を選びます。アプリは `SwiftUI` のライフサイクルで作られていて、`App` プロトコルに準拠し、`body` で1つ以上のシーンを提供します。`@main` 属性がこのアプリのエントリポイントを示しています。`WindowGroup` が1つのシーンで、その一環ですね。`App` プロトコルに準拠し、`@main` が付いていることで、アプリのいちばん外側の枠組みができているという話です。

続いて、プロジェクトナビゲータで `ContentView` を選び、その内容を見ていきます。`SwiftUI` のビューは構造体で定義され、構造体は `View` プロトコルに準拠します。`body` にビューのコンテンツやレイアウトが記述されます。さらに、プレビューを定義するための型があり、そのビューのプレビューを定義します。ここでは `ContentView` を表示している、という感じです。

`ContentView` は構造体で `View` に準拠していて、その中で `VStack` を使ってレイアウトしています。キャンバスはプレビューを自動的に表示します。もし表示されていないときは、エディタのメニューから Canvas を選ぶと表示されます。ショートカットは Command + Option + Enter です。キャンバスの表示はモードで変わるので、必要に応じて切り替えます。これがショートカットですね。

ステップ7として、`ContentView` の `body` プロパティで既存のコードを消して「Hello, world」を表示します。このときに使うコンポーネントは `Text` です。`body` にコードを書くとプレビューが自動的に更新されるので、まずはこれをやっていきます。`ContentView` の中にすでに `Text("Hello, world")` がある場合はいったん削除して空にし、`Text("Hello, world")` と書くと、すぐにプレビューに反映されます。表記は `Hello, SwiftUI` に合わせておきます。`Text("Hello, SwiftUI")` にして OK です。では次に進みます。

セクション2では、`Text` ビューをカスタマイズしていきます。コードを書き換えて表示を更新できますし、インスペクタを使って変更できるプロパティを見つけることもできます。今回の `Landmarks` アプリをビルドするにあたっては、Xcode のソースエディタやキャンバス、インスペクタといった機能を使って編集していきます。ここに出てくる英語の表現がよくわからないところがありましたが、今はひとまず気にしないで進めます。 こんな感じでいろいろな更新方法があるというお話ですが、どこから見ていけばいいのでしょう。まず、カスタマイズする方法としてインスペクタがあります。これ、前にこのドキュメントを読んだときにも思ったのですが、なかなか便利です。ただ、ついついコードで頑張りたくなる癖が自分にはありますね。

やり方としては、まずプレビューをセレクタブルモードに切り替えます。デフォルトではライブモードなので、そこをセレクタブルモードにするのが最初の一手です。そうしたら、プレビュー上で Command-Control-クリックをするとインスペクタを開けます。ポップオーバーでいろいろなプロパティが選べます。

この中で、最初に「Landmarks」アプリで最初に表示するランドマーク名の `Text` を「Turtle Rock」に変更します。実際にやってみると、セレクタブルモードに切り替え、`Text` を Command-Control-クリックしてインスペクタを表示します。SwiftUI インスペクタでテキストのところを編集して「Turtle Rock」に変えると、`Text("Turtle Rock")` に更新されました。途中で余計な箇所を触って消えてしまったのでやり直したりもしましたが、無事反映されています。

続いて、フォントのモディファイアをタイトルに変えてみます。先ほどと同様にインスペクタを開き、フォントのセクションでタイトルを選ぶと、`font(.title)` が反映され、表示も変わりました。インスペクタの使い心地を見ていると、「コードで書いたほうが早いな」と思うこともありますが、どこに設定があるのか見つからないときに手がかりとして探していくのはとても良いですよね。これでフォントサイズを変えられました。SwiftUI を読み進めながら進める感じで、タイトルへの変更はこれで大丈夫です。

SwiftUI をカスタマイズするには、モディファイアを使っていきます。モディファイアはラップしているビューを変更する仕組みで、それらのモディファイアは新しいビューを返します。たとえば、前景色を緑に設定してみましょう。`Text` のビューに対してモディファイアをチェーンで（縦でも横でも）追加していきます。以前は `foregroundColor` をよく使いましたが、今は非推奨なので `foregroundStyle` を使います。使い心地はほぼ同じで、`foregroundStyle(.green)` のように書きます。これで色が緑に変わりましたね。

次は「コードは常に真実の唯一の情報源（Source of Truth）」という、よく聞く言葉についてです。ソースコードと実際の表示がきちんと対応していて、ずれることがない、という意味合いで使われます。プログラムを書くときにも、同じデータが複数箇所に分散しているより、同じデータが一箇所にあるほうが重要です。基本的には一箇所にオリジナルを置くことで、いろいろな面で楽になります。利点が多いので、よく言われる思想の一つですね。

インスペクタでモディファイアをいじるときに、Xcode はコードをすぐに変更に合わせてくれます。たとえば、インスペクタでフォントをタイトルにした瞬間に、コード側には `font(.title)` が自動で付与されます。これをやや大げさに説明しているのが、まさにこの「Source of Truth」の部分です。

このとき、もう一度インスペクタを開くには、`Text` の宣言部分で Control クリックして SwiftUI インスペクタを表示します。インスペクタのアクションポップアップメニューから、`Text` に由来するプロパティを選べる、という説明が続きます。 とりあえず選択モードにして、対象を選びます。さっき「control + option + クリック」と言いましたが、正しくは「control + command + クリック」ですね。これで選択すると、左側のコード側でも該当箇所が選択されるのがうれしいところです。

インスペクタで、レンジで色付けたものを元に戻したいのですが、色は下のほうでしょうか。フォアグラウンドスタイルが変わりましたね。意外と良い要素があります。ここがグリーンになっているのをブラックにする、という説明だったと思います。ブラックにすると黒くなりました。良いですね。ブラックにしたら、Xcode のアップデートで自動的に前景色（フォアグラウンド）のグリーンのモディファイアを削除してくれる、と書いてあります。今どうなったでしょう。ブラックになっていますよね。何か選び方を間違えたかもしれません。

手順には control + クリックと書いてありますね。UI インスペクタを表示して、カラーのところで Inherited を選ぶ、という説明です。やり方をどこか間違えたのかもしれません。control + クリック、たぶん control + command + クリックだと思うのですが、自分が command を忘れているのかも。最近見落としが多いので、単に忘れている可能性もあります。

とりあえずポップアップを出して、フォアグラウンドスタイルのところを見ても Inherited がない気がします。Path とも違いますよね。Inherited が見当たりません。スクロールもできないし、すぐ消えてしまいます。チュートリアルと Xcode のバージョンが合っていないのかもしれません。消すだけなら良いのですが、やはり Inherited がない。Delete を試してみましょう。うまく合いません。選択して Delete、Esc、Delete……あまりうまくいきません。しょうがないですね、Esc しかないです。ブラックを選ぶとブラックになってしまうのは、場面によっては困るところがあります。仕方ないですね。チュートリアルとの食い違いです。まあいいか。

そういえば、見る場所を間違えていました。コード側で control + クリックする手順でした。自分が読み間違えていたのかもしれません。非推奨（Deprecated）になった都合で、このモディファイアは取り除かないといけない状態のようです。次に行きましょう。Xcode が自動的に反映してくれる、という説明は既に読みました。前景色のグリーンは削除されました。

次に、プレビューをライブモードに切り替えます。ライブモードにすると、インタラクションやアニメーションの動作を維持したまま確認できます。とりあえずコードの切り替えをして……ちょっと表示が大きすぎるかもしれません。縮小ができないですね。ここまでにしておきます。

次、セクション 3。「ビューをスタックで組み合わせる」です。`TitleView`（さきほど作成したタイトルのビュー）に、テキストビュー、つまりランドマークの詳細を追加していきます。`Park` と `State` を、`HStack` に `Spacer` を挟む形で並べる、といったイメージです。

こうした UI のビューを作るときは、これらのコンテンツのレイアウトや動きを `body` プロパティに記述します。ただし、`body` プロパティは単一のビューしか返せないため、複数のビューを返したい場合は、スタックに入れてグループ化する必要があります。ビューのグループは、水平（`HStack`）、垂直（`VStack`）、または前後方向に重ねる（`ZStack`）といった形で構成します。

このセクションでは、垂直方向のスタック（`VStack`）や水平方向のスタック（`HStack`）を使って、タイトルを水平方向の `HStack` に配置し、その上に詳細を重ねていく感じになります。そのために、Xcode でインスペクタを開き、コンテナビューに埋め込む操作として「Embed in `VStack`」を使います。 まず、テキストビューをControlクリックして「Embed in VStack」を選び、`VStack`の中にテキストを入れます。

続いて、ビューライブラリから`Text`をドラッグして追加します。ライブラリは右上のプラスボタンから開けますし、ショートカットの Shift+Command+L でも表示できます。

テキストビューのプレースホルダを「Joshua Tree National Park」に書き換えます。さらにインスペクタを開き、フォントを`subheadline`に変更します。

次に、`VStack`のイニシャライザを変更して、左揃えにします。インスペクタのアライメントで「Leading」を選ぶか、コードなら `VStack(alignment: .leading)` と指定します。これで左揃えになります。

もう一つテキストを右側に配置したいので、いまある`Text`をControlクリックして「Embed in HStack」を選び、`HStack`に入れます。そのうえで、新しい`Text`を`HStack`内の直後に追加し、プレースホルダを「California」に変更します。フォントは先ほどと同じく`subheadline`に合わせます。

レイアウトをデバイスサイズに応じて調整するため、2つのテキストの間に`Spacer()`を入れます。`Spacer()`が残りの空きスペースを占めることで、左側の「Joshua Tree National Park」と右側の「California」が左右に離れて配置されます。

最後に、ランドマーク名など必要な箇所に`padding()`モディファイアを付けて、適度な余白を確保します。 パディングはこれでいい感じにできました。デフォルトのパディングは、`padding`で引数を指定しないことによって自動的に入っていきます。これによって、統一感のある余白感が約束できるのも上手ですし、それをデフォルト引数でやるというのが、言語表現としてうまい感じがしますね。

パディングもうまくいったので、次はカスタムイメージビューを配置していきます。`NameLocationView`ができたので、次のステップは画像を置くことです。コードをいろいろ追加する代わりに、カスタムビューを作って、マスクとボーダーとドロップシャドウを画像に適用していきます。そういったカスタムビューを作っていく方針です。

そのために、まずプロジェクトのアセットカタログに画像を入れていきます。`Turtle Rock@2x.jpg`を、さきほどダウンロードしたプロジェクトファイルの`Resources`フォルダから見つけて、アセットカタログのエディタにドラッグ＆ドロップします。これで`Turtle Rock`の2倍解像度の画像が登録されました。

次に、チュートリアルでは「Create New SwiftUI View（カスタムイメージビュー）」という流れです。ファイルから New で`SwiftUI View`を選択し、`CircleImage.swift`という名前で作っていきます。ここで新しいファイルを`SwiftUI View`として作成し、`CircleImage`を用意しました。次は画像を入れて、モディファイしていく準備ができています。

続いて、既存のビューを`Turtle Rock`の画像で表現していきます。先ほどの`Turtle Rock`という画像名を指定すると、その画像が表示されます。`body`の`Text`の代わりに`Image("Turtle Rock")`を入れます。チュートリアルに沿ってやっていくだけだと、サクサク進んで簡単だなという感じがしますよね。これがちゃんと自分だけで使えるかどうかというのは、また鍛錬が必要ですけどね。

次に、`clipShape`で丸く切り抜きます。`clipShape(Circle())`を画像に適用して、丸いマスクを使って形を整えます。さらに、`overlay`でボーダーを重ねます。グレーのストロークの円をもう一枚作って、画像のボーダーとして使います。`overlay`に`Circle().stroke(.gray, lineWidth: 4)`という感じで指定すればよいです。色はその場で指定できます。はじめはグレーで試し、あとからホワイトに変更しても大丈夫です。`Circle().stroke(.white, lineWidth: 4)`という指定になります。

続いて、半径7ポイントのシャドウをつけます。`shadow(radius: 7)`を`overlay`の次に書けばOKです。これでドロップシャドウが効きました。最後に、ボーダーのカラーをホワイトにします。先ほどグレーで作った輪の部分をホワイトに変える、という意味ですね。`overlay`内のストローク色を`.white`にすれば完了です。チュートリアル通りで、そんなに難しいところはやっていないので、すんなり進みます。

次は「SwiftUI の View を他のフレームワークから使う」という話で、マップを作っていくようです。与えられた座標を中央にマップを表示し、マップは`MapKit`でレンダリングします。そのために、まずまた`SwiftUI View`を作成し、`MapView.swift`にします。ここまで進めます。

チュートリアルに沿うと、`MapKit`をインポートし、`SwiftUI`と関係するフレームワークをインポートします。Swift には`#if canImport(ModuleName)`のようなディレクティブがありますよね。それを使って、`SwiftUI`がインポートできるならこのコードを有効にする、みたいなこともできます。とにかく、ここでは`import MapKit`を追加するところまでやります。

次に、プライベートな計算型プロパティを用意して、マップのリージョン情報を持たせます。いわゆる「プライベートな computed property」を使って、表示する領域などを管理する、という流れです。 とりあえずプロパティを持たせるようなので、コピペしようかなと思いました。コピペは勉強の観点では記憶に残りにくい気もしますが、とにかく進めます。まずは `import MapKit` を入れて、その上でプライベートな計算型プロパティを定義します。計算型プロパティは `MKCoordinateRegion` を返すもので、`center` がこれ、`span` がこれ、という形で設定するようです。とりあえず、これはリファレンスどおりに持ってきた感じです。

次に、デフォルトのテキストをマップビューに置き換えます。カメラポジションはリージョンで初期化し、初期位置（`initialPosition`）としてリージョンを渡します。さっき定義した計算型プロパティを使うわけですね。SwiftUI を使うときには、計算型プロパティよりも保存型プロパティのほうが有利だったような気もしますが、今回はこのまま進めます。

とりあえず、`body` で `Map` を配置して、`Text("Hello, world!")` ではなく、`Map` に対して初期位置をリージョンで渡します。これでマップが出て、初期位置が表示されました。コンポーネント指向というのでしょうか、これはすごいですね。マップがこんな感じに手軽にできて、少し前だと想像もできない簡単さです。とにかく、マップがタートルロックを中央にして表示されました。

マップの操作については、大阪方面にズームアウトしたり、いろいろ状況を確認したりできます。Option を押しながらドラッグすることで、回転などもできるらしいので、一応やってみました。プレビュー画面でここまで動くのは、今どきなら当たり前かもしれませんが、やはりすごいですね。

次はディテールビューを組み込んでいく流れです。このようなコンポーネントを持っていて、名前や場所、周りのイメージ、そしてマップがあります。これらのツールを使ってビューを組み合わせ、最終的なデザインに落とし込んでいきます。

そのために、まずプロジェクトナビゲーターで `ContentView` を選択します。3つの `Text` ビューを別の `VStack` に埋め込む（Embed）作業をします。エンベッドは簡単にできるかと思ったのですが、3つの `Text` ビューをまとめて選択して右クリックから `VStack` にエンベッド、というのがうまくいきませんでした。選択モードで複数選択を試したものの、Shift も Command も Option も効かず、このやり方はだめでした。なので手でやることにして、`VStack` を入れて、`Text` と `HStack` を丸ごと `VStack` に入れ直しました。`VStack` が一番外側に来ていれば OK です。

続いて `MapView` を追加します。カスタムで作った `MapView` を `VStack` より前に追加し、`frame` の height パラメータだけを設定します。そうすると幅は自動的に決まるとのことなので、`frame(height: 300)` を指定します。`VStack` の前に差し込んで、これでできました。`frame` の高さが 300 になって、幅は自動的に決まります。いいですね。

次はステップ 4 として、`CircleImage` ビューをレイアウトに入れていきます。`MapView` の次に `CircleImage` を追加し、`MapView` の上に重ねて配置するために、`offset(y: -130)` を指定します。さらに下方向の余白を調整するために、`padding(.bottom, -130)` も指定します。これで意図した重なりと余白のバランスになります。 とりあえず、これは手で打ってみたいです。さっきのパディングを見てみましょう。これでボトムでマイナスいくつだっけ……。`-130`でやると、`-130`によって Turtle Rock のテキストがかぶってくるんですよね。さらに、オフセットの Y ですね。これを`-130`にすると全体的に上に連れていって、いい感じに 130 の半分がマップにかかった、という見た目になります。

これで、ディバイダーを入れていきます。ボトム……ボトムは `VStack` の下。外に `Spacer()` を挟んで、ビューの上側に固定するということをするらしいですね。これです、`Spacer()`。今は全体が真ん中に寄ってしまっているので、`VStack` の中の最後、ここに `Spacer()` を入れます。これを入れてあげると、上側にグッと寄ってきます。だんだんそのままになるのが面白いですね。

次に、`Divider()` を挟んで、ランドマークのテキストを入れていきます。これをコピーして……`Text`。`Divider()` をタイトルとエリアのところの間に入れます。ディバイダー入りましたね。これをやってあげる、と。ここの `Spacer()` より下までですよね。

`Spacer()` はどこだ……ここか。`HStack` に `Spacer()` がいる。ここは要らないのかな。`Divider()` を挟んで……やっぱりちょっとずれちゃいますよね。`Spacer()`、あれ、どこ行っちゃった？ いると思うんだけどな。ここにあると思ったけど、`HStack` の下ですね。だから、`HStack` の下、ここか。ここに `Divider()` と説明テキスト的なものを挟みます。これで OK ですかね。できたっぽいけど、待ってるのかな……なんか変な気がする。`HStack` の外ですよね。`HStack` 変だなと思ったけど、外でした。ここに貼る。これで OK ですね。こうすると、`Divider` の下に要素が正しく配置されるようになります。

最後に、サブヘッドラインを、フォントのモディファイアーを、1 つの `Text` ビューからそれを含む `HStack` に移動して、セカンダリー・スタイルとしてサブヘッドライン・テキストを適用していきます。「セカンダリー・スタイルとして」というのは特別な言葉なのかな……とりあえずやっていきます。それぞれのテキストに合ったやつ、これをサブヘッドライン、これですね。`HStack` のサブヘッドライン 2 つを、それぞれの `Text` に個別で指定するのではなく、それらをまとめた `HStack` に設定して、それでおしまいということですかね。ここにコードが出てきていないけれど、最後にモディファイアーを `Text` の `HStack` に移動するとよいですね。モディファイアーをスタックに適用したときに、UI はそのモディファイアーを外側でまとめられている要素全部に適用してくれます。

コードは……これか。見つかりました。`foregroundStyle(.secondary)` ですね。さっきの「セカンダリー」って出てきたのは、セカンダリー・スタイルのことなので、サブヘッドラインに対してフォアグラウンド・スタイルとして `foregroundStyle(.secondary)` を指定してあげると、色が薄くなりましたね。フォアグラウンド・スタイル。これでできました。

もう 1 個残りですね。「理解をチェック」、流しましたね、こういうの。カスタムの SwiftUI ビューを作成したとき、ビューのレイアウトはどこで宣言するか。カスタム SwiftUI ビューの `body` ですかね。これであれですね。

次はまた次回にしますが、今度はリストとナビゲーションを作っていくという話です。基本的なランドマークのディテール・ビューをセットアップして、ユーザーがランドマークのフルリストを見られるように提供し、それぞれのロケーションのディテール・ビューを追加していく、と。そんな感じですね。今日はこれくらいにして、また次回それを見ていく感じにしましょう。松原さんでした。
